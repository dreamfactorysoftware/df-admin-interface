"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[9709],{19709:(g,v,r)=>{r.r(v),r.d(v,{DfLimitDetailsComponent:()=>D});var i=r(31635),n=r(89417),p=r(99437),_=r(18810),c=r(88834),E=r(30450),T=r(86600),f=r(60177),I=r(82798),l=r(99631),h=r(32102),m=r(51425),d=r(24784),u=r(33609),R=r(9709),F=r(49894),t=r(17705),C=r(18498),y=r(52868),O=r(44984);function P(s,e){if(1&s&&(t.j41(0,"mat-option",32),t.EFF(1),t.k0s()),2&s){const o=e.$implicit;t.Y8G("value",o.id),t.R7$(1),t.SpI("",o.name," ")}}function G(s,e){if(1&s&&(t.qex(0),t.j41(1,"mat-form-field",2)(2,"mat-label"),t.EFF(3),t.nI1(4,"transloco"),t.k0s(),t.j41(5,"mat-select",30),t.DNE(6,P,2,2,"mat-option",31),t.k0s()(),t.bVm()),2&s){const o=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"limits.service")),t.R7$(3),t.Y8G("ngForOf",o.serviceDropdownOptions)}}function k(s,e){if(1&s&&(t.j41(0,"mat-option",32),t.EFF(1),t.k0s()),2&s){const o=e.$implicit;t.Y8G("value",o.id),t.R7$(1),t.SpI("",o.name," ")}}function $(s,e){if(1&s&&(t.qex(0),t.j41(1,"mat-form-field",2)(2,"mat-label"),t.EFF(3),t.nI1(4,"transloco"),t.k0s(),t.j41(5,"mat-select",33),t.DNE(6,k,2,2,"mat-option",31),t.k0s()(),t.bVm()),2&s){const o=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"limits.role")),t.R7$(3),t.Y8G("ngForOf",o.roleDropdownOptions)}}function A(s,e){if(1&s&&(t.j41(0,"mat-option",32),t.EFF(1),t.k0s()),2&s){const o=e.$implicit;t.Y8G("value",o.id),t.R7$(1),t.SpI("",o.name," ")}}function j(s,e){if(1&s&&(t.qex(0),t.j41(1,"mat-form-field",2)(2,"mat-label"),t.EFF(3),t.nI1(4,"transloco"),t.k0s(),t.j41(5,"mat-select",34),t.DNE(6,A,2,2,"mat-option",31),t.k0s()(),t.bVm()),2&s){const o=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"limits.user")),t.R7$(3),t.Y8G("ngForOf",o.userDropdownOptions)}}function B(s,e){1&s&&(t.qex(0),t.j41(1,"mat-form-field",2)(2,"mat-label"),t.EFF(3),t.nI1(4,"transloco"),t.k0s(),t.nrm(5,"input",35),t.k0s(),t.bVm()),2&s&&(t.R7$(3),t.JRh(t.bMT(4,1,"limits.endpoint")))}r(36225);const L=function(s,e){return{label:s,description:e}};let D=class M{constructor(e,o,a,b,S,U,W){this.limitService=e,this.router=o,this.activatedRoute=a,this.translateService=b,this.formBuilder=S,this.themeService=U,this.snackbarService=W,this.isEditMode=!1,this.limitTypeToEdit=null,this.roleDropdownOptions=[],this.userDropdownOptions=[],this.serviceDropdownOptions=[],this.alertMsg="",this.showAlert=!1,this.alertType="error",this.type="create",this.isDarkMode=this.themeService.darkMode$,this.formGroup=this.formBuilder.group({limitName:["",n.k0.required],description:[""],limitType:["instance",n.k0.required],serviceId:[],roleId:[],userId:[],endpoint:[],limitRate:[null,n.k0.required],limitPeriod:["minute",n.k0.required],verb:[],active:[!0]})}ngOnInit(){this.activatedRoute.data.subscribe(e=>{this.type=e.type,"edit"===e.type&&(this.limitTypeToEdit=e.data,this.snackbarService.setSnackbarLastEle(this.limitTypeToEdit.name,!0),this.formGroup.patchValue({limitName:this.limitTypeToEdit.name,limitType:this.limitTypeToEdit.type,serviceId:this.limitTypeToEdit.serviceId,roleId:this.limitTypeToEdit.roleId,userId:this.limitTypeToEdit.userId,limitRate:this.limitTypeToEdit.rate,limitPeriod:this.limitTypeToEdit.period,active:this.limitTypeToEdit.isActive,description:this.limitTypeToEdit.description,endpoint:this.limitTypeToEdit.endpoint,verb:this.limitTypeToEdit.verb}),this.formGroup.value.serviceId||this.removeFormField("serviceId"),this.formGroup.value.roleId||this.removeFormField("roleId"),this.formGroup.value.userId||this.removeFormField("userId"),this.formGroup.value.endpoint||this.removeFormField("endpoint"))}),"create"===this.type&&(this.removeFormField(),this.renderCorrectHiddenFields("instance")),this.activatedRoute.data.subscribe(e=>{this.serviceDropdownOptions=e.services.resource}),this.activatedRoute.data.subscribe(e=>{this.userDropdownOptions=e.users.resource}),this.activatedRoute.data.subscribe(e=>{this.roleDropdownOptions=e.roles.resource}),this.formGroup.get("limitType")?.valueChanges.subscribe(e=>{e&&(this.removeFormField(),this.renderCorrectHiddenFields(e))})}onSubmit(){if(this.formGroup.valid){if(this.showAlert=!1,"create"===this.type){const e=this.assembleLimitPayload();this.limitService.create({resource:[e]}).pipe((0,p.W)(o=>(this.alertMsg=o.error.error.message,this.showAlert=!0,(0,_.$)(()=>new Error(o))))).subscribe(o=>{this.router.navigate(["../",o.resource[0].id],{relativeTo:this.activatedRoute})})}else if("edit"===this.type){const e=this.assembleLimitPayload();this.limitService.update(e.id,e).pipe((0,p.W)(o=>(this.alertMsg=o.error.error.message,this.showAlert=!0,(0,_.$)(()=>new Error(o))))).subscribe(o=>{this.router.navigate(["../",o.id],{relativeTo:this.activatedRoute})})}}else this.alertMsg=this.translateService.translate("limits.invalidForm"),this.showAlert=!0}onCancel(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}assembleLimitPayload(){const e={description:this.formGroup.value.description??null,endpoint:this.formGroup.value.endpoint??null,isActive:this.formGroup.value.active,name:this.formGroup.value.limitName,period:this.formGroup.value.limitPeriod,roleId:this.formGroup.value.roleId??null,serviceId:this.formGroup.value.serviceId??null,userId:this.formGroup.value.userId??null,type:this.formGroup.value.limitType,verb:this.formGroup.value.verb};return"edit"===this.type?{id:this.limitTypeToEdit?.id,createdDate:this.limitTypeToEdit?.createdDate,lastModifiedDate:this.limitTypeToEdit?.lastModifiedDate,rate:this.formGroup.value.limitRate??null,...e}:{cacheData:{},rate:this.formGroup.value.limitRate?this.formGroup.value.limitRate.toString():"1",...e}}renderCorrectHiddenFields(e){switch(e){case"instance":case"instance.each_user":break;case"instance.user.service":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.k0.required])),this.formGroup.addControl("userId",this.formBuilder.control("",[n.k0.required]));break;case"instance.each_user.service":case"instance.service":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.k0.required]));break;case"instance.role":this.formGroup.addControl("roleId",this.formBuilder.control("",[n.k0.required]));break;case"instance.user":this.formGroup.addControl("userId",this.formBuilder.control("",[n.k0.required]));break;case"instance.user.service.endpoint":this.formGroup.addControl("userId",this.formBuilder.control("",[n.k0.required])),this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.k0.required])),this.formGroup.addControl("endpoint",this.formBuilder.control("",[n.k0.required]));break;case"instance.service.endpoint":case"instance.each_user.service.endpoint":this.formGroup.addControl("serviceId",this.formBuilder.control("",[n.k0.required])),this.formGroup.addControl("endpoint",this.formBuilder.control("",[n.k0.required]));break;default:this.removeFormField()}}removeFormField(e){e?this.formGroup.removeControl(e):(this.formGroup.removeControl("serviceId"),this.formGroup.removeControl("roleId"),this.formGroup.removeControl("userId"),this.formGroup.removeControl("endpoint"))}static{this.\u0275fac=function(o){return new(o||M)(t.rXU(d.gu),t.rXU(C.Ix),t.rXU(C.nX),t.rXU(u.JO),t.rXU(n.ok),t.rXU(y.n),t.rXU(O.L))}}static{this.\u0275cmp=t.VBU({type:M,selectors:[["df-limit"]],standalone:!0,features:[t.aNF],decls:92,vars:89,consts:[[3,"showAlert","alertType","alertClosed"],[1,"details-section",3,"formGroup","ngSubmit"],["appearance","outline","subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","type","text","formControlName","limitName"],["formControlName","verb",1,"dynamic-width",3,"schema"],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["rows","1","matInput","","type","text","formControlName","description"],["formControlName","limitType"],["value","instance"],["value","instance.user"],["value","instance.each_user"],["value","instance.service"],["value","instance.role"],["value","instance.user.service"],["value","instance.each_user.service"],["value","instance.service.endpoint"],["value","instance.user.service.endpoint"],["value","instance.each_user.service.endpoint"],[4,"ngIf"],["matInput","","type","number","formControlName","limitRate"],["formControlName","limitPeriod"],["value","minute"],["value","hour"],["value","day"],["value","7-day"],["value","30-day"],["color","primary","formControlName","active",1,"full-width"],[1,"full-width","action-bar"],["type","button","mat-flat-button","",1,"cancel-btn",3,"click"],["mat-flat-button","","color","primary",1,"save-btn"],["formControlName","serviceId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","roleId"],["formControlName","userId"],["matInput","","type","text","formControlName","endpoint"]],template:function(o,a){1&o&&(t.j41(0,"df-alert",0),t.bIt("alertClosed",function(){return a.showAlert=!1}),t.EFF(1),t.k0s(),t.j41(2,"form",1),t.bIt("ngSubmit",function(){return a.onSubmit()}),t.nI1(3,"async"),t.j41(4,"mat-form-field",2)(5,"mat-label"),t.EFF(6),t.nI1(7,"transloco"),t.k0s(),t.nrm(8,"input",3),t.k0s(),t.nrm(9,"df-verb-picker",4),t.nI1(10,"transloco"),t.nI1(11,"transloco"),t.j41(12,"mat-form-field",5)(13,"mat-label"),t.EFF(14),t.nI1(15,"transloco"),t.k0s(),t.nrm(16,"textarea",6),t.k0s(),t.j41(17,"mat-form-field",2)(18,"mat-label"),t.EFF(19),t.nI1(20,"transloco"),t.k0s(),t.j41(21,"mat-select",7)(22,"mat-option",8),t.EFF(23),t.nI1(24,"transloco"),t.k0s(),t.j41(25,"mat-option",9),t.EFF(26),t.nI1(27,"transloco"),t.k0s(),t.j41(28,"mat-option",10),t.EFF(29),t.nI1(30,"transloco"),t.k0s(),t.j41(31,"mat-option",11),t.EFF(32),t.nI1(33,"transloco"),t.k0s(),t.j41(34,"mat-option",12),t.EFF(35),t.nI1(36,"transloco"),t.k0s(),t.j41(37,"mat-option",13),t.EFF(38),t.nI1(39,"transloco"),t.k0s(),t.j41(40,"mat-option",14),t.EFF(41),t.nI1(42,"transloco"),t.k0s(),t.j41(43,"mat-option",15),t.EFF(44),t.nI1(45,"transloco"),t.k0s(),t.j41(46,"mat-option",16),t.EFF(47),t.nI1(48,"transloco"),t.k0s(),t.j41(49,"mat-option",17),t.EFF(50),t.nI1(51,"transloco"),t.k0s()()(),t.DNE(52,G,7,4,"ng-container",18),t.DNE(53,$,7,4,"ng-container",18),t.DNE(54,j,7,4,"ng-container",18),t.DNE(55,B,6,3,"ng-container",18),t.j41(56,"mat-form-field",2)(57,"mat-label"),t.EFF(58),t.nI1(59,"transloco"),t.k0s(),t.nrm(60,"input",19),t.k0s(),t.j41(61,"mat-form-field",2)(62,"mat-label"),t.EFF(63),t.nI1(64,"transloco"),t.k0s(),t.j41(65,"mat-select",20)(66,"mat-option",21),t.EFF(67),t.nI1(68,"transloco"),t.k0s(),t.j41(69,"mat-option",22),t.EFF(70),t.nI1(71,"transloco"),t.k0s(),t.j41(72,"mat-option",23),t.EFF(73),t.nI1(74,"transloco"),t.k0s(),t.j41(75,"mat-option",24),t.EFF(76),t.nI1(77,"transloco"),t.k0s(),t.j41(78,"mat-option",25),t.EFF(79),t.nI1(80,"transloco"),t.k0s()()(),t.qex(81),t.j41(82,"mat-slide-toggle",26),t.EFF(83),t.nI1(84,"transloco"),t.k0s(),t.bVm(),t.j41(85,"div",27)(86,"button",28),t.bIt("click",function(){return a.onCancel()}),t.EFF(87),t.nI1(88,"transloco"),t.k0s(),t.j41(89,"button",29),t.EFF(90),t.nI1(91,"transloco"),t.k0s()()()),2&o&&(t.Y8G("showAlert",a.showAlert)("alertType",a.alertType),t.R7$(1),t.JRh(a.alertMsg),t.R7$(1),t.HbH(t.bMT(3,34,a.isDarkMode)?"dark-theme":""),t.Y8G("formGroup",a.formGroup),t.R7$(4),t.JRh(t.bMT(7,36,"limits.name")),t.R7$(3),t.Y8G("schema",t.l_i(86,L,t.bMT(10,38,"limits.verb"),t.bMT(11,40,"limits.verbTooltip"))),t.R7$(5),t.JRh(t.bMT(15,42,"limits.description")),t.R7$(5),t.JRh(t.bMT(20,44,"limits.limitType")),t.R7$(4),t.SpI("",t.bMT(24,46,"limits.limitTypes.instance")," "),t.R7$(3),t.SpI("",t.bMT(27,48,"limits.limitTypes.user")," "),t.R7$(3),t.SpI("",t.bMT(30,50,"limits.limitTypes.eachUser")," "),t.R7$(3),t.SpI("",t.bMT(33,52,"limits.limitTypes.service")," "),t.R7$(3),t.SpI("",t.bMT(36,54,"limits.limitTypes.role")," "),t.R7$(3),t.SpI("",t.bMT(39,56,"limits.limitTypes.serviceByUser")," "),t.R7$(3),t.SpI("",t.bMT(42,58,"limits.limitTypes.serviceByEachUser")," "),t.R7$(3),t.SpI("",t.bMT(45,60,"limits.limitTypes.endpoint")," "),t.R7$(3),t.SpI("",t.bMT(48,62,"limits.limitTypes.endpointByUser")," "),t.R7$(3),t.SpI("",t.bMT(51,64,"limits.limitTypes.endpointByEachUser")," "),t.R7$(2),t.Y8G("ngIf",a.formGroup.controls.serviceId),t.R7$(1),t.Y8G("ngIf",a.formGroup.controls.roleId),t.R7$(1),t.Y8G("ngIf",a.formGroup.controls.userId),t.R7$(1),t.Y8G("ngIf",a.formGroup.controls.endpoint),t.R7$(3),t.JRh(t.bMT(59,66,"limits.limitRate")),t.R7$(5),t.JRh(t.bMT(64,68,"limits.limitPeriod")),t.R7$(4),t.SpI("",t.bMT(68,70,"limits.limitPeriods.minute")," "),t.R7$(3),t.SpI("",t.bMT(71,72,"limits.limitPeriods.hour")," "),t.R7$(3),t.SpI("",t.bMT(74,74,"limits.limitPeriods.day")," "),t.R7$(3),t.SpI("",t.bMT(77,76,"limits.limitPeriods.week")," "),t.R7$(3),t.SpI("",t.bMT(80,78,"limits.limitPeriods.30Days")," "),t.R7$(4),t.JRh(t.bMT(84,80,"limits.active")),t.R7$(4),t.SpI(" ",t.bMT(88,82,"cancel")," "),t.R7$(3),t.SpI(" ",t.bMT(91,84,"save")," "))},dependencies:[m.W,n.X1,n.qT,n.me,n.Q0,n.BC,n.cb,n.j4,n.JD,h.RG,h.rl,h.nJ,l.fS,l.fg,I.Ve,I.VO,T.wT,f.pM,T.Sy,f.bT,E.mV,E.sG,c.Hl,c.$z,u.Kj,R.N,f.Jj],styles:[".df-limit-form-container[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}"]})}};D=(0,i.Cg)([(0,F.d)({checkProperties:!0})],D)},51425:(g,v,r)=>{r.d(v,{W:()=>I});var i=r(17705),n=r(60177),p=r(88834),_=r(20060),c=r(45383);function E(l,h){if(1&l){const m=i.RV6();i.j41(0,"button",5),i.bIt("click",function(){i.eBV(m);const u=i.XpG(2);return i.Njj(u.dismissAlert())}),i.j41(1,"fa-icon",6),i.EFF(2),i.k0s()()}if(2&l){const m=i.XpG(2);i.R7$(1),i.Y8G("icon",m.faXmark),i.R7$(1),i.JRh("alerts.close")}}function T(l,h){if(1&l&&(i.j41(0,"div",1),i.nrm(1,"fa-icon",2),i.j41(2,"span",3),i.SdG(3),i.k0s(),i.DNE(4,E,3,2,"button",4),i.k0s()),2&l){const m=i.XpG();i.HbH(m.alertType),i.R7$(1),i.Y8G("icon",m.icon),i.R7$(3),i.Y8G("ngIf",m.dismissible)}}const f=["*"];let I=(()=>{class l{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new i.bkB,this.faXmark=c.Jyw}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return c.SGM;case"error":return c.rfe;case"warning":return c.tUE;default:return c.iW_}}static{this.\u0275fac=function(d){return new(d||l)}}static{this.\u0275cmp=i.VBU({type:l,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[i.aNF],ngContentSelectors:f,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(d,u){1&d&&(i.NAR(),i.DNE(0,T,5,4,"div",0)),2&d&&i.Y8G("ngIf",u.showAlert)},dependencies:[n.bT,p.Hl,p.iY,_.dX,_.aY],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]})}}return l})()}}]);