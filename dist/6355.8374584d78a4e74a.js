"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[6355],{16355:(J,b,l)=>{l.r(b),l.d(b,{DfRoleDetailsComponent:()=>z});var N,i=l(97582),a=l(56223),f=l(96814),Z=l(42346),A=l(86806),g=l(64170),D=l(84870),C=l(2032),y=l(82599),d=l(32296),x=l(15861),u=l(25313),R=l(90590),t=l(98525),I=l(3305),T=l(45597),F=l(49488),L=l(78791),q=l(65619),O=l(86825),e=l(65879),P=l(81896),Q=l(23680);function B(r,o){1&r&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.service")," "))}function S(r,o){if(1&r&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&r){const n=o.$implicit;e.Q6J("value",n.id),e.xp6(1),e.Oqu(n.name)}}function Y(r,o){if(1&r){const n=e.EpF();e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",20),e.NdJ("selectionChange",function(){const p=e.CHM(n).dataIndex,v=e.oxw();return e.KtG(v.getComponents(p))}),e.TgZ(6,"mat-option",21),e._uU(7,"All"),e.qZA(),e.YNc(8,S,2,2,"mat-option",22),e.qZA()()()}if(2&r){const n=o.dataIndex,s=e.oxw();e.Q6J("formGroupName",n),e.xp6(3),e.Oqu(e.lcZ(4,4,"roles.accessOverview.tableHeadings.service")),e.xp6(3),e.Q6J("value",0),e.xp6(2),e.Q6J("ngForOf",s.serviceOptions)}}function G(r,o){1&r&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.component")," "))}function U(r,o){if(1&r&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&r){const n=o.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function m(r,o){if(1&r&&(e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",23),e.YNc(6,U,2,2,"mat-option",22),e.qZA()()()),2&r){const n=o.dataIndex,s=e.oxw();e.Q6J("formGroupName",n),e.xp6(3),e.Oqu(e.lcZ(4,3,"roles.accessOverview.tableHeadings.component")),e.xp6(3),e.Q6J("ngForOf",s.getComponentArray(n))}}function _(r,o){1&r&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.access")," "))}function h(r,o){if(1&r&&(e.TgZ(0,"span",26),e._uU(1),e.qZA()),2&r){const n=e.oxw(2).dataIndex,s=e.oxw();e.xp6(1),e.AsE(" (+",(s.formArray.controls[n].value.access.length||0)-1," ",2===s.formArray.controls[n].value.access.length?"other":"others",") ")}}function k(r,o){if(1&r&&(e.TgZ(0,"mat-option",21),e._uU(1),e.YNc(2,h,2,2,"span",25),e.qZA()),2&r){const n=o.$implicit,s=e.oxw().dataIndex,c=e.oxw();e.Q6J("value",n.value),e.xp6(1),e.hij("",n.label," "),e.xp6(1),e.Q6J("ngIf",(c.formArray.controls[s].value.access.length||0)>1)}}function K(r,o){if(1&r){const n=e.EpF();e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",24),e.NdJ("selectionChange",function(c){const v=e.CHM(n).dataIndex,E=e.oxw();return e.KtG(E.accessChange(v,c.value))}),e.YNc(6,k,3,3,"mat-option",22),e.qZA()()()}if(2&r){const n=o.dataIndex,s=e.oxw();e.Q6J("formGroupName",n),e.xp6(3),e.Oqu(e.lcZ(4,3,"roles.accessOverview.tableHeadings.access")),e.xp6(3),e.Q6J("ngForOf",s.accessOptions)}}function j(r,o){1&r&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.requester")," "))}function H(r,o){if(1&r&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&r){const n=o.$implicit;e.Q6J("value",n.value),e.xp6(1),e.Oqu(n.label)}}function oe(r,o){if(1&r&&(e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",27),e.YNc(6,H,2,2,"mat-option",22),e.qZA()()()),2&r){const n=o.dataIndex,s=e.oxw();e.Q6J("formGroupName",n),e.xp6(3),e.Oqu(e.lcZ(4,3,"roles.accessOverview.tableHeadings.requester")),e.xp6(3),e.Q6J("ngForOf",s.requesterOptions)}}function ne(r,o){1&r&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.advancedFilters")," "))}function ae(r,o){if(1&r){const n=e.EpF();e.TgZ(0,"td",18)(1,"button",28),e.NdJ("click",function(){const c=e.CHM(n),p=c.$implicit,v=c.dataIndex,E=e.oxw();return e.KtG(E.toggleRow(p,v))}),e._UZ(2,"fa-icon",29),e.qZA()()}if(2&r){const n=o.dataIndex,s=e.oxw();e.Q6J("formGroupName",n),e.xp6(2),e.Q6J("icon",s.faPlus)}}function re(r,o){if(1&r){const n=e.EpF();e.TgZ(0,"th",17)(1,"button",30),e.NdJ("click",function(){e.CHM(n);const c=e.oxw();return e.KtG(c.add())}),e.ALo(2,"transloco"),e._UZ(3,"fa-icon",31),e.qZA()()}if(2&r){const n=e.oxw();e.xp6(1),e.uIk("aria-label",e.lcZ(2,2,"newEntry")),e.xp6(2),e.Q6J("icon",n.faPlus)}}function se(r,o){if(1&r){const n=e.EpF();e.TgZ(0,"td",18)(1,"button",32),e.NdJ("click",function(){const p=e.CHM(n).dataIndex,v=e.oxw();return e.KtG(v.remove(p))}),e._UZ(2,"fa-icon",29),e.qZA()()}if(2&r){const n=o.dataIndex,s=e.oxw();e.Q6J("formGroupName",n),e.xp6(2),e.Q6J("icon",s.faTrashCan)}}function le(r,o){if(1&r&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&r){const n=o.$implicit;e.Q6J("value",n.value),e.xp6(1),e.Oqu(n.label)}}function ce(r,o){if(1&r){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",35)(2,"mat-form-field",19)(3,"mat-label"),e._uU(4,"Field"),e.qZA(),e._UZ(5,"input",36),e.qZA(),e.TgZ(6,"mat-form-field",19)(7,"mat-label"),e._uU(8,"Operator"),e.qZA(),e.TgZ(9,"mat-select",37),e.YNc(10,le,2,2,"mat-option",22),e.qZA()(),e.TgZ(11,"mat-form-field",19)(12,"mat-label"),e._uU(13,"Value"),e.qZA(),e._UZ(14,"input",38),e.qZA(),e.TgZ(15,"div")(16,"mat-button-toggle-group",39),e.NdJ("change",function(c){e.CHM(n);const p=e.oxw().dataIndex,v=e.oxw();return e.KtG(v.filterOpChange(c,p))}),e.TgZ(17,"mat-button-toggle",40),e._uU(18,"AND"),e.qZA(),e.TgZ(19,"mat-button-toggle",41),e._uU(20,"OR"),e.qZA()()(),e.TgZ(21,"button",42),e.NdJ("click",function(){e.CHM(n);const c=e.oxw().dataIndex,p=e.oxw();return e.KtG(p.addAdvancedFilter(c))}),e._UZ(22,"fa-icon",29),e.qZA(),e.TgZ(23,"button",42),e.NdJ("click",function(){const p=e.CHM(n).index,v=e.oxw().dataIndex,E=e.oxw();return e.KtG(E.removeAdvancedFilter(v,p))}),e._UZ(24,"fa-icon",29),e.qZA()(),e.BQk()}if(2&r){const n=o.index,s=e.oxw(2);e.xp6(1),e.Q6J("formArrayName",n),e.xp6(9),e.Q6J("ngForOf",s.operatorOptions),e.xp6(12),e.Q6J("icon",s.faPlus),e.xp6(2),e.Q6J("icon",s.faTrashCan)}}function ie(r,o){if(1&r&&(e.TgZ(0,"td",18)(1,"div",33),e.YNc(2,ce,25,4,"ng-container",34),e.qZA()()),2&r){const n=o.$implicit,s=o.dataIndex,c=e.oxw();e.Q6J("formGroupName",s),e.uIk("colspan",6),e.xp6(1),e.Q6J("@detailExpand",n===c.expandedElement?"expanded":"collapsed"),e.xp6(1),e.Q6J("ngForOf",c.getAdvancedFilters(s).controls)}}function me(r,o){1&r&&e._UZ(0,"tr",43)}function pe(r,o){1&r&&e._UZ(0,"tr",44)}function de(r,o){1&r&&(e.TgZ(0,"tr",45)(1,"td",46),e._UZ(2,"br"),e._uU(3),e.ALo(4,"transloco"),e.qZA()()),2&r&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"roles.accessOverview.noAccessRules")," "))}function ue(r,o){1&r&&e._UZ(0,"tr",47)}l(6625);const $=function(){return["service","component","access","requester","advancedFilters","actions"]},_e=function(){return["expandedDetail"]};let W=((N=class{constructor(o,n,s){this.activatedRoute=o,this.baseService=n,this.fb=s,this.displayedColumns=["service","component","access","requester","advancedFilters","actions"],this.expandField=new a.NI(""),this.faTrashCan=R.Vui,this.faPlus=R.r8p,this.serviceOptions=[{id:0,name:""}],this.expandOperator=new a.NI(""),this.expandValue=new a.NI(""),this.componentOptions=[{serviceId:0,components:["*"]}],this.accessOptions=[{value:1,label:"GET (read)"},{value:2,label:"POST (create)"},{value:4,label:"PUT (replace)"},{value:8,label:"PATCH (update)"},{value:16,label:"DELETE (remove)"}],this.requesterOptions=[{value:1,label:"API"},{value:2,label:"SCRIPT"}],this.operatorOptions=[{value:"=",label:"="},{value:"!=",label:"!="},{value:">",label:">"},{value:"<",label:"<"},{value:">=",label:">="},{value:"<=",label:"<="},{value:"in",label:"in"},{value:"not in",label:"not in"},{value:"start with",label:"start with"},{value:"end with",label:"end with"},{value:"contains",label:"contains"},{value:"is null",label:"is null"},{value:"is not null",label:"is not null"}],this.filteredComponentArray=[],this.expandedElement$=new q.X(1),this.expandedElement=null,this.form=this.fb.group({cFormArray:this.fb.array([this.createItem()])})}createItem(){return this.fb.group({service:[""],component:[""]})}ngOnInit(){this.activatedRoute.data.subscribe(o=>{this.serviceOptions=o?.services?.resource.sort((n,s)=>n.name<s.name?-1:n.name>s.name?1:0)||[],"edit"===o.type&&o.data.roleServiceAccessByRoleId.length>0&&o.data.roleServiceAccessByRoleId.forEach(n=>{const s=n.serviceId,c=this.serviceOptions.find(p=>p.id===s)?.name||"";"email"!==c?this.baseService.get(c,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(p=>{this.componentOptions.push({serviceId:s,components:p.resource})}):this.componentOptions.push({serviceId:s,components:["*"]})})}),this.initializeFilteredComponents(),this.updateDataSource()}get cFormArray(){return this.form.get("formArray")}initializeFilteredComponents(){this.filteredComponentArray=this.formArray.controls.map((o,n)=>this.getComponentArray(n))}getComponentArray(o){const n=this.formArray.at(o).get("service")?.value;return this.componentOptions.find(c=>c.serviceId===n)?.components||[]}filterOptions(o,n){const s=o.target.value.toLowerCase(),c=this.formArray.at(n).get("service")?.value,p=this.componentOptions.find(v=>v.serviceId===c)?.components||[];this.filteredComponentArray[n]=p.filter(v=>v.includes(s))}getComponents(o){var n=this;return(0,x.Z)(function*(){const s=n.formArray.controls[o].get("service")?.value,c=n.serviceOptions.find(p=>p.id===s)?.name||"";"email"!==c?n.componentOptions.some(p=>p.serviceId===s)||n.baseService.get(c,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(p=>{n.componentOptions.push({serviceId:s,components:p.resource})}):n.componentOptions.push({serviceId:s,components:["*"]})})()}getExtendOperator(o){const n=this.serviceAccess.at(o).get("extend-operator")?.value;return this.componentOptions.find(c=>c.serviceId===n)?.components||[]}toggleRow(o,n){this.expandedElement=this.expandedElement===o?null:o,this.expandedElement&&0===this.getAdvancedFilters(n).length&&this.addAdvancedFilter(n)}accessChange(o,n){this.formArray.at(o).get("access")}updateDataSource(){const o=this.formArray.controls.filter((n,s)=>this.visible[s]);this.dataSource=new u.by(o)}get hasServiceAccess(){return this.rootForm.controls.serviceAccess.value.length>0}add(){const o=new a.Oe([]);this.formArray.push(new a.cw({service:new a.NI(0,a.kI.required),component:new a.NI("",a.kI.required),access:new a.NI("",a.kI.required),requester:new a.NI([1],a.kI.required),advancedFilters:o,id:new a.NI(null),serviceAccess:new a.NI("")})),this.visible.push(!0),this.updateDataSource()}getAdvancedFilters(o){return this.formArray.controls[o].get("advancedFilters")}addAdvancedFilter(o){this.getAdvancedFilters(o).push(new a.cw({expandField:new a.NI("",a.kI.required),expandOperator:new a.NI("",a.kI.required),expandValue:new a.NI("",a.kI.required),filterOp:new a.NI("")})),this.updateDataSource()}removeAdvancedFilter(o,n){this.getAdvancedFilters(o).removeAt(n),0===this.getAdvancedFilters(o).length&&(this.expandedElement=null),this.updateDataSource()}remove(o){o>=0&&o<this.formArray.length&&(this.visible[o]=!1),this.updateDataSource()}addFilter(o){const n=this.serviceAccess.at(o).get("advancedFilters");n instanceof a.Oe?n.push(new a.cw({expandField:new a.NI("",a.kI.required),expandOperator:new a.NI("",a.kI.required),expandValue:new a.NI("",a.kI.required),filterOp:new a.NI("")})):console.error("advancedFilters is not a FormArray")}removeFilter(o,n){this.serviceAccess.at(o).get("advancedFilters").removeAt(n)}filterOpChange(o,n){this.getAdvancedFilters(n).controls.forEach(s=>{s.get("filterOp")?.setValue(o.value)})}}).\u0275fac=function(o){return new(o||N)(e.Y36(P.gz),e.Y36(A.PA),e.Y36(a.qu))},N.\u0275cmp=e.Xpm({type:N,selectors:[["df-roles-access"]],inputs:{formArray:"formArray",roleForm:"roleForm",visible:"visible"},standalone:!0,features:[e.jDz],decls:39,vars:17,consts:[[1,"service-access-accordion","full-width",3,"formGroup"],["expanded","true"],["formArrayName","serviceAccess"],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","service"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"formGroupName",4,"matCellDef"],["matColumnDef","component"],["matColumnDef","access"],["matColumnDef","requester"],["matColumnDef","advancedFilters"],["matColumnDef","actions"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"formGroupName"],["subscriptSizing","dynamic","appearance","outline"],["formControlName","service","panelWidth","null",3,"selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","component","panelWdith","null"],["formControlName","access","multiple","","panelWidth","null",3,"selectionChange"],["class","example-additional-selection",4,"ngIf"],[1,"example-additional-selection"],["formControlName","requester","multiple","","panelWidth","null"],["mat-icon-button","","color","primary","type","button",3,"click"],["size","xs",3,"icon"],["mat-mini-fab","","color","primary","type","button",3,"click"],["size","xl",3,"icon"],["mat-icon-button","",3,"click"],["formArrayName","advancedFilters",1,"element-detail"],[4,"ngFor","ngForOf"],[1,"expandedItems",3,"formArrayName"],["matInput","","formControlName","expandField"],["formControlName","expandOperator","panelWidth","null"],["formControlName","expandValue","matInput",""],["aria-label","Service Definition Type","formControlName","filterOp",3,"change"],["value","AND"],["value","OR"],["mat-icon-button","","type","button",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],["mat-row","",1,"detail-row"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"mat-accordion")(2,"mat-expansion-panel",1)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),e._uU(5),e.ALo(6,"transloco"),e.qZA(),e.TgZ(7,"mat-panel-description"),e._uU(8),e.ALo(9,"transloco"),e.qZA()(),e.TgZ(10,"p"),e._uU(11),e.ALo(12,"transloco"),e.qZA(),e.ynx(13,2),e.TgZ(14,"table",3),e.ynx(15,4),e.YNc(16,B,3,3,"th",5),e.YNc(17,Y,9,6,"td",6),e.BQk(),e.ynx(18,7),e.YNc(19,G,3,3,"th",5),e.YNc(20,m,7,5,"td",6),e.BQk(),e.ynx(21,8),e.YNc(22,_,3,3,"th",5),e.YNc(23,K,7,5,"td",6),e.BQk(),e.ynx(24,9),e.YNc(25,j,3,3,"th",5),e.YNc(26,oe,7,5,"td",6),e.BQk(),e.ynx(27,10),e.YNc(28,ne,3,3,"th",5),e.YNc(29,ae,3,2,"td",6),e.BQk(),e.ynx(30,11),e.YNc(31,re,4,4,"th",5),e.YNc(32,se,3,2,"td",6),e.BQk(),e.ynx(33,12),e.YNc(34,ie,3,4,"td",6),e.BQk(),e.YNc(35,me,1,0,"tr",13),e.YNc(36,pe,1,0,"tr",14),e.YNc(37,de,5,3,"tr",15),e.YNc(38,ue,1,0,"tr",16),e.qZA(),e.BQk(),e.qZA()()()),2&o&&(e.Q6J("formGroup",n.roleForm),e.xp6(5),e.hij(" ",e.lcZ(6,8,"roles.accessOverview.heading"),""),e.xp6(3),e.hij(" ",e.lcZ(9,10,"roles.accessOverview.tableDescription")," "),e.xp6(3),e.hij(" ",e.lcZ(12,12,"roles.accessOverview.description")," "),e.xp6(3),e.Q6J("dataSource",n.dataSource),e.xp6(21),e.Q6J("matHeaderRowDef",e.DdM(14,$)),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(15,$)),e.xp6(2),e.Q6J("matRowDefColumns",e.DdM(16,_e)))},dependencies:[Z.Ot,u.p0,u.BZ,u.fO,u.as,u.w1,u.Dz,u.nj,u.ge,u.ev,u.XQ,u.Gk,u.Ee,a.UX,a.Fj,a.JJ,a.JL,a.sg,a.u,a.x0,a.CE,g.lN,g.KE,g.hX,t.LD,t.gD,Q.ey,C.c,C.Nt,I.To,I.pp,I.ib,I.yz,I.yK,I.u4,T.uH,T.BN,d.ot,d.RK,d.nh,f.ez,f.sg,f.O5,F.vV,F.A9,F.Yi,a.u5],styles:["mat-expansion-panel[_ngcontent-%COMP%]{overflow-x:auto!important}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}table[_ngcontent-%COMP%]{width:100%}tr.detail-row[_ngcontent-%COMP%]{height:0}tr.element-row[_ngcontent-%COMP%]:not(.example-expanded-row):hover{background:whitesmoke}tr.element-row[_ngcontent-%COMP%]:not(.example-expanded-row):active{background:#efefef}.element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column;gap:8px;padding-top:8px}.element-detail[_ngcontent-%COMP%]   .expandedItems[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:5px}.detail-input[_ngcontent-%COMP%]{margin-right:20px}  .cdk-overlay-pane{width:max-content!important}"],data:{animation:[(0,O.X$)("detailExpand",[(0,O.SB)("collapsed,void",(0,O.oB)({height:"*",minHeight:"0"})),(0,O.SB)("expanded",(0,O.oB)({height:"*"})),(0,O.eR)("expanded <=> collapsed",(0,O.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),N);W=(0,i.gn)([(0,L.c)({checkProperties:!0})],W);var M,fe=l(41089),ee=l(26306),te=l(58504),ge=l(65763),he=l(72246);function ve(r,o){1&r&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.rolesOverview.error.name")," "))}function Ae(r,o){1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"save")," "))}function xe(r,o){1&r&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"update")," "))}let z=((M=class{constructor(o,n,s,c,p,v){this.roleService=o,this.fb=n,this.router=s,this.activatedRoute=c,this.themeService=p,this.snackbarService=v,this.type="",this.alertMsg="",this.showAlert=!1,this.alertType="error",this.visibilityArray=[],this.isDarkMode=this.themeService.darkMode$,this.filterOp="",this.roleForm=this.fb.group({id:[0],name:["",a.kI.required],description:[""],active:[!1],serviceAccess:this.fb.array([]),lookupKeys:this.fb.array([])})}ngOnInit(){this.activatedRoute.data.subscribe(({data:o,type:n})=>{this.type=n,o&&(this.snackbarService.setSnackbarLastEle(o.label?o.label:o.name,!0),this.roleForm.patchValue({id:o.id,name:o.name,description:o.description,active:o.isActive}),o.roleServiceAccessByRoleId.length>0&&(this.filterOp=o.roleServiceAccessByRoleId[0].filterOp,o.roleServiceAccessByRoleId.forEach(s=>{this.visibilityArray.push(!0);const c=new a.Oe((s.filters||[]).map(p=>new a.cw({expandField:new a.NI(p.name),expandOperator:new a.NI(p.operator),expandValue:new a.NI(p.value),filterOp:new a.NI(s.filterOp)})));this.roleForm.controls.serviceAccess.push(new a.cw({service:new a.NI(s.serviceId?s.serviceId:0,[a.kI.required]),component:new a.NI(s.component),access:new a.NI(this.handleAccessValue(s.verbMask),[a.kI.required]),requester:new a.NI(this.handleRequesterValue(s.requestorMask)),advancedFilters:c,id:new a.NI(s.id),extendField:new a.NI(s.extendField),extendOperator:new a.NI(s.extendOperator),extendValue:new a.NI(s.extendValue),filterOp:new a.NI(s.filterOp)}))})),o.lookupByRoleId.length>0&&o.lookupByRoleId.forEach(s=>{this.roleForm.controls.lookupKeys.push(new a.cw({name:new a.NI(s.name,[a.kI.required]),value:new a.NI(s.value),private:new a.NI(s.private)}))}))})}handleRequesterValue(o){return 3===o?[1,2]:[o]}handleAccessValue(o){const n=[1,2,4,8,16],s=[];for(let c=n.length-1;c>=0;c--){const p=n[c];o>=p&&(s.push(p),o-=p)}return s}triggerAlert(o,n){this.alertType=o,this.alertMsg=n,this.showAlert=!0}get serviceAccess(){return this.roleForm.get("serviceAccess")}onSubmit(){if(this.roleForm.invalid)return;const o=this.roleForm.getRawValue();if(""===o.name||null===o.name)return;const n={id:o.id,name:o.name,description:o.description,isActive:o.active,roleServiceAccessByRoleId:o.serviceAccess.map((c,p)=>{const v=c.advancedFilters.map(w=>({name:w.expandField,operator:w.expandOperator,value:w.expandValue})),E=c.advancedFilters.map(w=>w.filterOp);return{id:c.id,roleId:this.visibilityArray[p]?o.id:null,serviceId:0===c.service?null:c.service,component:c.component,verbMask:c.access.reduce((w,V)=>w+V,0),requestorMask:c.requester.reduce((w,V)=>w+V,0),filters:v,filterOp:E[0]}}),lookupByRoleId:o.lookupKeys},s={resource:[n]};"edit"===this.type&&n.id?this.roleService.update(n.id,n).pipe((0,ee.K)(c=>(this.triggerAlert("error",c.error.error.message),(0,te._)(()=>new Error(c))))).subscribe(()=>{this.goBack()}):this.roleService.create(s,{fields:"*",related:"role_service_access_by_role_id,lookup_by_role_id"}).pipe((0,ee.K)(c=>(this.triggerAlert("error",c.error.error.context.resource[0].message),(0,te._)(()=>new Error(c))))).subscribe(()=>{this.goBack()})}goBack(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}}).\u0275fac=function(o){return new(o||M)(e.Y36(A.i9),e.Y36(a.qu),e.Y36(P.F0),e.Y36(P.gz),e.Y36(ge.F),e.Y36(he.w))},M.\u0275cmp=e.Xpm({type:M,selectors:[["df-role-details"]],standalone:!0,features:[e.jDz],decls:34,vars:32,consts:[[3,"showAlert","alertType","alertClosed"],[1,"details-section",3,"formGroup","ngSubmit"],["appearance","outline","subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","active",1,"dynamic-width"],["appearance","outline","subscriptSizing","dynamic"],["rows","1","matInput","","formControlName","description"],["formArrayName","serviceAccess",1,"full-width"],[1,"full-width",3,"visible","formArray","roleForm"],["formArrayName","lookupKeys",1,"full-width"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"click"],["mat-flat-button","","color","primary",1,"save-btn"]],template:function(o,n){1&o&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"transloco"),e.qZA(),e.TgZ(3,"df-alert",0),e.NdJ("alertClosed",function(){return n.showAlert=!1}),e._uU(4),e.qZA(),e.TgZ(5,"form",1),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.ALo(6,"async"),e.TgZ(7,"mat-form-field",2)(8,"mat-label"),e._uU(9),e.ALo(10,"transloco"),e.qZA(),e._UZ(11,"input",3),e.YNc(12,ve,3,3,"mat-error",4),e.qZA(),e.TgZ(13,"mat-slide-toggle",5),e._uU(14),e.ALo(15,"transloco"),e.qZA(),e.TgZ(16,"mat-form-field",6)(17,"mat-label"),e._uU(18),e.ALo(19,"transloco"),e.qZA(),e._UZ(20,"textarea",7),e.qZA(),e.TgZ(21,"div",8),e._UZ(22,"df-roles-access",9),e.qZA(),e.TgZ(23,"p"),e._uU(24),e.ALo(25,"transloco"),e.qZA(),e._UZ(26,"df-lookup-keys",10),e.TgZ(27,"div",11)(28,"button",12),e.NdJ("click",function(){return n.goBack()}),e._uU(29),e.ALo(30,"transloco"),e.qZA(),e.TgZ(31,"button",13),e.YNc(32,Ae,3,3,"span",4),e.YNc(33,xe,3,3,"span",4),e.qZA()()()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,18,"roles.rolesOverview.description"),"\n"),e.xp6(2),e.Q6J("showAlert",n.showAlert)("alertType",n.alertType),e.xp6(1),e.hij(" ",n.alertMsg,"\n"),e.xp6(1),e.Tol(e.lcZ(6,20,n.isDarkMode)?"dark-theme":""),e.Q6J("formGroup",n.roleForm),e.xp6(4),e.Oqu(e.lcZ(10,22,"name")),e.xp6(3),e.Q6J("ngIf",n.roleForm.controls.name.hasError("required")),e.xp6(2),e.Oqu(e.lcZ(15,24,"active")),e.xp6(4),e.Oqu(e.lcZ(19,26,"description")),e.xp6(4),e.Q6J("visible",n.visibilityArray)("formArray",n.serviceAccess)("roleForm",n.roleForm),e.xp6(2),e.hij(" ",e.lcZ(25,28,"roles.lookupKeys.description")," "),e.xp6(5),e.hij(" ",e.lcZ(30,30,"cancel")," "),e.xp6(3),e.Q6J("ngIf","create"===n.type),e.xp6(1),e.Q6J("ngIf","edit"===n.type))},dependencies:[Z.Ot,f.Ov,a.u5,a._Y,a.Fj,a.JJ,a.JL,a.Q7,C.c,C.Nt,g.KE,g.hX,g.TO,g.lN,a.UX,a.sg,a.u,a.CE,D.a,y.rP,y.Rr,d.ot,d.lW,W,f.O5,fe.v],encapsulation:2}),M);z=(0,i.gn)([(0,L.c)({checkProperties:!0})],z)},41089:(J,b,l)=>{l.d(b,{v:()=>y});var i=l(65879),a=l(96814),f=l(32296),Z=l(45597),A=l(90590);function g(d,x){if(1&d){const u=i.EpF();i.TgZ(0,"button",5),i.NdJ("click",function(){i.CHM(u);const t=i.oxw(2);return i.KtG(t.dismissAlert())}),i.TgZ(1,"fa-icon",6),i._uU(2),i.qZA()()}if(2&d){const u=i.oxw(2);i.xp6(1),i.Q6J("icon",u.faXmark),i.xp6(1),i.Oqu("alerts.close")}}function D(d,x){if(1&d&&(i.TgZ(0,"div",1),i._UZ(1,"fa-icon",2),i.TgZ(2,"span",3),i.Hsn(3),i.qZA(),i.YNc(4,g,3,2,"button",4),i.qZA()),2&d){const u=i.oxw();i.Tol(u.alertType),i.xp6(1),i.Q6J("icon",u.icon),i.xp6(3),i.Q6J("ngIf",u.dismissible)}}const C=["*"];let y=(()=>{class d{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new i.vpe,this.faXmark=A.g82}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return A.f8k;case"error":return A.$9F;case"warning":return A.RLE;default:return A.sqG}}}return d.\u0275fac=function(u){return new(u||d)},d.\u0275cmp=i.Xpm({type:d,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[i.jDz],ngContentSelectors:C,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(u,R){1&u&&(i.F$t(),i.YNc(0,D,5,4,"div",0)),2&u&&i.Q6J("ngIf",R.showAlert)},dependencies:[a.O5,f.ot,f.RK,Z.uH,Z.BN],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]}),d})()},84870:(J,b,l)=>{l.d(b,{a:()=>U});var T,i=l(97582),a=l(96814),f=l(56223),Z=l(64170),A=l(32296),g=l(25313),D=l(2032),C=l(82599),y=l(45597),d=l(3305),x=l(90590),u=l(42346),R=l(78791),t=l(65879),I=l(65763);function F(m,_){if(1&m&&(t.TgZ(0,"mat-accordion")(1,"mat-expansion-panel")(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t._uU(4),t.ALo(5,"transloco"),t.qZA(),t.TgZ(6,"mat-panel-description"),t._uU(7),t.ALo(8,"transloco"),t.qZA()(),t.GkF(9,3),t.qZA()()),2&m){t.oxw();const h=t.MAs(4);t.xp6(4),t.hij(" ",t.lcZ(5,3,"lookupKeys.label"),""),t.xp6(3),t.Oqu(t.lcZ(8,5,"lookupKeys.desc")),t.xp6(2),t.Q6J("ngTemplateOutlet",h)}}function L(m,_){1&m&&(t.TgZ(0,"mat-header-cell"),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"name")," "))}function q(m,_){1&m&&(t.TgZ(0,"mat-cell",16)(1,"mat-form-field",17)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"input",18),t.qZA()()),2&m&&(t.Q6J("formGroupName",_.index),t.xp6(3),t.Oqu(t.lcZ(4,2,"name")))}function O(m,_){1&m&&(t.TgZ(0,"mat-header-cell"),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"value")," "))}function e(m,_){1&m&&(t.TgZ(0,"mat-cell",16)(1,"mat-form-field",17)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"input",19),t.qZA()()),2&m&&(t.Q6J("formGroupName",_.index),t.xp6(3),t.Oqu(t.lcZ(4,2,"value")))}function P(m,_){1&m&&(t.TgZ(0,"mat-header-cell"),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"private")," "))}function Q(m,_){1&m&&(t.TgZ(0,"mat-cell",16),t._UZ(1,"mat-slide-toggle",20),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.Q6J("formGroupName",_.index),t.xp6(1),t.uIk("aria-label",t.lcZ(2,2,"name")))}function X(m,_){if(1&m){const h=t.EpF();t.TgZ(0,"mat-header-cell")(1,"button",21),t.NdJ("click",function(){t.CHM(h);const K=t.oxw(2);return t.KtG(K.add())}),t.ALo(2,"transloco"),t._UZ(3,"fa-icon",22),t.qZA()()}if(2&m){const h=t.oxw(2);t.xp6(1),t.uIk("aria-label",t.lcZ(2,2,"newEntry")),t.xp6(2),t.Q6J("icon",h.faPlus)}}function N(m,_){if(1&m){const h=t.EpF();t.TgZ(0,"mat-cell",16)(1,"button",23),t.NdJ("click",function(){const j=t.CHM(h).index,H=t.oxw(2);return t.KtG(H.remove(j))}),t._UZ(2,"fa-icon",24),t.qZA()()}if(2&m){const h=_.index,k=t.oxw(2);t.Q6J("formGroupName",h),t.xp6(2),t.Q6J("icon",k.faTrashCan)}}function B(m,_){1&m&&t._UZ(0,"mat-header-row")}function S(m,_){1&m&&t._UZ(0,"mat-row")}function Y(m,_){1&m&&(t.TgZ(0,"tr",25)(1,"td",26),t._uU(2),t.ALo(3,"transloco"),t.qZA()()),2&m&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"lookupKeys.noKeys")," "))}function G(m,_){if(1&m&&(t.ynx(0,4)(1,5),t.TgZ(2,"mat-table",6),t.ynx(3,7),t.YNc(4,L,3,3,"mat-header-cell",8),t.YNc(5,q,6,4,"mat-cell",9),t.BQk(),t.ynx(6,10),t.YNc(7,O,3,3,"mat-header-cell",8),t.YNc(8,e,6,4,"mat-cell",9),t.BQk(),t.ynx(9,11),t.YNc(10,P,3,3,"mat-header-cell",8),t.YNc(11,Q,3,4,"mat-cell",9),t.BQk(),t.ynx(12,12),t.YNc(13,X,4,4,"mat-header-cell",8),t.YNc(14,N,3,2,"mat-cell",9),t.BQk(),t.YNc(15,B,1,0,"mat-header-row",13),t.YNc(16,S,1,0,"mat-row",14),t.YNc(17,Y,4,3,"tr",15),t.qZA(),t.BQk()()),2&m){const h=t.oxw();t.Q6J("formGroup",h.rootForm),t.xp6(2),t.Q6J("dataSource",h.dataSource),t.xp6(13),t.Q6J("matHeaderRowDef",h.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",h.displayedColumns)}}let U=((T=class{constructor(_,h){this.rootFormGroup=_,this.themeService=h,this.displayedColumns=["name","value","private","actions"],this.faTrashCan=x.Vui,this.faPlus=x.r8p,this.showAccordion=!0,this.isDarkMode=this.themeService.darkMode$}ngOnInit(){this.rootForm=this.rootFormGroup.control,this.rootFormGroup.ngSubmit.subscribe(()=>{this.lookupKeys.markAllAsTouched()}),this.lookupKeys=this.rootForm.get("lookupKeys"),this.updateDataSource()}updateDataSource(){this.lookupKeys.controls.forEach(_=>{_.get("id")?.value&&_.get("name")?.disable()}),this.dataSource=new g.by(this.lookupKeys.controls)}add(){this.lookupKeys.push(new f.cw({name:new f.NI("",f.kI.required),value:new f.NI(""),private:new f.NI(!1)})),this.updateDataSource()}remove(_){this.lookupKeys.removeAt(_),this.updateDataSource()}}).\u0275fac=function(_){return new(_||T)(t.Y36(f.sg),t.Y36(I.F))},T.\u0275cmp=t.Xpm({type:T,selectors:[["df-lookup-keys"]],inputs:{showAccordion:"showAccordion"},standalone:!0,features:[t.jDz],decls:5,vars:6,consts:[[1,"lookup-keys-accordion"],[4,"ngIf","ngIfElse"],["lookupKeys",""],[3,"ngTemplateOutlet"],[3,"formGroup"],["formArrayName","lookupKeys"],[3,"dataSource"],["matColumnDef","name"],[4,"matHeaderCellDef"],[3,"formGroupName",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","private"],["matColumnDef","actions","stickyEnd",""],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["class","mat-row no-data-row",4,"matNoDataRow"],[3,"formGroupName"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","formControlName","name"],["matInput","","formControlName","value"],["color","primary","formControlName","private"],["mat-mini-fab","","type","button",1,"save-btn",3,"click"],["size","xl",3,"icon"],["mat-icon-button","","type","button",1,"remove-btn",3,"click"],["size","xs",3,"icon"],[1,"mat-row","no-data-row"],["colspan","4",1,"mat-cell"]],template:function(_,h){if(1&_&&(t.TgZ(0,"div",0),t.ALo(1,"async"),t.YNc(2,F,10,7,"mat-accordion",1),t.YNc(3,G,18,4,"ng-template",null,2,t.W1O),t.qZA()),2&_){const k=t.MAs(4);t.Tol(t.lcZ(1,4,h.isDarkMode)?"dark-theme":""),t.xp6(2),t.Q6J("ngIf",h.showAccordion)("ngIfElse",k)}},dependencies:[f.u5,f.Fj,f.JJ,f.JL,f.UX,f.sg,f.u,f.x0,f.CE,a.O5,a.tP,Z.lN,Z.KE,Z.hX,A.ot,A.RK,A.nh,g.p0,g.BZ,g.fO,g.as,g.w1,g.Dz,g.nj,g.ge,g.ev,g.XQ,g.Gk,g.Ee,D.c,D.Nt,C.rP,C.Rr,y.uH,y.BN,d.To,d.pp,d.ib,d.yz,d.yK,d.u4,u.Ot,a.Ov],styles:[".lookup-keys-accordion[_ngcontent-%COMP%]{padding:16px 0}.mat-column-actions[_ngcontent-%COMP%], .mat-column-private[_ngcontent-%COMP%]{max-width:10%}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}"]}),T);U=(0,i.gn)([(0,R.c)({checkProperties:!0})],U)},15861:(J,b,l)=>{function i(f,Z,A,g,D,C,y){try{var d=f[C](y),x=d.value}catch(u){return void A(u)}d.done?Z(x):Promise.resolve(x).then(g,D)}function a(f){return function(){var Z=this,A=arguments;return new Promise(function(g,D){var C=f.apply(Z,A);function y(x){i(C,g,D,y,d,"next",x)}function d(x){i(C,g,D,y,d,"throw",x)}y(void 0)})}}l.d(b,{Z:()=>a})}}]);