"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[4791],{47787:($,M,o)=>{o.d(M,{S:()=>b});var P=o(31635),m=o(60177),c=o(89417),g=o(88834),f=o(75351),r=o(32102),p=o(99631),h=o(82798),E=o(82765),S=o(33609),v=o(24784),C=o(63035),R=o(49894),e=o(76445),y=o(63281),U=o(25558),t=o(17705),k=o(52868);function _(u,l){if(1&u&&(t.j41(0,"mat-form-field",11)(1,"mat-label"),t.EFF(2),t.nI1(3,"transloco"),t.k0s(),t.nrm(4,"input",12),t.k0s()),2&u){const i=t.XpG(2);t.R7$(2),t.JRh(t.bMT(3,2,"path")),t.R7$(2),t.Y8G("formControl",i.storagePath)}}function n(u,l){if(1&u&&(t.qex(0),t.DNE(1,_,5,4,"mat-form-field",10),t.bVm()),2&u){const i=t.XpG();t.R7$(1),t.Y8G("ngIf",!i.storageServiceId||!i.storageServiceId.getRawValue())}}function s(u,l){if(1&u){const i=t.RV6();t.j41(0,"button",16),t.bIt("click",function(){t.eBV(i);const D=t.XpG(2);return t.Njj(D.deleteCache())}),t.EFF(1),t.nI1(2,"transloco"),t.k0s()}2&u&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"scripts.deleteCache")," "))}function d(u,l){if(1&u){const i=t.RV6();t.j41(0,"div",13)(1,"button",14),t.bIt("click",function(){t.eBV(i);const D=t.XpG();return t.Njj(D.viewLatest())}),t.EFF(2),t.nI1(3,"transloco"),t.k0s(),t.DNE(4,s,3,3,"button",15),t.k0s()}if(2&u){const i=t.XpG();t.R7$(1),t.Y8G("disabled",!i.storageServiceId||!i.storageServiceId.getRawValue()),t.R7$(1),t.SpI(" ",t.bMT(3,3,"scripts.viewLatest")," "),t.R7$(2),t.Y8G("ngIf",i.cache)}}function T(u,l){1&u&&(t.j41(0,"span"),t.EFF(1,"Script Contents"),t.k0s())}o(36225);let b=class j{constructor(l,i,a,D,O){this.dialog=l,this.fileService=i,this.cacheService=a,this.baseService=D,this.themeService=O,this.storageServices=[],this.checked=!1,this.isDarkMode=this.themeService.darkMode$,this.baseService.getAll({additionalParams:[{key:"group",value:"source control,file"}]}).subscribe(I=>{this.storageServices=I.services})}ngOnInit(){this.storageServiceId.getRawValue()&&this.storagePath.addValidators([c.k0.required]),this.storageServiceId.valueChanges.subscribe(l=>{this.storagePath.reset(),l?this.storagePath.addValidators([c.k0.required]):this.storagePath.hasValidator(c.k0.required)&&this.storagePath.removeValidators([c.k0.required]),this.storagePath.updateValueAndValidity()})}fileUpload(l){const i=l.target;i.files&&(0,C.Sj)(i.files[0]).subscribe(a=>{this.content.setValue(a)})}githubImport(){this.dialog.open(e.z).afterClosed().subscribe(i=>{i&&this.content.setValue(window.atob(i.data.content))})}viewLatest(){const l=`${this.storageServices.find(i=>i.id===this.storageServiceId.getRawValue())?.name}/${this.storagePath.getRawValue()}`;l.endsWith(".json")?this.fileService.downloadJson(l).subscribe(i=>this.content.setValue(i)):this.fileService.downloadFile(l).pipe((0,U.n)(i=>(0,C.Sj)(i))).subscribe(i=>this.content.setValue(i))}deleteCache(){this.cache&&this.cacheService.delete(`_event/${this.cache}`,{snackbarSuccess:"scripts.deleteCacheSuccessMsg"}).subscribe()}static{this.\u0275fac=function(i){return new(i||j)(t.rXU(f.bZ),t.rXU(v.qJ),t.rXU(v.j8),t.rXU(v.qJ),t.rXU(k.n))}}static{this.\u0275cmp=t.VBU({type:j,selectors:[["df-script-editor"]],inputs:{isScript:"isScript",cache:"cache",type:"type",storageServiceId:"storageServiceId",storagePath:"storagePath",content:"content"},standalone:!0,features:[t.aNF],decls:18,vars:18,consts:[[1,"details-section"],[1,"actions","full-width"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],["type","button","mat-flat-button","",1,"save-btn",3,"disabled","click"],[3,"ngModel","ngModelChange"],[4,"ngIf"],["class","actions",4,"ngIf"],[1,"content"],[1,"full-width",3,"formControl","mode"],["class","full-width","subscriptSizing","dynamic",4,"ngIf"],["subscriptSizing","dynamic",1,"full-width"],["matInput","",3,"formControl"],[1,"actions"],["mat-flat-button","","color","primary","type","button",3,"disabled","click"],["mat-flat-button","","color","primary","type","button",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","button",3,"click"]],template:function(i,a){if(1&i){const D=t.RV6();t.j41(0,"div",0),t.nI1(1,"async"),t.j41(2,"div",1)(3,"input",2,3),t.bIt("change",function(I){return a.fileUpload(I)}),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){t.eBV(D);const I=t.sdS(4);return t.Njj(I.click())}),t.EFF(6),t.nI1(7,"transloco"),t.k0s(),t.j41(8,"button",4),t.bIt("click",function(){return a.githubImport()}),t.EFF(9),t.nI1(10,"transloco"),t.k0s()(),t.j41(11,"mat-checkbox",5),t.bIt("ngModelChange",function(I){return a.checked=I}),t.EFF(12," Add path to file"),t.k0s(),t.DNE(13,n,2,1,"ng-container",6),t.DNE(14,d,5,5,"div",7),t.j41(15,"div",8),t.DNE(16,T,2,0,"span",6),t.nrm(17,"df-ace-editor",9),t.k0s()()}2&i&&(t.HbH(t.bMT(1,12,a.isDarkMode)?"dark-theme":""),t.R7$(5),t.Y8G("disabled",!a.storageServiceId),t.R7$(1),t.SpI(" ",t.bMT(7,14,"desktopFile")," "),t.R7$(2),t.Y8G("disabled",!a.storageServiceId),t.R7$(1),t.SpI(" ",t.bMT(10,16,"githubFile")," "),t.R7$(2),t.Y8G("ngModel",a.checked),t.R7$(2),t.Y8G("ngIf",a.checked),t.R7$(1),t.Y8G("ngIf",a.storageServiceId.getRawValue()),t.R7$(2),t.Y8G("ngIf",a.isScript),t.R7$(1),t.Y8G("formControl",a.content)("mode",a.type.getRawValue()))},dependencies:[g.Hl,g.$z,S.Kj,m.bT,r.RG,r.rl,r.nJ,h.Ve,E.g7,E.So,c.YN,c.me,c.BC,c.vS,f.hM,p.fS,p.fg,y.s,m.Jj,c.X1,c.l_],styles:[".actions[_ngcontent-%COMP%]{display:flex;gap:16px}.content[_ngcontent-%COMP%]{margin-top:8px;display:flex;flex-direction:column;gap:6px;width:100%}.content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}"]})}};b=(0,P.Cg)([(0,R.d)({checkProperties:!0})],b)},76445:($,M,o)=>{o.d(M,{z:()=>G});var P=o(31635),m=o(75351),c=o(88834),g=o(99631),f=o(32102),r=o(89417),p=o(99437),h=o(18810),E=o(60177),S=o(33609),v=o(24784),C=o(49894),e=o(17705);function U(_,n){1&_&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&_&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"scripts.errors.githubImport")," "))}function t(_,n){1&_&&(e.j41(0,"mat-form-field")(1,"mat-label"),e.EFF(2,"GitHub Username"),e.k0s(),e.nrm(3,"input",9),e.k0s())}function k(_,n){1&_&&(e.j41(0,"mat-form-field")(1,"mat-label"),e.EFF(2,"GitHub Token"),e.k0s(),e.nrm(3,"input",10),e.k0s())}o(36225);let G=class F{constructor(n,s,d){this.githubService=n,this.formBuilder=s,this.dialogRef=d,this.isGitRepoPrivate=!1,this.formGroup=s.group({url:["",[r.k0.required,this.urlValidator]]})}ngOnInit(){this.formGroup.controls.url.valueChanges.subscribe(n=>{if(function R(_){let n;try{n=new URL(_)}catch{return!1}return"http:"===n.protocol||"https:"===n.protocol}(n)&&(n.indexOf(".js")>0||n.indexOf(".py")>0||n.indexOf(".php")>0||n.indexOf(".txt")>0)&&n.includes("github")){const d=n.substring(n.indexOf(".com/")+5).split("/");this.repoOwner=d[0],this.repoName=d[1],this.fileName=d.slice(4).join("/"),this.githubService.get(`${this.repoOwner}/${this.repoName}`,{snackbarError:"server",snackbarSuccess:"getScriptSuccessMsg",includeCacheControl:!1}).pipe((0,p.W)(b=>(this.isGitRepoPrivate=!0,this.formGroup.addControl("username",this.formBuilder.control("",r.k0.required)),this.formGroup.addControl("password",this.formBuilder.control("",r.k0.required)),(0,h.$)(()=>new Error(b))))).subscribe(b=>{this.isGitRepoPrivate=b.private})}})}urlValidator(n){const s=n.value;return(s.indexOf(".js")>0||s.indexOf(".py")>0||s.indexOf(".php")>0||s.indexOf(".txt")>0)&&s.includes("github")?null:{invalidUrl:!0}}onFileUrlChange(n){}onUpload(){this.formGroup.invalid||this.githubService.getFileContent(`${this.repoOwner}/${this.repoName}/contents/${this.fileName}`,this.formGroup.value.username,this.formGroup.value.password).subscribe(s=>{this.dialogRef.close({data:s})})}static{this.\u0275fac=function(s){return new(s||F)(e.rXU(v.J4),e.rXU(r.ok),e.rXU(m.CP))}}static{this.\u0275cmp=e.VBU({type:F,selectors:[["df-scripts-github-dialog"]],standalone:!0,features:[e.aNF],decls:18,vars:10,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"details-section",3,"formGroup"],["subscriptSizing","dynamic"],["matInput","","formControlName","url","placeholder","https://github.com/user/repo/blob/file.json"],[4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],["matInput","","formControlName","username","placeholder","Username","type","text"],["matInput","","formControlName","password","placeholder","Personal Access Token","type","text"]],template:function(s,d){1&s&&(e.j41(0,"h1",0),e.EFF(1,"Import a script file from GitHub"),e.k0s(),e.j41(2,"div",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),e.EFF(6,"GitHub File URL"),e.k0s(),e.nrm(7,"input",4),e.DNE(8,U,3,3,"mat-error",5),e.k0s(),e.DNE(9,t,4,0,"mat-form-field",5),e.DNE(10,k,4,0,"mat-form-field",5),e.k0s()(),e.j41(11,"div",6)(12,"button",7),e.EFF(13),e.nI1(14,"transloco"),e.k0s(),e.j41(15,"button",8),e.bIt("click",function(){return d.onUpload()}),e.EFF(16),e.nI1(17,"transloco"),e.k0s()()),2&s&&(e.R7$(3),e.Y8G("formGroup",d.formGroup),e.R7$(5),e.Y8G("ngIf",null==d.formGroup.controls.url.errors?null:d.formGroup.controls.url.errors.invalidUrl),e.R7$(1),e.Y8G("ngIf",d.formGroup.contains("username")),e.R7$(1),e.Y8G("ngIf",d.formGroup.contains("password")),e.R7$(3),e.JRh(e.bMT(14,6,"close")),e.R7$(3),e.SpI(" ",e.bMT(17,8,"upload")," "))},dependencies:[c.Hl,c.$z,m.hM,m.tx,m.BI,m.Yi,m.E7,f.RG,f.rl,f.nJ,f.TL,g.fS,g.fg,r.X1,r.qT,r.me,r.BC,r.cb,r.j4,r.JD,E.bT,S.Kj]})}};G=(0,P.Cg)([(0,C.d)({checkProperties:!0})],G)},59757:($,M,o)=>{o.d(M,{$:()=>c,l:()=>m});var P=o(60169);function m(g){return Object.values((0,P.SM)(g)).flatMap(f=>Object.entries(f).map(([r,p])=>{let h=[];return h=p.parameter?p.endpoints.flatMap(E=>{const S=E.match(/{(.*?)}/);if(S){const v=S[1];return[E,...(p.parameter?.[v]||[]).map(R=>E.replace(`{${v}}`,R))]}return E}):p.endpoints,{name:r,endpoints:[...new Set(h)]}}))}function c(g){const f=[],r=new Set;for(const p of g){const h=p.split(".")[0];r.has(h)||(r.add(h),f.push(`${h}.*`)),f.push(p)}return f}}}]);