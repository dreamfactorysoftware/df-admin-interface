"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[8514],{88514:(y,E,r)=>{r.r(E),r.d(E,{DfSchedulerDetailsComponent:()=>D});var t=r(31635),n=r(89417),d=r(23472),v=r(90124),u=r(24784),T=r(33609),m=r(60177),h=r(96850),b=r(99631),i=r(82798),g=r(30450),c=r(88834),_=r(63281),f=r(9709),R=r(49894),S=r(51425),C=r(99437),O=r(18810),e=r(17705),P=r(18498),A=r(52868),I=r(32102),G=r(86600);function k(l,o){if(1&l&&(e.j41(0,"mat-option",22),e.EFF(1),e.k0s()),2&l){const s=o.$implicit;e.Y8G("value",s.id),e.R7$(1),e.SpI(" ",s.name," ")}}function B(l,o){if(1&l&&(e.j41(0,"mat-option",22),e.EFF(1),e.k0s()),2&l){const s=o.$implicit;e.Y8G("value",s),e.R7$(1),e.JRh(s)}}function F(l,o){if(1&l&&(e.j41(0,"mat-form-field",23)(1,"mat-label"),e.EFF(2),e.nI1(3,"transloco"),e.k0s(),e.j41(4,"mat-select",24),e.DNE(5,B,2,2,"mat-option",10),e.k0s()()),2&l){const s=e.XpG();e.R7$(2),e.JRh(e.bMT(3,2,"scheduler.form.label.component")),e.R7$(3),e.Y8G("ngForOf",s.componentDropdownOptions)}}function L(l,o){1&l&&(e.qex(0),e.j41(1,"mat-form-field",4)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.nrm(5,"textarea",25),e.k0s(),e.bVm()),2&l&&(e.R7$(3),e.JRh(e.bMT(4,1,"scheduler.form.label.payload")))}r(36225);const U=function(l){return{label:l}};let D=class M{constructor(o,s,a,p,W,j){this.service=o,this.formBuilder=s,this.activatedRoute=a,this.router=p,this.accessListService=W,this.themeService=j,this.relatedParam="task_log_by_task_id",this.componentDropdownOptions=[],this.log="",this.alertMsg="",this.showAlert=!1,this.alertType="error",this.isDarkMode=this.themeService.darkMode$}ngOnInit(){this.formGroup=this.formBuilder.group({name:["",n.k0.required],description:[""],active:[!0,n.k0.required],serviceId:["",n.k0.required],component:["",n.k0.required],method:["GET",n.k0.required],frequency:[]}),this.activatedRoute.data.subscribe(o=>{this.userServicesDropdownOptions=o.data.resource}),this.activatedRoute.data.subscribe(o=>{this.scheduleToEdit=o.schedulerObject,this.scheduleToEdit&&(this.log=this.scheduleToEdit.taskLogByTaskId?.content??"",this.getServiceAccessList(this.scheduleToEdit.serviceId),this.formGroup.setValue({name:this.scheduleToEdit.name,description:this.scheduleToEdit.description,active:this.scheduleToEdit.isActive,serviceId:this.scheduleToEdit.serviceId,component:this.scheduleToEdit.component,method:this.scheduleToEdit.verb,frequency:this.scheduleToEdit.frequency}),"GET"!==this.scheduleToEdit.verb&&this.addPayloadField(this.scheduleToEdit.payload))}),this.formGroup.get("method")?.valueChanges.subscribe(o=>{"GET"===o?this.removePayloadField():this.formGroup.contains("payload")||this.addPayloadField()}),this.formGroup.get("serviceId")?.valueChanges.subscribe(o=>{this.getServiceAccessList(o)})}triggerAlert(o,s){this.alertType=o,this.alertMsg=s,this.showAlert=!0}onCancel(){this.router.navigate([d.b.SYSTEM_SETTINGS,d.b.SCHEDULER])}onSubmit(){if(!this.formGroup.invalid&&!this.formGroup.pristine)if(typeof this.scheduleToEdit>"u"){const o=this.assemblePayload();this.service.create({resource:[o]},{snackbarSuccess:"scheduler.alerts.createdSuccess",fields:"*",related:this.relatedParam}).pipe((0,C.W)(s=>(this.triggerAlert("error",s.error.error.context.resource[0].message),(0,O.$)(()=>new Error(s))))).subscribe(()=>this.router.navigate([d.b.SYSTEM_SETTINGS,d.b.SCHEDULER]))}else if(this.scheduleToEdit){const o=this.assemblePayload();this.service.update(this.scheduleToEdit.id,o,{snackbarSuccess:"scheduler.alerts.updateSuccess",fields:"*",related:this.relatedParam}).pipe((0,C.W)(s=>(this.triggerAlert("error",s.error.error.message),(0,O.$)(()=>new Error(s))))).subscribe(()=>this.router.navigate([d.b.SYSTEM_SETTINGS,d.b.SCHEDULER]))}}addPayloadField(o){this.formGroup.addControl("payload",this.formBuilder.control(o??"",[v.V]))}removePayloadField(){this.formGroup.removeControl("payload")}getServiceAccessList(o){const s=this.userServicesDropdownOptions.find(a=>a.id===o);this.selectedService=s,s&&this.accessListService.get(s.name,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(a=>{this.componentDropdownOptions=a.resource})}getVerbMask(o){switch(o){case"GET":default:return 1;case"POST":return 2;case"PUT":return 4;case"PATCH":return 8;case"DELETE":return 16}}assemblePayload(){if(this.selectedService){const o={component:this.formGroup.value.component,description:this.formGroup.value.description,frequency:this.formGroup.value.frequency,isActive:this.formGroup.value.active,name:this.formGroup.value.name,payload:this.formGroup.value.payload??null,serviceId:this.formGroup.value.serviceId,serviceName:this.selectedService.name,verb:this.formGroup.value.method,service:{id:this.formGroup.value.serviceId,name:this.selectedService.name,label:this.selectedService.label,description:this.selectedService.description,type:this.selectedService.type,components:this.componentDropdownOptions},verbMask:this.getVerbMask(this.formGroup.value.method)};return this.scheduleToEdit?{lastModifiedDate:this.scheduleToEdit.lastModifiedDate,lastModifiedById:this.scheduleToEdit.lastModifiedById,hasLog:!!this.scheduleToEdit.taskLogByTaskId,createdDate:this.scheduleToEdit.createdDate,createdById:this.scheduleToEdit.createdById,id:this.scheduleToEdit.id,...o}:{...o,id:null}}return null}static{this.\u0275fac=function(s){return new(s||M)(e.rXU(u.K),e.rXU(n.ok),e.rXU(P.nX),e.rXU(P.Ix),e.rXU(u.qJ),e.rXU(A.n))}}static{this.\u0275cmp=e.VBU({type:M,selectors:[["df-scheduler"]],standalone:!0,features:[e.aNF],decls:54,vars:49,consts:[[3,"showAlert","alertType","alertClosed"],["dynamicHeight","","mat-stretch-tabs","false","mat-align-tabs","start"],["label","Basic"],[1,"details-section",3,"formGroup","ngSubmit"],["appearance","outline","subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","placeholder","Name","formControlName","name"],["color","primary","formControlName","active",1,"dynamic-width"],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["rows","1","matInput","","placeholder","Description","formControlName","description"],["formControlName","serviceId"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic","class","dynamic-width",4,"ngIf"],["matInput","","type","number","formControlName","frequency"],[4,"ngIf"],["formControlName","method",1,"dynamic-width",3,"schema"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"click"],["mat-flat-button","",1,"save-btn"],["label","Log"],[1,"details-section"],[1,"full-width",3,"readonly","value"],["type","button","mat-flat-button","",1,"schema","cancel-btn",3,"click"],[3,"value"],["subscriptSizing","dynamic",1,"dynamic-width"],["formControlName","component"],["rows","1","matInput","","formControlName","payload"]],template:function(s,a){1&s&&(e.j41(0,"div"),e.nI1(1,"async"),e.j41(2,"df-alert",0),e.bIt("alertClosed",function(){return a.showAlert=!1}),e.EFF(3),e.k0s(),e.j41(4,"mat-tab-group",1)(5,"mat-tab",2)(6,"h4"),e.EFF(7),e.nI1(8,"transloco"),e.k0s(),e.j41(9,"form",3),e.bIt("ngSubmit",function(){return a.onSubmit()}),e.j41(10,"mat-form-field",4)(11,"mat-label"),e.EFF(12),e.nI1(13,"transloco"),e.k0s(),e.nrm(14,"input",5),e.k0s(),e.j41(15,"mat-slide-toggle",6),e.EFF(16),e.nI1(17,"transloco"),e.k0s(),e.j41(18,"mat-form-field",7)(19,"mat-label"),e.EFF(20),e.nI1(21,"transloco"),e.k0s(),e.nrm(22,"textarea",8),e.k0s(),e.j41(23,"mat-form-field",4)(24,"mat-label"),e.EFF(25),e.nI1(26,"transloco"),e.k0s(),e.j41(27,"mat-select",9),e.DNE(28,k,2,2,"mat-option",10),e.k0s()(),e.DNE(29,F,6,4,"mat-form-field",11),e.j41(30,"mat-form-field",4)(31,"mat-label"),e.EFF(32),e.nI1(33,"transloco"),e.k0s(),e.nrm(34,"input",12),e.k0s(),e.DNE(35,L,6,3,"ng-container",13),e.nrm(36,"df-verb-picker",14),e.nI1(37,"transloco"),e.j41(38,"div",15)(39,"button",16),e.bIt("click",function(){return a.onCancel()}),e.EFF(40),e.nI1(41,"transloco"),e.k0s(),e.j41(42,"button",17),e.EFF(43),e.nI1(44,"transloco"),e.k0s()()()(),e.j41(45,"mat-tab",18)(46,"div",19)(47,"p"),e.EFF(48),e.nI1(49,"transloco"),e.k0s(),e.nrm(50,"df-ace-editor",20),e.j41(51,"button",21),e.bIt("click",function(){return a.onCancel()}),e.EFF(52),e.nI1(53,"transloco"),e.k0s()()()()()),2&s&&(e.HbH(e.bMT(1,23,a.isDarkMode)?"dark-theme":""),e.R7$(2),e.Y8G("showAlert",a.showAlert)("alertType",a.alertType),e.R7$(1),e.SpI(" ",a.alertMsg," "),e.R7$(4),e.JRh(e.bMT(8,25,"scheduler.taskOverviewSubtitle")),e.R7$(2),e.Y8G("formGroup",a.formGroup),e.R7$(3),e.JRh(e.bMT(13,27,"scheduler.form.label.name")),e.R7$(4),e.JRh(e.bMT(17,29,"scheduler.form.label.active")),e.R7$(4),e.JRh(e.bMT(21,31,"scheduler.form.label.description")),e.R7$(5),e.JRh(e.bMT(26,33,"scheduler.form.label.service")),e.R7$(3),e.Y8G("ngForOf",a.userServicesDropdownOptions),e.R7$(1),e.Y8G("ngIf",a.componentDropdownOptions.length),e.R7$(3),e.JRh(e.bMT(33,35,"scheduler.form.label.frequency")),e.R7$(3),e.Y8G("ngIf",a.formGroup.controls.payload),e.R7$(1),e.Y8G("schema",e.eq3(47,U,e.bMT(37,37,"scheduler.form.label.method"))),e.R7$(4),e.SpI(" ",e.bMT(41,39,"cancel")," "),e.R7$(3),e.SpI(" ",e.bMT(44,41,"save")," "),e.R7$(5),e.Lme(" ",e.bMT(49,43,"scheduler.logs.statusCode"),": ",null==a.scheduleToEdit||null==a.scheduleToEdit.taskLogByTaskId?null:a.scheduleToEdit.taskLogByTaskId.statusCode," "),e.R7$(2),e.Y8G("readonly",!0)("value",a.log),e.R7$(2),e.SpI(" ",e.bMT(53,45,"goBack")," "))},dependencies:[m.Jj,c.Hl,c.$z,b.fS,b.fg,I.rl,I.nJ,h.RI,h.mq,h.T8,i.Ve,i.VO,G.wT,g.mV,g.sG,m.bT,m.pM,T.Kj,n.X1,n.qT,n.me,n.Q0,n.BC,n.cb,n.j4,n.JD,_.s,f.N,S.W],encapsulation:2})}};D=(0,t.Cg)([(0,R.d)({checkProperties:!0})],D)},51425:(y,E,r)=>{r.d(E,{W:()=>b});var t=r(17705),n=r(60177),d=r(88834),v=r(20060),u=r(45383);function T(i,g){if(1&i){const c=t.RV6();t.j41(0,"button",5),t.bIt("click",function(){t.eBV(c);const f=t.XpG(2);return t.Njj(f.dismissAlert())}),t.j41(1,"fa-icon",6),t.EFF(2),t.k0s()()}if(2&i){const c=t.XpG(2);t.R7$(1),t.Y8G("icon",c.faXmark),t.R7$(1),t.JRh("alerts.close")}}function m(i,g){if(1&i&&(t.j41(0,"div",1),t.nrm(1,"fa-icon",2),t.j41(2,"span",3),t.SdG(3),t.k0s(),t.DNE(4,T,3,2,"button",4),t.k0s()),2&i){const c=t.XpG();t.HbH(c.alertType),t.R7$(1),t.Y8G("icon",c.icon),t.R7$(3),t.Y8G("ngIf",c.dismissible)}}const h=["*"];let b=(()=>{class i{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new t.bkB,this.faXmark=u.Jyw}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return u.SGM;case"error":return u.rfe;case"warning":return u.tUE;default:return u.iW_}}static{this.\u0275fac=function(_){return new(_||i)}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[t.aNF],ngContentSelectors:h,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(_,f){1&_&&(t.NAR(),t.DNE(0,m,5,4,"div",0)),2&_&&t.Y8G("ngIf",f.showAlert)},dependencies:[n.bT,d.Hl,d.iY,v.dX,v.aY],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]})}}return i})()}}]);