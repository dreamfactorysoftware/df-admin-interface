"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[6070],{16070:(ne,T,o)=>{o.r(T),o.d(T,{DfScriptDetailsComponent:()=>D});var j=o(31635),R=o(49894),b=o(30450),u=o(33609),p=o(32102),f=o(82798),l=o(60177),d=o(19468);const k=[{label:(0,u.Tl)("scriptTypes.nodejs"),value:d.Q.NODEJS,extension:"js"},{label:(0,u.Tl)("scriptTypes.php"),value:d.Q.PHP,extension:"php"},{label:(0,u.Tl)("scriptTypes.python"),value:d.Q.PYTHON,extension:"py"},{label:(0,u.Tl)("scriptTypes.python3"),value:d.Q.PYTHON3,extension:"py"}];var r=o(89417),v=o(88834),G=o(47787),$=o(60850),g=o(99631),O=o(99172),P=o(96354),V=o(59757),S=o(24784),M=o(9159),_=o(86600),Y=o(20060),m=o(9454),x=o(36225),X=o(25558),J=o(63035),e=o(17705),y=o(52868);function B(s,n){if(1&s&&(e.j41(0,"mat-option",12),e.EFF(1),e.k0s()),2&s){const t=n.$implicit;e.Y8G("value",t.label),e.R7$(1),e.SpI(" ",t.label," ")}}function L(s,n){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"form",1),e.nI1(2,"async"),e.j41(3,"mat-accordion")(4,"mat-expansion-panel",2)(5,"mat-expansion-panel-header")(6,"mat-panel-title"),e.EFF(7," Link to Service "),e.k0s(),e.nrm(8,"mat-panel-description"),e.k0s(),e.j41(9,"mat-form-field",3)(10,"mat-label"),e.EFF(11,"Select Service"),e.k0s(),e.j41(12,"mat-select",4),e.DNE(13,B,2,2,"mat-option",5),e.k0s()(),e.j41(14,"mat-form-field",3)(15,"mat-label"),e.EFF(16,"Repository: "),e.k0s(),e.nrm(17,"input",6),e.k0s(),e.j41(18,"mat-form-field",3)(19,"mat-label"),e.EFF(20,"Branch/Tag: "),e.k0s(),e.nrm(21,"input",7),e.k0s(),e.j41(22,"mat-form-field",3)(23,"mat-label"),e.EFF(24,"Path"),e.k0s(),e.nrm(25,"input",8),e.k0s(),e.j41(26,"div",9)(27,"button",10),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.onViewLatest())}),e.nrm(28,"i",11),e.EFF(29," View Latest "),e.k0s(),e.j41(30,"button",10),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.onDeleteCache())}),e.nrm(31,"i",11),e.EFF(32," Delete Cache "),e.k0s()()()()(),e.bVm()}if(2&s){const t=e.XpG();e.R7$(1),e.HbH(e.bMT(2,5,t.isDarkMode)?"dark-theme":""),e.Y8G("formGroup",t.roleForm),e.R7$(3),e.Y8G("expanded",!1),e.R7$(9),e.Y8G("ngForOf",t.storageServices)}}let I=class C{constructor(n,t,i,a){this.themeService=n,this.cacheService=t,this.baseService=i,this.crudService=a,this.storageServices=[],this.selectType=!1,this.isDarkMode=this.themeService.darkMode$,this.roleForm=new r.gE({serviceList:new r.MJ(""),repoInput:new r.MJ(""),branchInput:new r.MJ(""),pathInput:new r.MJ("")}),this.baseService.getAll({additionalParams:[{key:"group",value:"source control,file"}]}).subscribe(c=>{this.storageServices=c.services})}ngOnInit(){this.updateDataSource()}ngOnChanges(n){n.storageServiceId&&this.findServiceById()}findServiceById(){const n=this.storageServices.some(t=>"github"===t.type);this.selectType=n}updateDataSource(){}onViewLatest(){const n=this.roleForm.getRawValue(),F=`${n.serviceList??""}/_repo/${n.repoInput??""}?branch=${n.branchInput??""}&content=1&path=${n.pathInput??""}`;F.endsWith(".json")?this.baseService.downloadJson(F).subscribe(h=>this.content.setValue(h)):this.baseService.downloadFile(F).pipe((0,X.n)(h=>(0,J.Sj)(h))).subscribe(h=>this.content.setValue(h))}onDeleteCache(){this.cache&&this.cacheService.delete(`_event/${this.cache}`,{snackbarSuccess:"scripts.deleteCacheSuccessMsg"}).subscribe()}static{this.\u0275fac=function(t){return new(t||C)(e.rXU(y.n),e.rXU(S.j8),e.rXU(S.qJ),e.rXU(S.NO))}}static{this.\u0275cmp=e.VBU({type:C,selectors:[["df-link-service"]],inputs:{cache:"cache",storageServiceId:"storageServiceId",storagePath:"storagePath",content:"content"},standalone:!0,features:[e.Jv_([x.h]),e.OA$,e.aNF],decls:1,vars:1,consts:[[4,"ngIf"],[1,"details-section",3,"formGroup"],[3,"expanded"],["appearance","outline","subscriptSizing","dynamic",1,"full-width","form-field-gap"],["formControlName","serviceList"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","placeholder","path","formControlName","repoInput"],["matInput","","type","text","placeholder","path","formControlName","branchInput"],["matInput","","type","text","placeholder","path","formControlName","pathInput"],[1,"full-width","action-bar"],["mat-flat-button","","type","button","color","primary",1,"save-btn",3,"click"],[1,"fa","fa-refresh"],[3,"value"]],template:function(t,i){1&t&&e.DNE(0,L,33,7,"ng-container",0),2&t&&e.Y8G("ngIf",i.selectType)},dependencies:[p.RG,p.rl,p.nJ,v.Hl,v.$z,M.tP,g.fS,g.fg,f.Ve,f.VO,_.wT,b.mV,Y.dX,m.MY,m.BS,m.GK,m.Z2,m.WN,m.Q6,l.Jj,_.Sy,r.X1,r.qT,r.me,r.BC,r.cb,r.j4,r.JD,l.MD,l.Sq,l.bT],styles:[".lnik-service-accordion[_ngcontent-%COMP%]{padding:16px 0}.mat-column-actions[_ngcontent-%COMP%], .mat-column-private[_ngcontent-%COMP%]{max-width:10%}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}.form-field-gap[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px}"]})}};I=(0,j.Cg)([(0,R.d)({checkProperties:!0})],I);var U=o(60169),N=o(18498);function A(s,n){if(1&s&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&s){const t=n.$implicit;e.Y8G("value",t),e.R7$(1),e.SpI(" ",t," ")}}function H(s,n){if(1&s&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&s){const t=n.$implicit;e.Y8G("value",t),e.R7$(1),e.SpI(" ",t," ")}}function w(s,n){if(1&s&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&s){const t=n.$implicit;e.Y8G("value",t),e.R7$(1),e.SpI(" ",t," ")}}function z(s,n){1&s&&(e.qex(0),e.EFF(1,"Table Name"),e.bVm())}function Q(s,n){1&s&&e.EFF(0,"Name")}function W(s,n){if(1&s&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&s){const t=n.$implicit;e.Y8G("value",t),e.R7$(1),e.SpI(" ",t," ")}}function K(s,n){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"mat-form-field",3)(2,"mat-label"),e.DNE(3,z,2,0,"ng-container",1),e.DNE(4,Q,1,0,"ng-template",null,18,e.C5r),e.k0s(),e.j41(6,"mat-select",13),e.bIt("valueChange",function(a){e.eBV(t);const c=e.XpG(2);return e.Njj(c.selectTable=a)})("selectionChange",function(){e.eBV(t);const a=e.XpG(2);return e.Njj(a.selectedTable())}),e.DNE(7,W,2,2,"mat-option",5),e.k0s()(),e.bVm()}if(2&s){const t=e.sdS(5),i=e.XpG(2);e.R7$(3),e.Y8G("ngIf","table"===i.tableProcedureFlag)("ngIfElse",t),e.R7$(3),e.Y8G("value",i.selectTable),e.R7$(1),e.Y8G("ngForOf",i.tableOptions)}}function Z(s,n){if(1&s&&(e.qex(0),e.j41(1,"mat-form-field",19)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.nrm(5,"input",20),e.k0s(),e.bVm()),2&s){const t=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,2,"scripts.scriptName")),e.R7$(2),e.Y8G("value",t.completeScriptName)}}function q(s,n){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"mat-form-field",3)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.j41(5,"mat-select",13),e.bIt("valueChange",function(a){e.eBV(t);const c=e.XpG();return e.Njj(c.selectedServiceItem=a)})("selectionChange",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.selectedServiceItemEvent())}),e.DNE(6,A,2,2,"mat-option",5),e.k0s()(),e.j41(7,"mat-form-field",14)(8,"mat-label"),e.EFF(9),e.nI1(10,"transloco"),e.k0s(),e.j41(11,"mat-select",13),e.bIt("valueChange",function(a){e.eBV(t);const c=e.XpG();return e.Njj(c.selectedEventItem=a)})("selectionChange",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.selectedEventItemEvent())}),e.DNE(12,H,2,2,"mat-option",5),e.k0s()(),e.j41(13,"mat-form-field",14)(14,"mat-label"),e.EFF(15),e.nI1(16,"transloco"),e.k0s(),e.j41(17,"mat-select",15),e.bIt("valueChange",function(a){e.eBV(t);const c=e.XpG();return e.Njj(c.selectedRouteItem=a)}),e.DNE(18,w,2,2,"mat-option",5),e.k0s()(),e.DNE(19,K,8,4,"ng-container",16),e.DNE(20,Z,6,4,"ng-container",16),e.bVm()}if(2&s){const t=e.XpG();e.R7$(3),e.JRh(e.bMT(4,11,"service")),e.R7$(2),e.Y8G("value",t.selectedServiceItem),e.R7$(1),e.Y8G("ngForOf",t.storeServiceArray),e.R7$(3),e.JRh(e.bMT(10,13,"scripts.scriptType")),e.R7$(2),e.Y8G("value",t.selectedEventItem),e.R7$(1),e.Y8G("ngForOf",t.ungroupedEventItems),e.R7$(3),e.JRh(e.bMT(16,15,"scripts.scriptMethod")),e.R7$(2),e.Y8G("value",t.selectedRouteItem),e.R7$(1),e.Y8G("ngForOf",t.ungroupedRouteOptions),e.R7$(1),e.Y8G("ngIf",t.tableOptions),e.R7$(1),e.Y8G("ngIf",t.completeScriptName)}}function ee(s,n){if(1&s&&(e.j41(0,"mat-form-field",19)(1,"mat-label"),e.EFF(2),e.nI1(3,"transloco"),e.k0s(),e.nrm(4,"input",21),e.k0s()),2&s){const t=e.XpG();e.R7$(2),e.JRh(e.bMT(3,2,"scripts.tableName")),e.R7$(2),e.Y8G("value",t.completeScriptName)}}function te(s,n){if(1&s&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&s){const t=n.$implicit;e.Y8G("value",t.value),e.R7$(1),e.SpI(" ",t.label," ")}}let D=class E{constructor(n,t,i,a,c){this.activatedRoute=n,this.fb=t,this.router=i,this.eventScriptService=a,this.themeService=c,this.types=k,this.type="create",this.loaded=!1,this.isDarkMode=this.themeService.darkMode$,this.storeServiceArray=[],this.ungroupedEventItems=[],this.scriptForm=this.fb.group({name:[""],type:["nodejs",[r.k0.required]],content:[""],storageServiceId:[],storagePath:[""],isActive:[!1],allow_event_modification:[!1]})}ngOnInit(){this.activatedRoute.data.subscribe(({data:n,type:t})=>{if(this.type=t,"edit"===t){this.scriptDetails=n;let i=Object.keys(n).reduce((a,c)=>({...a,[(0,U.F0)(c)]:n[c]}),{});i={...i,isActive:n.isActive},this.scriptForm.patchValue(i),this.scriptForm.controls.name.disable(),this.completeScriptName=n.name}else this.scriptEvents=(0,V.l)(n),this.unGroupedEvents=n,this.storageServices=n,this.storeServiceArray=Object.keys(this.storageServices)}),this.scriptEventsOptions=this.scriptForm.controls.name.valueChanges.pipe((0,O.Z)(""),(0,P.T)(n=>this.filterGroup(n))),this.loaded=!0}getControl(n){return this.scriptForm.controls[n]}goBack(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}submit(){if(!this.scriptForm.valid)return;const n=this.scriptForm.getRawValue(),t={...n,storageServiceId:"local_file"===n.storageServiceId?.type?n.storageServiceId?.id:null,storage_path:"local_file"===n.storageServiceId?.type?n.storagePath:null,name:this.completeScriptName??this.selectedRouteItem};"edit"===this.type?(this.scriptDetails={...this.scriptDetails,...t},this.eventScriptService.update(n.name,n).subscribe(()=>this.goBack())):(this.scriptDetails=n,this.eventScriptService.create(t,void 0,t.name).subscribe(()=>this.goBack()))}filterGroup(n){return n?this.scriptEvents.map(t=>({name:t.name,endpoints:t.endpoints.filter(i=>i.toLowerCase().includes(n.toLowerCase()))})).filter(t=>t.endpoints.length>0):this.scriptEvents}selectedServiceItemEvent(){this.ungroupedEventItems=[],this.ungroupedRouteOptions=[],this.selectedRouteItem="";let n=this.selectedServiceItem;"api_docs"===n&&(n="apiDocs"),this.ungroupedEventOptions=this.unGroupedEvents[n],this.ungroupedEventItems=this.ungroupedEventItems||[],Object.keys(this.ungroupedEventOptions).forEach(t=>{this.ungroupedEventItems.push(t)})}selectedEventItemEvent(){this.ungroupedRouteOptions=[...this.ungroupedEventOptions[this.selectedEventItem].endpoints];const n=this.ungroupedEventOptions[this.selectedEventItem].parameter;n&&"object"==typeof n&&Object.keys(n).length>0&&("tableName"===Object.keys(n)[0]?(this.tableProcedureFlag="table",this.tableOptions=[...this.ungroupedEventOptions[this.selectedEventItem].parameter.tableName]):"procedureName"===Object.keys(n)[0]?(this.tableProcedureFlag="procedure",this.tableOptions=[...this.ungroupedEventOptions[this.selectedEventItem].parameter.procedureName]):"functionName"===Object.keys(n)[0]&&(this.tableProcedureFlag="function",this.tableOptions=[...this.ungroupedEventOptions[this.selectedEventItem].parameter.functionName]))}selectedTable(){"table"===this.tableProcedureFlag?this.completeScriptName=this.selectedRouteItem.replace("{table_name}",this.selectTable):"procedure"===this.tableProcedureFlag?this.completeScriptName=this.selectedRouteItem.replace("{procedure_name}",this.selectTable):"function"===this.tableProcedureFlag&&(this.completeScriptName=this.selectedRouteItem.replace("{function_name}",this.selectTable))}selectedRoute(){this.completeScriptName=this.selectedRouteItem,this.selectTable&&("table"===this.tableProcedureFlag?this.completeScriptName=this.completeScriptName.replace("{table_name}",this.selectTable):"procedure"===this.tableProcedureFlag?this.completeScriptName=this.completeScriptName.replace("{procedure_name}",this.selectTable):"function"===this.tableProcedureFlag&&(this.completeScriptName=this.completeScriptName.replace("{function_name}",this.selectTable)))}static{this.\u0275fac=function(t){return new(t||E)(e.rXU(N.nX),e.rXU(r.ok),e.rXU(N.Ix),e.rXU(S.NO),e.rXU(y.n))}}static{this.\u0275cmp=e.VBU({type:E,selectors:[["df-script-details"]],standalone:!0,features:[e.aNF],decls:26,vars:32,consts:[[1,"details-section",3,"formGroup","ngSubmit"],[4,"ngIf","ngIfElse"],["editing",""],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["formControlName","isActive",1,"dynamic-width"],["formControlName","allow_event_modification",1,"dynamic-width"],[3,"cache","storageServiceId","storagePath","content"],[1,"full-width",3,"cache","type","storageServiceId","storagePath","content"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"click"],["mat-flat-button","","color","primary",1,"save-btn"],[3,"value","valueChange","selectionChange"],["appearance","outline","subscriptSizing","dynamic",1,"half-width"],[3,"value","valueChange"],[4,"ngIf"],[3,"value"],["procedure",""],["appearance","outline",1,"full-width"],["matInput","",3,"value"],["matInput","","disabled","",3,"value"]],template:function(t,i){if(1&t&&(e.j41(0,"form",0),e.bIt("ngSubmit",function(){return i.submit()}),e.nI1(1,"async"),e.DNE(2,q,21,17,"ng-container",1),e.DNE(3,ee,5,4,"ng-template",null,2,e.C5r),e.j41(5,"mat-form-field",3)(6,"mat-label"),e.EFF(7),e.nI1(8,"transloco"),e.k0s(),e.j41(9,"mat-select",4),e.DNE(10,te,2,2,"mat-option",5),e.k0s()(),e.j41(11,"mat-slide-toggle",6),e.EFF(12),e.nI1(13,"transloco"),e.k0s(),e.j41(14,"mat-slide-toggle",7),e.EFF(15),e.nI1(16,"transloco"),e.k0s(),e.nrm(17,"df-link-service",8)(18,"df-script-editor",9),e.j41(19,"div",10)(20,"button",11),e.bIt("click",function(){return i.goBack()}),e.EFF(21),e.nI1(22,"transloco"),e.k0s(),e.j41(23,"button",12),e.EFF(24),e.nI1(25,"transloco"),e.k0s()()()),2&t){const a=e.sdS(4);e.HbH(e.bMT(1,20,i.isDarkMode)?"dark-theme":""),e.Y8G("formGroup",i.scriptForm),e.R7$(2),e.Y8G("ngIf","edit"!==i.type)("ngIfElse",a),e.R7$(5),e.JRh(e.bMT(8,22,"scriptType")),e.R7$(3),e.Y8G("ngForOf",i.types),e.R7$(2),e.JRh(e.bMT(13,24,"active")),e.R7$(3),e.JRh(e.bMT(16,26,"eventModification")),e.R7$(2),e.Y8G("cache",i.scriptForm.getRawValue().name)("storageServiceId",i.selectedServiceItem)("storagePath",i.getControl("storagePath"))("content",i.getControl("content")),e.R7$(1),e.Y8G("cache",i.scriptForm.getRawValue().name)("type",i.getControl("type"))("storageServiceId",i.getControl("storageServiceId"))("storagePath",i.getControl("storagePath"))("content",i.getControl("content")),e.R7$(3),e.SpI(" ",e.bMT(22,28,"cancel")," "),e.R7$(3),e.SpI(" ",e.bMT(25,30,"save")," ")}},dependencies:[b.mV,b.sG,u.Kj,p.RG,p.rl,p.nJ,f.Ve,f.VO,_.wT,l.pM,r.YN,r.qT,r.BC,r.cb,r.X1,r.j4,r.JD,v.Hl,v.$z,G.S,$.jL,g.fS,g.fg,l.Jj,l.MD,l.bT,I],encapsulation:2})}};D=(0,j.Cg)([(0,R.d)({checkProperties:!0})],D)}}]);