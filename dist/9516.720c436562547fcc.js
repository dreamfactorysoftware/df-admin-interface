"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[9516],{99516:(Q,T,c)=>{c.r(T),c.d(T,{DfRoleDetailsComponent:()=>U});var m=c(31635),a=c(89417),t=c(60177),h=c(33609),b=c(24784),D=c(32102),g=c(58751),A=c(99631),M=c(30450),v=c(88834),C=c(10467),_=c(9159),R=c(45383),k=c(82798),E=c(9454),j=c(20060),w=c(65571),$=c(49894),P=c(84412),F=c(49969),e=c(17705),G=c(18498),S=c(86600);function V(s,r){1&s&&(e.j41(0,"th",17),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"roles.accessOverview.tableHeadings.service")," "))}function Y(s,r){if(1&s&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&s){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(1),e.JRh(n.name)}}function K(s,r){1&s&&(e.j41(0,"mat-error"),e.EFF(1," Service is required "),e.k0s())}function J(s,r){if(1&s){const n=e.RV6();e.j41(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.j41(5,"mat-select",20),e.bIt("selectionChange",function(){const i=e.eBV(n).dataIndex,p=e.XpG();return e.Njj(p.getComponents(p.getFormArrayIndex(i)))}),e.j41(6,"mat-option",21),e.EFF(7,"All"),e.k0s(),e.DNE(8,Y,2,2,"mat-option",22),e.k0s(),e.DNE(9,K,2,0,"mat-error",23),e.k0s()()}if(2&s){const n=r.dataIndex,o=e.XpG();let l;e.Y8G("formGroupName",o.getFormArrayIndex(n)),e.R7$(3),e.JRh(e.bMT(4,5,"roles.accessOverview.tableHeadings.service")),e.R7$(3),e.Y8G("value",0),e.R7$(2),e.Y8G("ngForOf",o.serviceOptions),e.R7$(1),e.Y8G("ngIf",null==o.formArray.controls[o.getFormArrayIndex(n)]||null==(l=o.formArray.controls[o.getFormArrayIndex(n)].get("service"))?null:l.hasError("required"))}}function N(s,r){1&s&&(e.j41(0,"th",17),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"roles.accessOverview.tableHeadings.component")," "))}function d(s,r){if(1&s&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&s){const n=r.$implicit;e.Y8G("value",n),e.R7$(1),e.JRh(n)}}function f(s,r){1&s&&(e.j41(0,"mat-error"),e.EFF(1," Component is required "),e.k0s())}function u(s,r){if(1&s&&(e.j41(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.j41(5,"mat-select",24),e.DNE(6,d,2,2,"mat-option",22),e.k0s(),e.DNE(7,f,2,0,"mat-error",23),e.k0s()()),2&s){const n=r.dataIndex,o=e.XpG();let l;e.Y8G("formGroupName",o.getFormArrayIndex(n)),e.R7$(3),e.JRh(e.bMT(4,4,"roles.accessOverview.tableHeadings.component")),e.R7$(3),e.Y8G("ngForOf",o.getComponentArray(o.getFormArrayIndex(n))),e.R7$(1),e.Y8G("ngIf",null==o.formArray.controls[o.getFormArrayIndex(n)]||null==(l=o.formArray.controls[o.getFormArrayIndex(n)].get("component"))?null:l.hasError("required"))}}function x(s,r){1&s&&(e.j41(0,"th",17),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"roles.accessOverview.tableHeadings.access")," "))}function O(s,r){if(1&s&&(e.j41(0,"span",27),e.EFF(1),e.k0s()),2&s){const n=e.XpG(2).dataIndex,o=e.XpG();e.R7$(1),e.Lme(" (+",(o.formArray.controls[o.getFormArrayIndex(n)].value.access.length||0)-1," ",2===o.formArray.controls[o.getFormArrayIndex(n)].value.access.length?"other":"others",") ")}}function L(s,r){if(1&s&&(e.j41(0,"mat-option",21),e.EFF(1),e.DNE(2,O,2,2,"span",26),e.k0s()),2&s){const n=r.$implicit,o=e.XpG().dataIndex,l=e.XpG();e.Y8G("value",n.value),e.R7$(1),e.SpI("",n.label," "),e.R7$(1),e.Y8G("ngIf",(l.formArray.controls[l.getFormArrayIndex(o)].value.access.length||0)>1)}}function B(s,r){1&s&&(e.j41(0,"mat-error"),e.EFF(1," Access is required "),e.k0s())}function ne(s,r){if(1&s){const n=e.RV6();e.j41(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.j41(5,"mat-select",25),e.bIt("selectionChange",function(l){const p=e.eBV(n).dataIndex,y=e.XpG();return e.Njj(y.accessChange(y.getFormArrayIndex(p),l.value))}),e.DNE(6,L,3,3,"mat-option",22),e.k0s(),e.DNE(7,B,2,0,"mat-error",23),e.k0s()()}if(2&s){const n=r.dataIndex,o=e.XpG();let l;e.Y8G("formGroupName",o.getFormArrayIndex(n)),e.R7$(3),e.JRh(e.bMT(4,4,"roles.accessOverview.tableHeadings.access")),e.R7$(3),e.Y8G("ngForOf",o.accessOptions),e.R7$(1),e.Y8G("ngIf",null==o.formArray.controls[o.getFormArrayIndex(n)]||null==(l=o.formArray.controls[o.getFormArrayIndex(n)].get("access"))?null:l.hasError("required"))}}function re(s,r){1&s&&(e.j41(0,"th",17),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"roles.accessOverview.tableHeadings.requester")," "))}function ae(s,r){if(1&s&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&s){const n=r.$implicit;e.Y8G("value",n.value),e.R7$(1),e.JRh(n.label)}}function se(s,r){if(1&s&&(e.j41(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.j41(5,"mat-select",28),e.DNE(6,ae,2,2,"mat-option",22),e.k0s()()()),2&s){const n=r.dataIndex,o=e.XpG();e.Y8G("formGroupName",o.getFormArrayIndex(n)),e.R7$(3),e.JRh(e.bMT(4,3,"roles.accessOverview.tableHeadings.requester")),e.R7$(3),e.Y8G("ngForOf",o.requesterOptions)}}function le(s,r){1&s&&(e.j41(0,"th",17),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"roles.accessOverview.tableHeadings.advancedFilters")," "))}function ie(s,r){if(1&s){const n=e.RV6();e.j41(0,"td",18)(1,"button",29),e.bIt("click",function(){const l=e.eBV(n),i=l.$implicit,p=l.dataIndex,y=e.XpG();return e.Njj(y.toggleRow(i,y.getFormArrayIndex(p)))}),e.nrm(2,"fa-icon",30),e.k0s()()}if(2&s){const n=r.dataIndex,o=e.XpG();e.Y8G("formGroupName",o.getFormArrayIndex(n)),e.R7$(2),e.Y8G("icon",o.faPlus)}}function ce(s,r){if(1&s){const n=e.RV6();e.j41(0,"th",17)(1,"button",31),e.bIt("click",function(){e.eBV(n);const l=e.XpG();return e.Njj(l.add())}),e.nI1(2,"transloco"),e.nrm(3,"fa-icon",32),e.k0s()()}if(2&s){const n=e.XpG();e.R7$(1),e.BMQ("aria-label",e.bMT(2,2,"newEntry")),e.R7$(2),e.Y8G("icon",n.faPlus)}}function me(s,r){if(1&s){const n=e.RV6();e.j41(0,"td",18)(1,"button",33),e.bIt("click",function(){const i=e.eBV(n).dataIndex,p=e.XpG();return e.Njj(p.remove(i))}),e.nrm(2,"fa-icon",30),e.k0s()()}if(2&s){const n=r.dataIndex,o=e.XpG();e.Y8G("formGroupName",o.getFormArrayIndex(n)),e.R7$(2),e.Y8G("icon",o.faTrashCan)}}function de(s,r){if(1&s&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&s){const n=r.$implicit;e.Y8G("value",n.value),e.R7$(1),e.JRh(n.label)}}function pe(s,r){if(1&s){const n=e.RV6();e.qex(0),e.j41(1,"div",36)(2,"mat-form-field",19)(3,"mat-label"),e.EFF(4,"Field"),e.k0s(),e.nrm(5,"input",37),e.k0s(),e.j41(6,"mat-form-field",19)(7,"mat-label"),e.EFF(8,"Operator"),e.k0s(),e.j41(9,"mat-select",38),e.DNE(10,de,2,2,"mat-option",22),e.k0s()(),e.j41(11,"mat-form-field",19)(12,"mat-label"),e.EFF(13,"Value"),e.k0s(),e.nrm(14,"input",39),e.k0s(),e.j41(15,"div")(16,"mat-button-toggle-group",40),e.bIt("change",function(l){e.eBV(n);const i=e.XpG().dataIndex,p=e.XpG();return e.Njj(p.filterOpChange(l,p.getFormArrayIndex(i)))}),e.j41(17,"mat-button-toggle",41),e.EFF(18,"AND"),e.k0s(),e.j41(19,"mat-button-toggle",42),e.EFF(20,"OR"),e.k0s()()(),e.j41(21,"button",43),e.bIt("click",function(){e.eBV(n);const l=e.XpG().dataIndex,i=e.XpG();return e.Njj(i.addAdvancedFilter(i.getFormArrayIndex(l)))}),e.nrm(22,"fa-icon",30),e.k0s(),e.j41(23,"button",43),e.bIt("click",function(){const i=e.eBV(n).index,p=e.XpG().dataIndex,y=e.XpG();return e.Njj(y.removeAdvancedFilter(y.getFormArrayIndex(p),i))}),e.nrm(24,"fa-icon",30),e.k0s()(),e.bVm()}if(2&s){const n=r.index,o=e.XpG(2);e.R7$(1),e.Y8G("formArrayName",n),e.R7$(9),e.Y8G("ngForOf",o.operatorOptions),e.R7$(12),e.Y8G("icon",o.faPlus),e.R7$(2),e.Y8G("icon",o.faTrashCan)}}function ue(s,r){if(1&s&&(e.j41(0,"td",18)(1,"div",34),e.DNE(2,pe,25,4,"ng-container",35),e.k0s()()),2&s){const n=r.$implicit,o=r.dataIndex,l=e.XpG();e.Y8G("formGroupName",l.getFormArrayIndex(o)),e.BMQ("colspan",6),e.R7$(1),e.Y8G("@detailExpand",n===l.expandedElement?"expanded":"collapsed"),e.R7$(1),e.Y8G("ngForOf",l.getAdvancedFilters(l.getFormArrayIndex(o)).controls)}}function fe(s,r){1&s&&e.nrm(0,"tr",44)}function _e(s,r){1&s&&e.nrm(0,"tr",45)}function he(s,r){1&s&&(e.j41(0,"tr",46)(1,"td",47),e.nrm(2,"br"),e.EFF(3),e.nI1(4,"transloco"),e.k0s()()),2&s&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"roles.accessOverview.noAccessRules")," "))}function ve(s,r){1&s&&e.nrm(0,"tr",48)}c(36225);const ee=function(){return["service","component","access","requester","advancedFilters","actions"]},ge=function(){return["expandedDetail"]};let X=class H{constructor(r,n,o){this.activatedRoute=r,this.baseService=n,this.fb=o,this.displayedColumns=["service","component","access","requester","advancedFilters","actions"],this.expandField=new a.MJ(""),this.faTrashCan=R.sjs,this.faPlus=R.QLR,this.serviceOptions=[{id:0,name:""}],this.expandOperator=new a.MJ(""),this.expandValue=new a.MJ(""),this.componentOptions=[{serviceId:0,components:["*"]}],this.accessOptions=[{value:1,label:"GET (read)"},{value:2,label:"POST (create)"},{value:4,label:"PUT (replace)"},{value:8,label:"PATCH (update)"},{value:16,label:"DELETE (remove)"}],this.requesterOptions=[{value:1,label:"API"},{value:2,label:"SCRIPT"}],this.operatorOptions=[{value:"=",label:"="},{value:"!=",label:"!="},{value:">",label:">"},{value:"<",label:"<"},{value:">=",label:">="},{value:"<=",label:"<="},{value:"in",label:"in"},{value:"not in",label:"not in"},{value:"start with",label:"start with"},{value:"end with",label:"end with"},{value:"contains",label:"contains"},{value:"is null",label:"is null"},{value:"is not null",label:"is not null"}],this.filteredComponentArray=[],this.expandedElement$=new P.t(1),this.expandedElement=null,this.form=this.fb.group({cFormArray:this.fb.array([this.createItem()])})}createItem(){return this.fb.group({service:[""],component:[""]})}ngOnInit(){this.activatedRoute.data.subscribe(r=>{this.serviceOptions=r?.services?.resource.sort((n,o)=>n.name<o.name?-1:n.name>o.name?1:0)||[],"edit"===r.type&&r.data.roleServiceAccessByRoleId.length>0&&r.data.roleServiceAccessByRoleId.forEach(n=>{const o=n.serviceId,l=this.serviceOptions.find(i=>i.id===o)?.name||"";"email"!==l?this.baseService.get(l,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(i=>{this.componentOptions.push({serviceId:o,components:i.resource})}):this.componentOptions.push({serviceId:o,components:["*"]})})}),this.initializeFilteredComponents(),this.updateDataSource()}get cFormArray(){return this.form.get("formArray")}initializeFilteredComponents(){this.filteredComponentArray=this.formArray.controls.map((r,n)=>this.getComponentArray(n))}getComponentArray(r){const n=this.formArray.at(r).get("service")?.value;return this.componentOptions.find(l=>l.serviceId===n)?.components||[]}getFormArrayIndex(r){let n=0;for(let o=0;o<this.visible.length;o++)if(this.visible[o]){if(n===r)return o;n++}return-1}filterOptions(r,n){const o=r.target.value.toLowerCase(),l=this.formArray.at(n).get("service")?.value,i=this.componentOptions.find(p=>p.serviceId===l)?.components||[];this.filteredComponentArray[n]=i.filter(p=>p.includes(o))}getComponents(r){var n=this;return(0,C.A)(function*(){const o=n.formArray.controls[r].get("service")?.value,l=n.serviceOptions.find(i=>i.id===o)?.name||"";"email"!==l?n.componentOptions.some(i=>i.serviceId===o)||n.baseService.get(l,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(i=>{n.componentOptions.push({serviceId:o,components:i.resource})}):n.componentOptions.push({serviceId:o,components:["*"]})})()}getExtendOperator(r){const n=this.serviceAccess.at(r).get("extend-operator")?.value;return this.componentOptions.find(l=>l.serviceId===n)?.components||[]}toggleRow(r,n){this.expandedElement=this.expandedElement===r?null:r,this.expandedElement&&0===this.getAdvancedFilters(n).length&&this.addAdvancedFilter(n)}accessChange(r,n){this.formArray.at(r).get("access")}updateDataSource(){const r=this.formArray.controls.filter((n,o)=>this.visible[o]);this.dataSource=new _.I6(r)}get hasServiceAccess(){return this.rootForm.controls.serviceAccess.value.length>0}add(){const r=new a.Yp([]);this.formArray.push(new a.gE({service:new a.MJ(0,a.k0.required),component:new a.MJ("",a.k0.required),access:new a.MJ("",a.k0.required),requester:new a.MJ([1],a.k0.required),advancedFilters:r,id:new a.MJ(null),serviceAccess:new a.MJ("")})),this.visible.push(!0),this.updateDataSource()}getAdvancedFilters(r){return this.formArray.controls[r].get("advancedFilters")}addAdvancedFilter(r){this.getAdvancedFilters(r).push(new a.gE({expandField:new a.MJ("",a.k0.required),expandOperator:new a.MJ("",a.k0.required),expandValue:new a.MJ("",a.k0.required),filterOp:new a.MJ("AND")})),this.updateDataSource()}removeAdvancedFilter(r,n){this.getAdvancedFilters(r).removeAt(n),0===this.getAdvancedFilters(r).length&&(this.expandedElement=null),this.updateDataSource()}remove(r){if(r>=0&&r<this.formArray.length){let n=0,o=-1;for(let l=0;l<this.visible.length;l++)if(this.visible[l]){if(n===r){o=l;break}n++}if(this.visible=this.updateNthTrueToFalse(this.visible,r),-1!==o&&o<this.formArray.length){const l=this.formArray.at(o);l.get("service")?.clearValidators(),l.get("component")?.clearValidators(),l.get("access")?.clearValidators(),l.get("requester")?.clearValidators(),l.get("service")?.updateValueAndValidity(),l.get("component")?.updateValueAndValidity(),l.get("access")?.updateValueAndValidity(),l.get("requester")?.updateValueAndValidity()}}this.updateDataSource()}updateNthTrueToFalse(r,n){let o=0;for(let l=0;l<r.length;l++)if(r[l]){if(o===n){r[l]=!1;break}o++}return r}addFilter(r){const n=this.serviceAccess.at(r).get("advancedFilters");n instanceof a.Yp?n.push(new a.gE({expandField:new a.MJ("",a.k0.required),expandOperator:new a.MJ("",a.k0.required),expandValue:new a.MJ("",a.k0.required),filterOp:new a.MJ("")})):console.error("advancedFilters is not a FormArray")}removeFilter(r,n){this.serviceAccess.at(r).get("advancedFilters").removeAt(n)}filterOpChange(r,n){this.getAdvancedFilters(n).controls.forEach(o=>{o.get("filterOp")?.setValue(r.value)})}static{this.\u0275fac=function(n){return new(n||H)(e.rXU(G.nX),e.rXU(b.qJ),e.rXU(a.ok))}}static{this.\u0275cmp=e.VBU({type:H,selectors:[["df-roles-access"]],inputs:{formArray:"formArray",roleForm:"roleForm",visible:"visible"},standalone:!0,features:[e.aNF],decls:39,vars:17,consts:[[1,"service-access-accordion","full-width",3,"formGroup"],["expanded","true"],["formArrayName","serviceAccess"],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","service"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"formGroupName",4,"matCellDef"],["matColumnDef","component"],["matColumnDef","access"],["matColumnDef","requester"],["matColumnDef","advancedFilters"],["matColumnDef","actions"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"formGroupName"],["subscriptSizing","dynamic","appearance","outline"],["formControlName","service","panelWidth","null","required","",3,"selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","component","panelWdith","null","required",""],["formControlName","access","multiple","","panelWidth","null","required","",3,"selectionChange"],["class","example-additional-selection",4,"ngIf"],[1,"example-additional-selection"],["formControlName","requester","multiple","","panelWidth","null"],["mat-icon-button","","color","primary","type","button",3,"click"],["size","xs",3,"icon"],["mat-mini-fab","","color","primary","type","button",3,"click"],["size","xl",3,"icon"],["mat-icon-button","",3,"click"],["formArrayName","advancedFilters",1,"element-detail"],[4,"ngFor","ngForOf"],[1,"expandedItems",3,"formArrayName"],["matInput","","formControlName","expandField"],["formControlName","expandOperator","panelWidth","null"],["formControlName","expandValue","matInput",""],["aria-label","Service Definition Type","formControlName","filterOp",3,"change"],["value","AND"],["value","OR"],["mat-icon-button","","type","button",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],["mat-row","",1,"detail-row"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"mat-accordion")(2,"mat-expansion-panel",1)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),e.EFF(5),e.nI1(6,"transloco"),e.k0s(),e.j41(7,"mat-panel-description"),e.EFF(8),e.nI1(9,"transloco"),e.k0s()(),e.j41(10,"p"),e.EFF(11),e.nI1(12,"transloco"),e.k0s(),e.qex(13,2),e.j41(14,"table",3),e.qex(15,4),e.DNE(16,V,3,3,"th",5),e.DNE(17,J,10,7,"td",6),e.bVm(),e.qex(18,7),e.DNE(19,N,3,3,"th",5),e.DNE(20,u,8,6,"td",6),e.bVm(),e.qex(21,8),e.DNE(22,x,3,3,"th",5),e.DNE(23,ne,8,6,"td",6),e.bVm(),e.qex(24,9),e.DNE(25,re,3,3,"th",5),e.DNE(26,se,7,5,"td",6),e.bVm(),e.qex(27,10),e.DNE(28,le,3,3,"th",5),e.DNE(29,ie,3,2,"td",6),e.bVm(),e.qex(30,11),e.DNE(31,ce,4,4,"th",5),e.DNE(32,me,3,2,"td",6),e.bVm(),e.qex(33,12),e.DNE(34,ue,3,4,"td",6),e.bVm(),e.DNE(35,fe,1,0,"tr",13),e.DNE(36,_e,1,0,"tr",14),e.DNE(37,he,5,3,"tr",15),e.DNE(38,ve,1,0,"tr",16),e.k0s(),e.bVm(),e.k0s()()()),2&n&&(e.Y8G("formGroup",o.roleForm),e.R7$(5),e.SpI(" ",e.bMT(6,8,"roles.accessOverview.heading"),""),e.R7$(3),e.SpI(" ",e.bMT(9,10,"roles.accessOverview.tableDescription")," "),e.R7$(3),e.SpI(" ",e.bMT(12,12,"roles.accessOverview.description")," "),e.R7$(3),e.Y8G("dataSource",o.dataSource),e.R7$(21),e.Y8G("matHeaderRowDef",e.lJ4(14,ee)),e.R7$(1),e.Y8G("matRowDefColumns",e.lJ4(15,ee)),e.R7$(2),e.Y8G("matRowDefColumns",e.lJ4(16,ge)))},dependencies:[h.Kj,_.tP,_.Zl,_.tL,_.ji,_.cC,_.YV,_.iL,_.KS,_.$R,_.YZ,_.NB,_.ky,a.X1,a.me,a.BC,a.cb,a.YS,a.j4,a.JD,a.$R,a.v8,D.RG,D.rl,D.nJ,D.TL,k.Ve,k.VO,S.wT,A.fS,A.fg,E.MY,E.BS,E.GK,E.Z2,E.WN,E.Q6,j.dX,j.aY,v.Hl,v.iY,v.$0,t.MD,t.Sq,t.bT,w.Vg,w.ec,w.pc,a.YN],styles:["mat-expansion-panel[_ngcontent-%COMP%]{overflow-x:auto!important}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}table[_ngcontent-%COMP%]{width:100%}tr.detail-row[_ngcontent-%COMP%]{height:0}tr.element-row[_ngcontent-%COMP%]:not(.example-expanded-row):hover{background:whitesmoke}tr.element-row[_ngcontent-%COMP%]:not(.example-expanded-row):active{background:#efefef}.element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column;gap:8px;padding-top:8px}.element-detail[_ngcontent-%COMP%]   .expandedItems[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:5px}.detail-input[_ngcontent-%COMP%]{margin-right:20px}  .cdk-overlay-pane{width:max-content!important}"],data:{animation:[(0,F.hZ)("detailExpand",[(0,F.wk)("collapsed,void",(0,F.iF)({height:"*",minHeight:"0"})),(0,F.wk)("expanded",(0,F.iF)({height:"*"})),(0,F.kY)("expanded <=> collapsed",(0,F.i0)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}})}};X=(0,m.Cg)([(0,$.d)({checkProperties:!0})],X);var De=c(51425),te=c(99437),oe=c(18810),be=c(52868),Ce=c(44984);function Re(s,r){1&s&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"roles.rolesOverview.error.name")," "))}function ye(s,r){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"save")," "))}function Ae(s,r){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"update")," "))}let U=class q{constructor(r,n,o,l,i,p){this.roleService=r,this.fb=n,this.router=o,this.activatedRoute=l,this.themeService=i,this.snackbarService=p,this.type="",this.alertMsg="",this.showAlert=!1,this.alertType="error",this.visibilityArray=[],this.originalLookupKeyIds=[],this.deletedLookupKeys=[],this.isDarkMode=this.themeService.darkMode$,this.filterOp="",this.roleForm=this.fb.group({id:[0],name:["",a.k0.required],description:[""],active:[!1],serviceAccess:this.fb.array([]),lookupKeys:this.fb.array([])})}ngOnInit(){this.activatedRoute.data.subscribe(({data:r,type:n})=>{this.type=n,this.deletedLookupKeys=[],r&&(this.snackbarService.setSnackbarLastEle(r.label?r.label:r.name,!0),this.roleForm.patchValue({id:r.id,name:r.name,description:r.description,active:r.isActive}),r.roleServiceAccessByRoleId.length>0&&(this.filterOp=r.roleServiceAccessByRoleId[0].filterOp,r.roleServiceAccessByRoleId.forEach(o=>{this.visibilityArray.push(!0);const l=new a.Yp((o.filters||[]).map(i=>new a.gE({expandField:new a.MJ(i.name),expandOperator:new a.MJ(i.operator),expandValue:new a.MJ(i.value),filterOp:new a.MJ(o.filterOp)})));this.roleForm.controls.serviceAccess.push(new a.gE({service:new a.MJ(o.serviceId?o.serviceId:0,[a.k0.required]),component:new a.MJ(o.component),access:new a.MJ(this.handleAccessValue(o.verbMask),[a.k0.required]),requester:new a.MJ(this.handleRequesterValue(o.requestorMask)),advancedFilters:l,id:new a.MJ(o.id),extendField:new a.MJ(o.extendField),extendOperator:new a.MJ(o.extendOperator),extendValue:new a.MJ(o.extendValue),filterOp:new a.MJ(o.filterOp)}))})),r.lookupByRoleId.length>0&&r.lookupByRoleId.forEach(o=>{o.id&&this.originalLookupKeyIds.push(o.id),this.roleForm.controls.lookupKeys.push(new a.gE({id:new a.MJ(o.id),name:new a.MJ(o.name,[a.k0.required]),value:new a.MJ(o.value),private:new a.MJ(o.private)}))}))})}handleRequesterValue(r){return 3===r?[1,2]:[r]}handleAccessValue(r){const n=[1,2,4,8,16],o=[];for(let l=n.length-1;l>=0;l--){const i=n[l];r>=i&&(o.push(i),r-=i)}return o}onLookupDeleted(r){this.deletedLookupKeys.push({...r,roleId:null})}triggerAlert(r,n){this.alertType=r,this.alertMsg=n,this.showAlert=!0}get serviceAccess(){return this.roleForm.get("serviceAccess")}onSubmit(){if(this.roleForm.get("serviceAccess").controls.forEach((i,p)=>{this.visibilityArray[p]||(i.get("service")?.clearValidators(),i.get("component")?.clearValidators(),i.get("access")?.clearValidators(),i.get("requester")?.clearValidators(),i.get("service")?.updateValueAndValidity(),i.get("component")?.updateValueAndValidity(),i.get("access")?.updateValueAndValidity(),i.get("requester")?.updateValueAndValidity())}),this.roleForm.invalid)return void this.roleForm.markAllAsTouched();const n=this.roleForm.getRawValue();if(""===n.name||null===n.name)return;const o={id:n.id,name:n.name,description:n.description,isActive:n.active,roleServiceAccessByRoleId:n.serviceAccess.map((i,p)=>{const y=i.advancedFilters.map(I=>({name:I.expandField,operator:I.expandOperator,value:I.expandValue})),Fe=i.advancedFilters.map(I=>I.filterOp);return{id:i.id,roleId:this.visibilityArray[p]?n.id:null,serviceId:0===i.service?null:i.service,component:i.component,verbMask:i.access.reduce((I,W)=>I+W,0),requestorMask:i.requester.reduce((I,W)=>I+W,0),filters:y,filterOp:Fe[0]}}),lookupByRoleId:this.getLookupKeysWithDeletions(n)},l={resource:[o]};"edit"===this.type&&o.id?this.roleService.update(o.id,o).pipe((0,te.W)(i=>(this.triggerAlert("error",i.error.error.message),(0,oe.$)(()=>new Error(i))))).subscribe(()=>{this.goBack()}):this.roleService.create(l,{fields:"*",related:"role_service_access_by_role_id,lookup_by_role_id"}).pipe((0,te.W)(i=>(this.triggerAlert("error",i.error.error.context.resource[0].message),(0,oe.$)(()=>new Error(i))))).subscribe(()=>{this.goBack()})}getLookupKeysWithDeletions(r){const n=r.lookupKeys,o=[...n],l=n.map(p=>p.id).filter(p=>p);return this.originalLookupKeyIds.filter(p=>!l.includes(p)).forEach(p=>{o.push({id:p,role_id:null})}),o}goBack(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}static{this.\u0275fac=function(n){return new(n||q)(e.rXU(b.h1),e.rXU(a.ok),e.rXU(G.Ix),e.rXU(G.nX),e.rXU(be.n),e.rXU(Ce.L))}}static{this.\u0275cmp=e.VBU({type:q,selectors:[["df-role-details"]],standalone:!0,features:[e.aNF],decls:34,vars:32,consts:[[3,"showAlert","alertType","alertClosed"],[1,"details-section",3,"formGroup","ngSubmit"],["appearance","outline","subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","active",1,"dynamic-width"],["appearance","outline","subscriptSizing","dynamic"],["rows","1","matInput","","formControlName","description"],["formArrayName","serviceAccess",1,"full-width"],[1,"full-width",3,"visible","formArray","roleForm"],["formArrayName","lookupKeys",1,"full-width",3,"lookupDeleted"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"click"],["mat-flat-button","","color","primary",1,"save-btn"]],template:function(n,o){1&n&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"transloco"),e.k0s(),e.j41(3,"df-alert",0),e.bIt("alertClosed",function(){return o.showAlert=!1}),e.EFF(4),e.k0s(),e.j41(5,"form",1),e.bIt("ngSubmit",function(){return o.onSubmit()}),e.nI1(6,"async"),e.j41(7,"mat-form-field",2)(8,"mat-label"),e.EFF(9),e.nI1(10,"transloco"),e.k0s(),e.nrm(11,"input",3),e.DNE(12,Re,3,3,"mat-error",4),e.k0s(),e.j41(13,"mat-slide-toggle",5),e.EFF(14),e.nI1(15,"transloco"),e.k0s(),e.j41(16,"mat-form-field",6)(17,"mat-label"),e.EFF(18),e.nI1(19,"transloco"),e.k0s(),e.nrm(20,"textarea",7),e.k0s(),e.j41(21,"div",8),e.nrm(22,"df-roles-access",9),e.k0s(),e.j41(23,"p"),e.EFF(24),e.nI1(25,"transloco"),e.k0s(),e.j41(26,"df-lookup-keys",10),e.bIt("lookupDeleted",function(i){return o.onLookupDeleted(i)}),e.k0s(),e.j41(27,"div",11)(28,"button",12),e.bIt("click",function(){return o.goBack()}),e.EFF(29),e.nI1(30,"transloco"),e.k0s(),e.j41(31,"button",13),e.DNE(32,ye,3,3,"span",4),e.DNE(33,Ae,3,3,"span",4),e.k0s()()()),2&n&&(e.R7$(1),e.SpI(" ",e.bMT(2,18,"roles.rolesOverview.description"),"\n"),e.R7$(2),e.Y8G("showAlert",o.showAlert)("alertType",o.alertType),e.R7$(1),e.SpI(" ",o.alertMsg,"\n"),e.R7$(1),e.HbH(e.bMT(6,20,o.isDarkMode)?"dark-theme":""),e.Y8G("formGroup",o.roleForm),e.R7$(4),e.JRh(e.bMT(10,22,"name")),e.R7$(3),e.Y8G("ngIf",o.roleForm.controls.name.hasError("required")),e.R7$(2),e.JRh(e.bMT(15,24,"active")),e.R7$(4),e.JRh(e.bMT(19,26,"description")),e.R7$(4),e.Y8G("visible",o.visibilityArray)("formArray",o.serviceAccess)("roleForm",o.roleForm),e.R7$(2),e.SpI(" ",e.bMT(25,28,"roles.lookupKeys.description")," "),e.R7$(5),e.SpI(" ",e.bMT(30,30,"cancel")," "),e.R7$(3),e.Y8G("ngIf","create"===o.type),e.R7$(1),e.Y8G("ngIf","edit"===o.type))},dependencies:[h.Kj,t.Jj,a.YN,a.qT,a.me,a.BC,a.cb,a.YS,A.fS,A.fg,D.rl,D.nJ,D.TL,D.RG,a.X1,a.j4,a.JD,a.v8,g.S,M.mV,M.sG,v.Hl,v.$z,X,t.bT,De.W],encapsulation:2})}};U=(0,m.Cg)([(0,$.d)({checkProperties:!0})],U)},51425:(Q,T,c)=>{c.d(T,{W:()=>M});var m=c(17705),a=c(60177),t=c(88834),h=c(20060),b=c(45383);function D(v,C){if(1&v){const _=m.RV6();m.j41(0,"button",5),m.bIt("click",function(){m.eBV(_);const k=m.XpG(2);return m.Njj(k.dismissAlert())}),m.j41(1,"fa-icon",6),m.EFF(2),m.k0s()()}if(2&v){const _=m.XpG(2);m.R7$(1),m.Y8G("icon",_.faXmark),m.R7$(1),m.JRh("alerts.close")}}function g(v,C){if(1&v&&(m.j41(0,"div",1),m.nrm(1,"fa-icon",2),m.j41(2,"span",3),m.SdG(3),m.k0s(),m.DNE(4,D,3,2,"button",4),m.k0s()),2&v){const _=m.XpG();m.HbH(_.alertType),m.R7$(1),m.Y8G("icon",_.icon),m.R7$(3),m.Y8G("ngIf",_.dismissible)}}const A=["*"];let M=(()=>{class v{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new m.bkB,this.faXmark=b.Jyw}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return b.SGM;case"error":return b.rfe;case"warning":return b.tUE;default:return b.iW_}}static{this.\u0275fac=function(R){return new(R||v)}}static{this.\u0275cmp=m.VBU({type:v,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[m.aNF],ngContentSelectors:A,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(R,k){1&R&&(m.NAR(),m.DNE(0,g,5,4,"div",0)),2&R&&m.Y8G("ngIf",k.showAlert)},dependencies:[a.bT,t.Hl,t.iY,h.dX,h.aY],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]})}}return v})()},58751:(Q,T,c)=>{c.d(T,{S:()=>N});var m=c(31635),a=c(60177),t=c(17705),h=c(89417),b=c(32102),D=c(88834),g=c(9159),A=c(99631),M=c(30450),v=c(20060),C=c(9454),_=c(45383),R=c(33609),k=c(49894),E=c(52868);function j(d,f){if(1&d&&(t.j41(0,"mat-accordion")(1,"mat-expansion-panel")(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t.EFF(4),t.nI1(5,"transloco"),t.k0s(),t.j41(6,"mat-panel-description"),t.EFF(7),t.nI1(8,"transloco"),t.k0s()(),t.eu8(9,3),t.k0s()()),2&d){t.XpG();const u=t.sdS(4);t.R7$(4),t.SpI(" ",t.bMT(5,3,"lookupKeys.label"),""),t.R7$(3),t.JRh(t.bMT(8,5,"lookupKeys.desc")),t.R7$(2),t.Y8G("ngTemplateOutlet",u)}}function w(d,f){1&d&&(t.j41(0,"mat-header-cell"),t.EFF(1),t.nI1(2,"transloco"),t.k0s()),2&d&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"name")," "))}function $(d,f){1&d&&(t.j41(0,"mat-cell",16)(1,"mat-form-field",17)(2,"mat-label"),t.EFF(3),t.nI1(4,"transloco"),t.k0s(),t.nrm(5,"input",18),t.k0s()()),2&d&&(t.Y8G("formGroupName",f.index),t.R7$(3),t.JRh(t.bMT(4,2,"name")))}function P(d,f){1&d&&(t.j41(0,"mat-header-cell"),t.EFF(1),t.nI1(2,"transloco"),t.k0s()),2&d&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"value")," "))}function F(d,f){1&d&&(t.j41(0,"mat-cell",16)(1,"mat-form-field",17)(2,"mat-label"),t.EFF(3),t.nI1(4,"transloco"),t.k0s(),t.nrm(5,"input",19),t.k0s()()),2&d&&(t.Y8G("formGroupName",f.index),t.R7$(3),t.JRh(t.bMT(4,2,"value")))}function e(d,f){1&d&&(t.j41(0,"mat-header-cell"),t.EFF(1),t.nI1(2,"transloco"),t.k0s()),2&d&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"private")," "))}function G(d,f){1&d&&(t.j41(0,"mat-cell",16),t.nrm(1,"mat-slide-toggle",20),t.nI1(2,"transloco"),t.k0s()),2&d&&(t.Y8G("formGroupName",f.index),t.R7$(1),t.BMQ("aria-label",t.bMT(2,2,"name")))}function S(d,f){if(1&d){const u=t.RV6();t.j41(0,"mat-header-cell")(1,"button",21),t.bIt("click",function(){t.eBV(u);const O=t.XpG(2);return t.Njj(O.add())}),t.nI1(2,"transloco"),t.nrm(3,"fa-icon",22),t.k0s()()}if(2&d){const u=t.XpG(2);t.R7$(1),t.BMQ("aria-label",t.bMT(2,2,"newEntry")),t.R7$(2),t.Y8G("icon",u.faPlus)}}function Z(d,f){if(1&d){const u=t.RV6();t.j41(0,"mat-cell",16)(1,"button",23),t.bIt("click",function(){const L=t.eBV(u).index,B=t.XpG(2);return t.Njj(B.remove(L))}),t.nrm(2,"fa-icon",24),t.k0s()()}if(2&d){const u=f.index,x=t.XpG(2);t.Y8G("formGroupName",u),t.R7$(2),t.Y8G("icon",x.faTrashCan)}}function V(d,f){1&d&&t.nrm(0,"mat-header-row")}function Y(d,f){1&d&&t.nrm(0,"mat-row")}function K(d,f){1&d&&(t.j41(0,"tr",25)(1,"td",26),t.EFF(2),t.nI1(3,"transloco"),t.k0s()()),2&d&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"lookupKeys.noKeys")," "))}function J(d,f){if(1&d&&(t.qex(0,4)(1,5),t.j41(2,"mat-table",6),t.qex(3,7),t.DNE(4,w,3,3,"mat-header-cell",8),t.DNE(5,$,6,4,"mat-cell",9),t.bVm(),t.qex(6,10),t.DNE(7,P,3,3,"mat-header-cell",8),t.DNE(8,F,6,4,"mat-cell",9),t.bVm(),t.qex(9,11),t.DNE(10,e,3,3,"mat-header-cell",8),t.DNE(11,G,3,4,"mat-cell",9),t.bVm(),t.qex(12,12),t.DNE(13,S,4,4,"mat-header-cell",8),t.DNE(14,Z,3,2,"mat-cell",9),t.bVm(),t.DNE(15,V,1,0,"mat-header-row",13),t.DNE(16,Y,1,0,"mat-row",14),t.DNE(17,K,4,3,"tr",15),t.k0s(),t.bVm()()),2&d){const u=t.XpG();t.Y8G("formGroup",u.rootForm),t.R7$(2),t.Y8G("dataSource",u.dataSource),t.R7$(13),t.Y8G("matHeaderRowDef",u.displayedColumns),t.R7$(1),t.Y8G("matRowDefColumns",u.displayedColumns)}}let N=class z{constructor(f,u){this.rootFormGroup=f,this.themeService=u,this.displayedColumns=["name","value","private","actions"],this.faTrashCan=_.sjs,this.faPlus=_.QLR,this.showAccordion=!0,this.lookupDeleted=new t.bkB,this.isDarkMode=this.themeService.darkMode$}ngOnInit(){this.rootForm=this.rootFormGroup.control,this.rootFormGroup.ngSubmit.subscribe(()=>{this.lookupKeys.markAllAsTouched()}),this.lookupKeys=this.rootForm.get("lookupKeys"),this.updateDataSource()}updateDataSource(){this.lookupKeys.controls.forEach(f=>{f.get("id")?.value&&f.get("name")?.disable()}),this.dataSource=new g.I6(this.lookupKeys.controls)}add(){this.lookupKeys.push(new h.gE({name:new h.MJ("",h.k0.required),value:new h.MJ(""),private:new h.MJ(!1)})),this.updateDataSource()}remove(f){const u=this.lookupKeys.at(f).value;u.id&&this.lookupDeleted.emit(u),this.lookupKeys.removeAt(f),this.updateDataSource()}static{this.\u0275fac=function(u){return new(u||z)(t.rXU(h.j4),t.rXU(E.n))}}static{this.\u0275cmp=t.VBU({type:z,selectors:[["df-lookup-keys"]],inputs:{showAccordion:"showAccordion"},outputs:{lookupDeleted:"lookupDeleted"},standalone:!0,features:[t.aNF],decls:5,vars:6,consts:[[1,"lookup-keys-accordion"],[4,"ngIf","ngIfElse"],["lookupKeys",""],[3,"ngTemplateOutlet"],[3,"formGroup"],["formArrayName","lookupKeys"],[3,"dataSource"],["matColumnDef","name"],[4,"matHeaderCellDef"],[3,"formGroupName",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","private"],["matColumnDef","actions","stickyEnd",""],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["class","mat-row no-data-row",4,"matNoDataRow"],[3,"formGroupName"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","formControlName","name"],["matInput","","formControlName","value"],["color","primary","formControlName","private"],["mat-mini-fab","","type","button",1,"save-btn",3,"click"],["size","xl",3,"icon"],["mat-icon-button","","type","button",1,"remove-btn",3,"click"],["size","xs",3,"icon"],[1,"mat-row","no-data-row"],["colspan","4",1,"mat-cell"]],template:function(u,x){if(1&u&&(t.j41(0,"div",0),t.nI1(1,"async"),t.DNE(2,j,10,7,"mat-accordion",1),t.DNE(3,J,18,4,"ng-template",null,2,t.C5r),t.k0s()),2&u){const O=t.sdS(4);t.HbH(t.bMT(1,4,x.isDarkMode)?"dark-theme":""),t.R7$(2),t.Y8G("ngIf",x.showAccordion)("ngIfElse",O)}},dependencies:[h.YN,h.me,h.BC,h.cb,h.X1,h.j4,h.JD,h.$R,h.v8,a.bT,a.T3,b.RG,b.rl,b.nJ,D.Hl,D.iY,D.$0,g.tP,g.Zl,g.tL,g.ji,g.cC,g.YV,g.iL,g.KS,g.$R,g.YZ,g.NB,g.ky,A.fS,A.fg,M.mV,M.sG,v.dX,v.aY,C.MY,C.BS,C.GK,C.Z2,C.WN,C.Q6,R.Kj,a.Jj],styles:[".lookup-keys-accordion[_ngcontent-%COMP%]{padding:16px 0}.mat-column-actions[_ngcontent-%COMP%], .mat-column-private[_ngcontent-%COMP%]{max-width:10%}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}"]})}};N=(0,m.Cg)([(0,k.d)({checkProperties:!0})],N)}}]);