"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[939],{40939:(q,f,n)=>{n.r(f),n.d(f,{DfUserDetailsComponent:()=>u});var v=n(31635),i=n(89417),c=n(18498),E=n(99437),g=n(18810),P=n(53012),b=n(76765),C=n(24784),O=n(58751),F=n(30877),D=n(99631),_=n(32102),I=n(82765),T=n(20060),M=n(88834),p=n(5951),m=n(60177),h=n(30450),U=n(77493),y=n(51425),R=n(33609),A=n(49894),e=n(17705),$=n(82298),B=n(52608),G=n(95351);function S(s,o){if(1&s&&(e.qex(0),e.j41(1,"df-alert",14),e.EFF(2),e.nI1(3,"transloco"),e.k0s(),e.j41(4,"mat-radio-group",15),e.nI1(5,"transloco"),e.j41(6,"mat-radio-button",16),e.EFF(7),e.nI1(8,"transloco"),e.k0s(),e.j41(9,"mat-radio-button",17),e.EFF(10),e.nI1(11,"transloco"),e.k0s()(),e.bVm()),2&s){const r=e.XpG();let t;e.R7$(1),e.Y8G("alertType",null!=(t=r.userForm.get("pass-invite"))&&t.touched&&null!=(t=r.userForm.get("pass-invite"))&&t.invalid?"error":"info")("showAlert",!0)("dismissible",!1),e.R7$(1),e.SpI(" ",e.bMT(3,7,r.userType+".alerts.new")," "),e.R7$(2),e.BMQ("aria-label",e.bMT(5,9,"selectAnOption")),e.R7$(3),e.JRh(e.bMT(8,11,"userManagement.controls.sendInvite.label")),e.R7$(3),e.JRh(e.bMT(11,13,"userManagement.controls.setPassword.label"))}}function k(s,o){if(1&s){const r=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(r);const l=e.XpG(2);return e.Njj(l.sendInvite())}),e.EFF(1),e.nI1(2,"transloco"),e.nrm(3,"fa-icon",20),e.k0s()}if(2&s){const r=e.XpG(2);e.R7$(1),e.SpI(" ",e.bMT(2,2,"sendInvite")," "),e.R7$(2),e.Y8G("icon",r.faEnvelope)}}function x(s,o){1&s&&(e.qex(0),e.j41(1,"mat-checkbox",21),e.EFF(2),e.nI1(3,"transloco"),e.k0s(),e.bVm()),2&s&&(e.R7$(2),e.SpI("",e.bMT(3,1,"userManagement.controls.setPassword.label")," "))}function N(s,o){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"transloco"),e.k0s(),e.DNE(3,k,4,4,"button",18),e.DNE(4,x,4,3,"ng-container",8)),2&s){const r=e.XpG();e.R7$(1),e.Lme("",e.bMT(2,4,"confirmed"),": ",r.currentProfile.confirmed?"Yes":"No",""),e.R7$(2),e.Y8G("ngIf",!r.currentProfile.confirmed),e.R7$(1),e.Y8G("ngIf",r.userForm.contains("setPassword"))}}function j(s,o){1&s&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"userManagement.controls.password.errors.required")," "))}function W(s,o){1&s&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"userManagement.controls.password.errors.length")," "))}function L(s,o){1&s&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&s&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"userManagement.controls.confirmPassword.errors.match")," "))}function K(s,o){if(1&s&&(e.qex(0),e.j41(1,"mat-form-field",22)(2,"mat-label"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.nrm(5,"input",23),e.DNE(6,j,3,3,"mat-error",8),e.DNE(7,W,3,3,"mat-error",8),e.k0s(),e.j41(8,"mat-form-field",22)(9,"mat-label"),e.EFF(10),e.nI1(11,"transloco"),e.k0s(),e.nrm(12,"input",24),e.DNE(13,L,3,3,"mat-error",8),e.k0s(),e.bVm()),2&s){const r=e.XpG();let t,l,a;e.R7$(3),e.JRh(e.bMT(4,5,"userManagement.controls.password.label")),e.R7$(3),e.Y8G("ngIf",null==(t=r.userForm.get("password"))||null==t.errors?null:t.errors.required),e.R7$(1),e.Y8G("ngIf",null==(l=r.userForm.get("password"))||null==l.errors?null:l.errors.minlength),e.R7$(3),e.JRh(e.bMT(11,7,"userManagement.controls.confirmPassword.label")),e.R7$(3),e.Y8G("ngIf",null==(a=r.userForm.get("confirmPassword"))?null:a.hasError("doesNotMatch"))}}function w(s,o){if(1&s&&(e.qex(0),e.EFF(1),e.nI1(2,"transloco"),e.bVm()),2&s){const r=e.XpG(2);e.R7$(1),e.JRh(e.bMT(2,1,r.userType+".alerts.autoRole"))}}n(36225);const Y=function(s){return{roleId:s}};function X(s,o){if(1&s&&(e.EFF(0),e.nI1(1,"transloco")),2&s){const r=e.XpG(2);e.JRh(e.i5U(1,1,r.userType+".alerts.roleId",e.eq3(4,Y,r.currentProfile.userToAppToRoleByUserId[0].roleId)))}}function V(s,o){if(1&s&&(e.qex(0,30),e.j41(1,"mat-checkbox",31),e.EFF(2),e.nI1(3,"transloco"),e.k0s(),e.bVm()),2&s){const r=o.$implicit;e.Y8G("formGroupName",o.index),e.R7$(2),e.SpI(" ",e.bMT(3,2,"admins.tabs."+r.value.title),"")}}function J(s,o){if(1&s){const r=e.RV6();e.qex(0),e.j41(1,"div")(2,"h3"),e.EFF(3),e.nI1(4,"transloco"),e.k0s(),e.j41(5,"df-alert",25),e.EFF(6),e.nI1(7,"transloco"),e.DNE(8,w,3,3,"ng-container",6),e.DNE(9,X,2,6,"ng-template",null,26,e.C5r),e.k0s(),e.j41(11,"mat-checkbox",27),e.bIt("change",function(l){e.eBV(r);const a=e.XpG();return e.Njj(a.selectAllTabs(l))}),e.EFF(12),e.nI1(13,"transloco"),e.k0s(),e.j41(14,"div",28),e.DNE(15,V,4,4,"ng-container",29),e.k0s()(),e.bVm()}if(2&s){const r=e.sdS(10),t=e.XpG();e.R7$(3),e.JRh(e.bMT(4,9,t.userType+".accessByTabs")),e.R7$(2),e.Y8G("showAlert",!t.allTabsSelected)("dismissible",!1),e.R7$(1),e.SpI(" ",e.bMT(7,11,t.userType+".alerts.restrictedAdmin")," "),e.R7$(2),e.Y8G("ngIf","create"===t.type||0===t.currentProfile.userToAppToRoleByUserId.length)("ngIfElse",r),e.R7$(3),e.Y8G("checked",t.allTabsSelected),e.R7$(1),e.SpI(" ",e.bMT(13,13,"selectAll"),""),e.R7$(3),e.Y8G("ngForOf",t.tabs.controls)}}function H(s,o){if(1&s&&e.nrm(0,"df-user-app-roles",32),2&s){const r=e.XpG();e.Y8G("apps",r.apps)("roles",r.roles)}}let u=class d extends b.s{constructor(o,r,t,l,a,z,Q,Z){super(o,r,t,l,Z),this.translateService=a,this.userService=z,this.router=Q,this.userType="users"}sendInvite(){this.userService.patch(this.currentProfile.id,null,{snackbarSuccess:"inviteSent"}).subscribe()}get userAppRoles(){const o=this.userForm.value.appRoles.map(r=>{const t={userId:this.currentProfile.id,appId:this.apps.find(a=>a.name===r.app)?.id,roleId:this.roles.find(a=>a.name===r.role)?.id};if("create"===this.type)return t;const l=this.currentProfile.userToAppToRoleByUserId.find(a=>a.appId===t.appId&&a.roleId===t.roleId);return l?{...t,id:l.id}:t});return"create"===this.type||this.currentProfile.userToAppToRoleByUserId.filter(r=>!o.find(t=>t.appId===r.appId&&t.roleId===r.roleId)).forEach(r=>{o.push({...r,userId:null})}),o}save(){if(this.userForm.invalid)return;const o={...this.userForm.value.profileDetailsGroup,isActive:this.userForm.value.isActive,lookupByUserId:this.userForm.getRawValue().lookupKeys,userToAppToRoleByUserId:this.userAppRoles};if("create"===this.type){const r="invite"===this.userForm.value["pass-invite"];r||(o.password=this.userForm.value.password),this.userService.create({resource:[o]},{snackbarSuccess:"admins.alerts.createdSuccess",additionalParams:[{key:"send_invite",value:r}]}).pipe((0,E.W)(t=>(this.triggerAlert("error",this.translateService.translate((0,P.u)(t.error.error.context.resource[0].message))),(0,g.$)(()=>new Error(t))))).subscribe(t=>{this.router.navigate(["../",t.resource[0].id],{relativeTo:this.activatedRoute})})}else this.userForm.value.setPassword&&(o.password=this.userForm.value.password),this.userService.update(this.currentProfile.id,o,{snackbarSuccess:"admins.alerts.updateSuccess"}).pipe((0,E.W)(r=>(this.triggerAlert("error",r.error.error.message),(0,g.$)(()=>new Error(r))))).subscribe(r=>{this.router.navigate(["../",r.id],{relativeTo:this.activatedRoute})})}static{this.\u0275fac=function(r){return new(r||d)(e.rXU(i.ok),e.rXU(c.nX),e.rXU($.f),e.rXU(B.R),e.rXU(R.JO),e.rXU(C.Yh),e.rXU(c.Ix),e.rXU(G.o))}}static{this.\u0275cmp=e.VBU({type:d,selectors:[["df-user-details"]],standalone:!0,features:[e.Vt3,e.aNF],decls:25,vars:27,consts:[[3,"showAlert","alertType","alertClosed"],["name","admin-form",3,"formGroup","ngSubmit"],[1,"user-details"],["formGroupName","profileDetailsGroup"],[1,"additional-info"],["color","primary","formControlName","isActive"],[4,"ngIf","ngIfElse"],["editMode",""],[4,"ngIf"],["formArrayName","appRoles",3,"apps","roles",4,"ngIf"],["formArrayName","lookupKeys"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"routerLink"],["mat-flat-button","","color","primary","type","submit",1,"save-btn"],[3,"alertType","showAlert","dismissible"],["formControlName","pass-invite",1,"pass-invite"],["value","invite",1,"userform-invite-radio-btn"],["value","password",1,"userform-password-radio-btn"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[3,"icon"],["formControlName","setPassword"],["appearance","outline"],["matInput","","type","password","formControlName","password",1,"user-details-set-password"],["matInput","","type","password","formControlName","confirmPassword",1,"user-details-confirm-password"],["alertType","warning",3,"showAlert","dismissible"],["hasRole",""],[3,"checked","change"],["formArrayName","tabs",1,"access-tabs"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["formControlName","checked"],["formArrayName","appRoles",3,"apps","roles"]],template:function(r,t){if(1&r&&(e.j41(0,"df-alert",0),e.bIt("alertClosed",function(){return t.showAlert=!1}),e.EFF(1),e.k0s(),e.j41(2,"form",1),e.bIt("ngSubmit",function(){return t.save()}),e.nI1(3,"async"),e.j41(4,"div",2),e.nI1(5,"async"),e.nrm(6,"df-profile-details",3),e.j41(7,"div",4)(8,"mat-slide-toggle",5),e.EFF(9),e.nI1(10,"transloco"),e.k0s(),e.DNE(11,S,12,15,"ng-container",6),e.DNE(12,N,5,6,"ng-template",null,7,e.C5r),e.DNE(14,K,14,9,"ng-container",8),e.DNE(15,J,16,15,"ng-container",8),e.k0s()(),e.DNE(16,H,1,2,"df-user-app-roles",9),e.nrm(17,"df-lookup-keys",10),e.j41(18,"div",11)(19,"button",12),e.EFF(20),e.nI1(21,"transloco"),e.k0s(),e.j41(22,"button",13),e.EFF(23),e.nI1(24,"transloco"),e.k0s()()()),2&r){const l=e.sdS(13);let a;e.Y8G("showAlert",t.showAlert)("alertType",t.alertType),e.R7$(1),e.SpI(" ",t.alertMsg,"\n"),e.R7$(1),e.HbH(e.bMT(3,17,t.isDarkMode)?"dark-theme":""),e.Y8G("formGroup",t.userForm),e.R7$(2),e.AVh("small",e.bMT(5,19,t.isSmallScreen)),e.R7$(5),e.JRh(e.bMT(10,21,"active")),e.R7$(2),e.Y8G("ngIf","create"===t.type)("ngIfElse",l),e.R7$(3),e.Y8G("ngIf","password"===(null==(a=t.userForm.get("pass-invite"))?null:a.value)||(null==(a=t.userForm.get("setPassword"))?null:a.value)),e.R7$(1),e.Y8G("ngIf",t.accessByTabs.length>0&&"admins"===t.userType&&("create"===t.type||"edit"===t.type&&!t.currentProfile.isRootAdmin)),e.R7$(1),e.Y8G("ngIf","users"===t.userType),e.R7$(3),e.Y8G("routerLink",t.cancelRoute),e.R7$(1),e.SpI(" ",e.bMT(21,23,"cancel")," "),e.R7$(3),e.SpI(" ",e.bMT(24,25,"create"===t.type?"create":"update")," ")}},dependencies:[y.W,i.X1,i.qT,i.me,i.BC,i.cb,i.j4,i.JD,i.$R,i.v8,U.D,h.mV,h.sG,m.bT,p.Wk,p.VT,p._g,M.Hl,M.$z,T.dX,T.aY,I.g7,I.So,_.RG,_.rl,_.nJ,_.TL,D.fS,D.fg,m.pM,F.N,O.S,c.Wk,m.Jj,R.Kj],styles:[".user-details[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:32px}.user-details.small[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.user-details[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.user-details[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.user-details[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}.user-details[_ngcontent-%COMP%]   .access-tabs[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-wrap:wrap;max-height:240px}"]})}};u=(0,v.Cg)([(0,A.d)({checkProperties:!0})],u)}}]);