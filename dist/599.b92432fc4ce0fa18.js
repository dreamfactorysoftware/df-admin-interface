"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[599],{62810:(Z,b,i)=>{i.d(b,{E:()=>P});var m,T=i(97582),d=i(96814),c=i(56223),g=i(32296),_=i(17700),a=i(64170),u=i(2032),p=i(98525),h=i(75986),I=i(42346),v=i(86806),A=i(30977),U=i(78791),e=i(13011),L=i(41609),D=i(94664),t=i(65879),S=i(65763);function f(l,s){if(1&l&&(t.TgZ(0,"mat-form-field",11)(1,"mat-label"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"input",12),t.qZA()),2&l){const o=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"path")),t.xp6(2),t.Q6J("formControl",o.storagePath)}}function n(l,s){if(1&l&&(t.ynx(0),t.YNc(1,f,5,4,"mat-form-field",10),t.BQk()),2&l){const o=t.oxw();t.xp6(1),t.Q6J("ngIf",!o.storageServiceId||!o.storageServiceId.getRawValue())}}function r(l,s){if(1&l){const o=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(o);const E=t.oxw(2);return t.KtG(E.deleteCache())}),t._uU(1),t.ALo(2,"transloco"),t.qZA()}2&l&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"scripts.deleteCache")," "))}function O(l,s){if(1&l){const o=t.EpF();t.TgZ(0,"div",13)(1,"button",14),t.NdJ("click",function(){t.CHM(o);const E=t.oxw();return t.KtG(E.viewLatest())}),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t.YNc(4,r,3,3,"button",15),t.qZA()}if(2&l){const o=t.oxw();t.xp6(1),t.Q6J("disabled",!o.storageServiceId||!o.storageServiceId.getRawValue()),t.xp6(1),t.hij(" ",t.lcZ(3,3,"scripts.viewLatest")," "),t.xp6(2),t.Q6J("ngIf",o.cache)}}function x(l,s){1&l&&(t.TgZ(0,"span"),t._uU(1,"Script Contents"),t.qZA())}i(6625);let P=((m=class{constructor(s,o,C,E,M){this.dialog=s,this.fileService=o,this.cacheService=C,this.baseService=E,this.themeService=M,this.storageServices=[],this.checked=!1,this.isDarkMode=this.themeService.darkMode$,this.baseService.getAll({additionalParams:[{key:"group",value:"source control,file"}]}).subscribe(K=>{this.storageServices=K.services})}ngOnInit(){this.storageServiceId.getRawValue()&&this.storagePath.addValidators([c.kI.required]),this.storageServiceId.valueChanges.subscribe(s=>{this.storagePath.reset(),s?this.storagePath.addValidators([c.kI.required]):this.storagePath.hasValidator(c.kI.required)&&this.storagePath.removeValidators([c.kI.required]),this.storagePath.updateValueAndValidity()})}fileUpload(s){const o=s.target;o.files&&(0,A.Vu)(o.files[0]).subscribe(C=>{this.content.setValue(C)})}githubImport(){this.dialog.open(e.e).afterClosed().subscribe(o=>{o&&this.content.setValue(window.atob(o.data.content))})}viewLatest(){const s=`${this.storageServices.find(o=>o.id===this.storageServiceId.getRawValue())?.name}/${this.storagePath.getRawValue()}`;s.endsWith(".json")?this.fileService.downloadJson(s).subscribe(o=>this.content.setValue(o)):this.fileService.downloadFile(s).pipe((0,D.w)(o=>(0,A.Vu)(o))).subscribe(o=>this.content.setValue(o))}deleteCache(){this.cache&&this.cacheService.delete(`_event/${this.cache}`,{snackbarSuccess:"scripts.deleteCacheSuccessMsg"}).subscribe()}}).\u0275fac=function(s){return new(s||m)(t.Y36(_.uw),t.Y36(v.PA),t.Y36(v.OP),t.Y36(v.PA),t.Y36(S.F))},m.\u0275cmp=t.Xpm({type:m,selectors:[["df-script-editor"]],inputs:{isScript:"isScript",cache:"cache",type:"type",storageServiceId:"storageServiceId",storagePath:"storagePath",content:"content"},standalone:!0,features:[t.jDz],decls:18,vars:18,consts:[[1,"details-section"],[1,"actions","full-width"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],["type","button","mat-flat-button","",1,"save-btn",3,"disabled","click"],[3,"ngModel","ngModelChange"],[4,"ngIf"],["class","actions",4,"ngIf"],[1,"content"],[1,"full-width",3,"formControl","mode"],["class","full-width","subscriptSizing","dynamic",4,"ngIf"],["subscriptSizing","dynamic",1,"full-width"],["matInput","",3,"formControl"],[1,"actions"],["mat-flat-button","","color","primary","type","button",3,"disabled","click"],["mat-flat-button","","color","primary","type","button",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","button",3,"click"]],template:function(s,o){if(1&s){const C=t.EpF();t.TgZ(0,"div",0),t.ALo(1,"async"),t.TgZ(2,"div",1)(3,"input",2,3),t.NdJ("change",function(M){return o.fileUpload(M)}),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){t.CHM(C);const M=t.MAs(4);return t.KtG(M.click())}),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t.TgZ(8,"button",4),t.NdJ("click",function(){return o.githubImport()}),t._uU(9),t.ALo(10,"transloco"),t.qZA()(),t.TgZ(11,"mat-checkbox",5),t.NdJ("ngModelChange",function(M){return o.checked=M}),t._uU(12," Add path to file"),t.qZA(),t.YNc(13,n,2,1,"ng-container",6),t.YNc(14,O,5,5,"div",7),t.TgZ(15,"div",8),t.YNc(16,x,2,0,"span",6),t._UZ(17,"df-ace-editor",9),t.qZA()()}2&s&&(t.Tol(t.lcZ(1,12,o.isDarkMode)?"dark-theme":""),t.xp6(5),t.Q6J("disabled",!o.storageServiceId),t.xp6(1),t.hij(" ",t.lcZ(7,14,"desktopFile")," "),t.xp6(2),t.Q6J("disabled",!o.storageServiceId),t.xp6(1),t.hij(" ",t.lcZ(10,16,"githubFile")," "),t.xp6(2),t.Q6J("ngModel",o.checked),t.xp6(2),t.Q6J("ngIf",o.checked),t.xp6(1),t.Q6J("ngIf",o.storageServiceId.getRawValue()),t.xp6(2),t.Q6J("ngIf",o.isScript),t.xp6(1),t.Q6J("formControl",o.content)("mode",o.type.getRawValue()))},dependencies:[g.ot,g.lW,I.Ot,d.O5,a.lN,a.KE,a.hX,p.LD,h.p9,h.oG,c.u5,c.Fj,c.JJ,c.On,_.Is,u.c,u.Nt,L.C,d.Ov,c.UX,c.oH],styles:[".actions[_ngcontent-%COMP%]{display:flex;gap:16px}.content[_ngcontent-%COMP%]{margin-top:8px;display:flex;flex-direction:column;gap:6px;width:100%}.content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}"]}),m);P=(0,T.gn)([(0,U.c)({checkProperties:!0})],P)},13011:(Z,b,i)=>{i.d(b,{e:()=>m});var D,T=i(97582),d=i(17700),c=i(32296),g=i(2032),_=i(64170),a=i(56223),u=i(26306),p=i(58504),h=i(96814),I=i(42346),v=i(86806),A=i(78791),U=i(66645),e=i(65879);function t(f,n){1&f&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&f&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"scripts.errors.githubImport")," "))}function S(f,n){1&f&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"GitHub Username"),e.qZA(),e._UZ(3,"input",9),e.qZA())}function R(f,n){1&f&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"GitHub Token"),e.qZA(),e._UZ(3,"input",10),e.qZA())}i(6625);let m=((D=class{constructor(n,r,O){this.githubService=n,this.formBuilder=r,this.dialogRef=O,this.isGitRepoPrivate=!1,this.formGroup=r.group({url:["",[a.kI.required,this.urlValidator]]})}ngOnInit(){this.formGroup.controls.url.valueChanges.subscribe(n=>{if((0,U.HH)(n)&&(n.indexOf(".js")>0||n.indexOf(".py")>0||n.indexOf(".php")>0||n.indexOf(".txt")>0)&&n.includes("github")){const O=n.substring(n.indexOf(".com/")+5).split("/");this.repoOwner=O[0],this.repoName=O[1],this.fileName=O.slice(4).join("/"),this.githubService.get(`${this.repoOwner}/${this.repoName}`,{snackbarError:"server",snackbarSuccess:"getScriptSuccessMsg",includeCacheControl:!1}).pipe((0,u.K)(P=>(this.isGitRepoPrivate=!0,this.formGroup.addControl("username",this.formBuilder.control("",a.kI.required)),this.formGroup.addControl("password",this.formBuilder.control("",a.kI.required)),(0,p._)(()=>new Error(P))))).subscribe(P=>{this.isGitRepoPrivate=P.private})}})}urlValidator(n){const r=n.value;return(r.indexOf(".js")>0||r.indexOf(".py")>0||r.indexOf(".php")>0||r.indexOf(".txt")>0)&&r.includes("github")?null:{invalidUrl:!0}}onFileUrlChange(n){}onUpload(){this.formGroup.invalid||this.githubService.getFileContent(`${this.repoOwner}/${this.repoName}/contents/${this.fileName}`,this.formGroup.value.username,this.formGroup.value.password).subscribe(r=>{this.dialogRef.close({data:r})})}}).\u0275fac=function(n){return new(n||D)(e.Y36(v.mx),e.Y36(a.qu),e.Y36(d.so))},D.\u0275cmp=e.Xpm({type:D,selectors:[["df-scripts-github-dialog"]],standalone:!0,features:[e.jDz],decls:18,vars:10,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"details-section",3,"formGroup"],["subscriptSizing","dynamic"],["matInput","","formControlName","url","placeholder","https://github.com/user/repo/blob/file.json"],[4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],["matInput","","formControlName","username","placeholder","Username","type","text"],["matInput","","formControlName","password","placeholder","Personal Access Token","type","text"]],template:function(n,r){1&n&&(e.TgZ(0,"h1",0),e._uU(1,"Import a script file from GitHub"),e.qZA(),e.TgZ(2,"div",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),e._uU(6,"GitHub File URL"),e.qZA(),e._UZ(7,"input",4),e.YNc(8,t,3,3,"mat-error",5),e.qZA(),e.YNc(9,S,4,0,"mat-form-field",5),e.YNc(10,R,4,0,"mat-form-field",5),e.qZA()(),e.TgZ(11,"div",6)(12,"button",7),e._uU(13),e.ALo(14,"transloco"),e.qZA(),e.TgZ(15,"button",8),e.NdJ("click",function(){return r.onUpload()}),e._uU(16),e.ALo(17,"transloco"),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("formGroup",r.formGroup),e.xp6(5),e.Q6J("ngIf",null==r.formGroup.controls.url.errors?null:r.formGroup.controls.url.errors.invalidUrl),e.xp6(1),e.Q6J("ngIf",r.formGroup.contains("username")),e.xp6(1),e.Q6J("ngIf",r.formGroup.contains("password")),e.xp6(3),e.Oqu(e.lcZ(14,6,"close")),e.xp6(3),e.hij(" ",e.lcZ(17,8,"upload")," "))},dependencies:[c.ot,c.lW,d.Is,d.ZT,d.uh,d.xY,d.H8,_.lN,_.KE,_.hX,_.TO,g.c,g.Nt,a.UX,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,h.O5,I.Ot]}),D);m=(0,T.gn)([(0,A.c)({checkProperties:!0})],m)},15711:(Z,b,i)=>{i.d(b,{H:()=>c,p:()=>d});var T=i(94517);function d(g){return Object.values((0,T.sh)(g)).flatMap(_=>Object.entries(_).map(([a,u])=>{let p=[];return p=u.parameter?u.endpoints.flatMap(h=>{const I=h.match(/{(.*?)}/);if(I){const v=I[1];return[h,...(u.parameter?.[v]||[]).map(U=>h.replace(`{${v}}`,U))]}return h}):u.endpoints,{name:a,endpoints:[...new Set(p)]}}))}function c(g){const _=[],a=new Set;for(const u of g){const p=u.split(".")[0];a.has(p)||(a.add(p),_.push(`${p}.*`)),_.push(u)}return _}}}]);