"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[4791],{47787:(k,C,i)=>{i.d(C,{S:()=>v});var O=i(31635),p=i(60177),c=i(89417),h=i(88834),d=i(75351),r=i(32102),f=i(99631),m=i(82798),E=i(82765),P=i(33609),g=i(24784),I=i(63035),R=i(49894),e=i(48391),L=i(63281),G=i(25558),t=i(17705),B=i(52868);function D(u,l){if(1&u&&(t.j41(0,"mat-form-field",11)(1,"mat-label"),t.EFF(2),t.nI1(3,"transloco"),t.k0s(),t.nrm(4,"input",12),t.k0s()),2&u){const n=t.XpG(2);t.R7$(2),t.JRh(t.bMT(3,2,"path")),t.R7$(2),t.Y8G("formControl",n.storagePath)}}function o(u,l){if(1&u&&(t.qex(0),t.DNE(1,D,5,4,"mat-form-field",10),t.bVm()),2&u){const n=t.XpG();t.R7$(1),t.Y8G("ngIf",!n.storageServiceId||!n.storageServiceId.getRawValue())}}function a(u,l){if(1&u){const n=t.RV6();t.j41(0,"button",16),t.bIt("click",function(){t.eBV(n);const M=t.XpG(2);return t.Njj(M.deleteCache())}),t.EFF(1),t.nI1(2,"transloco"),t.k0s()}2&u&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"scripts.deleteCache")," "))}function _(u,l){if(1&u){const n=t.RV6();t.j41(0,"div",13)(1,"button",14),t.bIt("click",function(){t.eBV(n);const M=t.XpG();return t.Njj(M.viewLatest())}),t.EFF(2),t.nI1(3,"transloco"),t.k0s(),t.DNE(4,a,3,3,"button",15),t.k0s()}if(2&u){const n=t.XpG();t.R7$(1),t.Y8G("disabled",!n.storageServiceId||!n.storageServiceId.getRawValue()),t.R7$(1),t.SpI(" ",t.bMT(3,3,"scripts.viewLatest")," "),t.R7$(2),t.Y8G("ngIf",n.cache)}}function U(u,l){1&u&&(t.j41(0,"span"),t.EFF(1,"Script Contents"),t.k0s())}i(36225);let v=class A{constructor(l,n,s,M,S){this.dialog=l,this.fileService=n,this.cacheService=s,this.baseService=M,this.themeService=S,this.storageServices=[],this.checked=!1,this.isDarkMode=this.themeService.darkMode$,this.baseService.getAll({additionalParams:[{key:"group",value:"source control,file"}]}).subscribe(b=>{this.storageServices=b.services})}ngOnInit(){this.storageServiceId.getRawValue()&&this.storagePath.addValidators([c.k0.required]),this.storageServiceId.valueChanges.subscribe(l=>{this.storagePath.reset(),l?this.storagePath.addValidators([c.k0.required]):this.storagePath.hasValidator(c.k0.required)&&this.storagePath.removeValidators([c.k0.required]),this.storagePath.updateValueAndValidity()})}fileUpload(l){const n=l.target;n.files&&(0,I.Sj)(n.files[0]).subscribe(s=>{this.content.setValue(s)})}githubImport(){this.dialog.open(e.z).afterClosed().subscribe(n=>{n&&this.content.setValue(window.atob(n.data.content))})}viewLatest(){const l=`${this.storageServices.find(n=>n.id===this.storageServiceId.getRawValue())?.name}/${this.storagePath.getRawValue()}`;l.endsWith(".json")?this.fileService.downloadJson(l).subscribe(n=>this.content.setValue(n)):this.fileService.downloadFile(l).pipe((0,G.n)(n=>(0,I.Sj)(n))).subscribe(n=>this.content.setValue(n))}deleteCache(){this.cache&&this.cacheService.delete(`_event/${this.cache}`,{snackbarSuccess:"scripts.deleteCacheSuccessMsg"}).subscribe()}static{this.\u0275fac=function(n){return new(n||A)(t.rXU(d.bZ),t.rXU(g.qJ),t.rXU(g.j8),t.rXU(g.qJ),t.rXU(B.n))}}static{this.\u0275cmp=t.VBU({type:A,selectors:[["df-script-editor"]],inputs:{isScript:"isScript",cache:"cache",type:"type",storageServiceId:"storageServiceId",storagePath:"storagePath",content:"content"},standalone:!0,features:[t.aNF],decls:18,vars:18,consts:[[1,"details-section"],[1,"actions","full-width"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],["type","button","mat-flat-button","",1,"save-btn",3,"disabled","click"],[3,"ngModel","ngModelChange"],[4,"ngIf"],["class","actions",4,"ngIf"],[1,"content"],[1,"full-width",3,"formControl","mode"],["class","full-width","subscriptSizing","dynamic",4,"ngIf"],["subscriptSizing","dynamic",1,"full-width"],["matInput","",3,"formControl"],[1,"actions"],["mat-flat-button","","color","primary","type","button",3,"disabled","click"],["mat-flat-button","","color","primary","type","button",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","button",3,"click"]],template:function(n,s){if(1&n){const M=t.RV6();t.j41(0,"div",0),t.nI1(1,"async"),t.j41(2,"div",1)(3,"input",2,3),t.bIt("change",function(b){return s.fileUpload(b)}),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){t.eBV(M);const b=t.sdS(4);return t.Njj(b.click())}),t.EFF(6),t.nI1(7,"transloco"),t.k0s(),t.j41(8,"button",4),t.bIt("click",function(){return s.githubImport()}),t.EFF(9),t.nI1(10,"transloco"),t.k0s()(),t.j41(11,"mat-checkbox",5),t.bIt("ngModelChange",function(b){return s.checked=b}),t.EFF(12," Add path to file"),t.k0s(),t.DNE(13,o,2,1,"ng-container",6),t.DNE(14,_,5,5,"div",7),t.j41(15,"div",8),t.DNE(16,U,2,0,"span",6),t.nrm(17,"df-ace-editor",9),t.k0s()()}2&n&&(t.HbH(t.bMT(1,12,s.isDarkMode)?"dark-theme":""),t.R7$(5),t.Y8G("disabled",!s.storageServiceId),t.R7$(1),t.SpI(" ",t.bMT(7,14,"desktopFile")," "),t.R7$(2),t.Y8G("disabled",!s.storageServiceId),t.R7$(1),t.SpI(" ",t.bMT(10,16,"githubFile")," "),t.R7$(2),t.Y8G("ngModel",s.checked),t.R7$(2),t.Y8G("ngIf",s.checked),t.R7$(1),t.Y8G("ngIf",s.storageServiceId.getRawValue()),t.R7$(2),t.Y8G("ngIf",s.isScript),t.R7$(1),t.Y8G("formControl",s.content)("mode",s.type.getRawValue()))},dependencies:[h.Hl,h.$z,P.Kj,p.bT,r.RG,r.rl,r.nJ,m.Ve,E.g7,E.So,c.YN,c.me,c.BC,c.vS,d.hM,f.fS,f.fg,L.s,p.Jj,c.X1,c.l_],styles:[".actions[_ngcontent-%COMP%]{display:flex;gap:16px}.content[_ngcontent-%COMP%]{margin-top:8px;display:flex;flex-direction:column;gap:6px;width:100%}.content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}"]})}};v=(0,O.Cg)([(0,R.d)({checkProperties:!0})],v)},48391:(k,C,i)=>{i.d(C,{z:()=>T});var O=i(31635),p=i(75351),c=i(88834),h=i(99631),d=i(32102),r=i(89417),f=i(99437),m=i(18810),E=i(60177),P=i(33609),g=i(24784),I=i(49894),R=i(94884),e=i(17705);function G(D,o){1&D&&(e.j41(0,"mat-error"),e.EFF(1),e.nI1(2,"transloco"),e.k0s()),2&D&&(e.R7$(1),e.SpI(" ",e.bMT(2,1,"scripts.errors.githubImport")," "))}function t(D,o){1&D&&(e.j41(0,"mat-form-field")(1,"mat-label"),e.EFF(2,"GitHub Username"),e.k0s(),e.nrm(3,"input",9),e.k0s())}function B(D,o){1&D&&(e.j41(0,"mat-form-field")(1,"mat-label"),e.EFF(2,"GitHub Token"),e.k0s(),e.nrm(3,"input",10),e.k0s())}i(36225);let T=class j{constructor(o,a,_){this.githubService=o,this.formBuilder=a,this.dialogRef=_,this.isGitRepoPrivate=!1,this.formGroup=a.group({url:["",[r.k0.required,this.urlValidator]]})}ngOnInit(){this.formGroup.controls.url.valueChanges.subscribe(o=>{if((0,R.U8)(o)&&(o.indexOf(".js")>0||o.indexOf(".py")>0||o.indexOf(".php")>0||o.indexOf(".txt")>0)&&o.includes("github")){const _=o.substring(o.indexOf(".com/")+5).split("/");this.repoOwner=_[0],this.repoName=_[1],this.fileName=_.slice(4).join("/"),this.githubService.get(`${this.repoOwner}/${this.repoName}`,{snackbarError:"server",snackbarSuccess:"getScriptSuccessMsg",includeCacheControl:!1}).pipe((0,f.W)(v=>(this.isGitRepoPrivate=!0,this.formGroup.addControl("username",this.formBuilder.control("",r.k0.required)),this.formGroup.addControl("password",this.formBuilder.control("",r.k0.required)),(0,m.$)(()=>new Error(v))))).subscribe(v=>{this.isGitRepoPrivate=v.private})}})}urlValidator(o){const a=o.value;return(a.indexOf(".js")>0||a.indexOf(".py")>0||a.indexOf(".php")>0||a.indexOf(".txt")>0)&&a.includes("github")?null:{invalidUrl:!0}}onFileUrlChange(o){}onUpload(){this.formGroup.invalid||this.githubService.getFileContent(`${this.repoOwner}/${this.repoName}/contents/${this.fileName}`,this.formGroup.value.username,this.formGroup.value.password).subscribe(a=>{this.dialogRef.close({data:a})})}static{this.\u0275fac=function(a){return new(a||j)(e.rXU(g.J4),e.rXU(r.ok),e.rXU(p.CP))}}static{this.\u0275cmp=e.VBU({type:j,selectors:[["df-scripts-github-dialog"]],standalone:!0,features:[e.aNF],decls:18,vars:10,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"details-section",3,"formGroup"],["subscriptSizing","dynamic"],["matInput","","formControlName","url","placeholder","https://github.com/user/repo/blob/file.json"],[4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],["matInput","","formControlName","username","placeholder","Username","type","text"],["matInput","","formControlName","password","placeholder","Personal Access Token","type","text"]],template:function(a,_){1&a&&(e.j41(0,"h1",0),e.EFF(1,"Import a script file from GitHub"),e.k0s(),e.j41(2,"div",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),e.EFF(6,"GitHub File URL"),e.k0s(),e.nrm(7,"input",4),e.DNE(8,G,3,3,"mat-error",5),e.k0s(),e.DNE(9,t,4,0,"mat-form-field",5),e.DNE(10,B,4,0,"mat-form-field",5),e.k0s()(),e.j41(11,"div",6)(12,"button",7),e.EFF(13),e.nI1(14,"transloco"),e.k0s(),e.j41(15,"button",8),e.bIt("click",function(){return _.onUpload()}),e.EFF(16),e.nI1(17,"transloco"),e.k0s()()),2&a&&(e.R7$(3),e.Y8G("formGroup",_.formGroup),e.R7$(5),e.Y8G("ngIf",null==_.formGroup.controls.url.errors?null:_.formGroup.controls.url.errors.invalidUrl),e.R7$(1),e.Y8G("ngIf",_.formGroup.contains("username")),e.R7$(1),e.Y8G("ngIf",_.formGroup.contains("password")),e.R7$(3),e.JRh(e.bMT(14,6,"close")),e.R7$(3),e.SpI(" ",e.bMT(17,8,"upload")," "))},dependencies:[c.Hl,c.$z,p.hM,p.tx,p.BI,p.Yi,p.E7,d.RG,d.rl,d.nJ,d.TL,h.fS,h.fg,r.X1,r.qT,r.me,r.BC,r.cb,r.j4,r.JD,E.bT,P.Kj]})}};T=(0,O.Cg)([(0,I.d)({checkProperties:!0})],T)},59757:(k,C,i)=>{i.d(C,{$:()=>c,l:()=>p});var O=i(60169);function p(h){return Object.values((0,O.SM)(h)).flatMap(d=>Object.entries(d).map(([r,f])=>{let m=[];return m=f.parameter?f.endpoints.flatMap(E=>{const P=E.match(/{(.*?)}/);if(P){const g=P[1];return[E,...(f.parameter?.[g]||[]).map(R=>E.replace(`{${g}}`,R))]}return E}):f.endpoints,{name:r,endpoints:[...new Set(m)]}}))}function c(h){const d=[],r=new Set;for(const f of h){const m=f.split(".")[0];r.has(m)||(r.add(m),d.push(`${m}.*`)),d.push(f)}return d}}}]);