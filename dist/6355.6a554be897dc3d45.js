"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[6355],{16355:(z,k,c)=>{c.r(k),c.d(k,{DfRoleDetailsComponent:()=>H});var w,d=c(97582),s=c(56223),g=c(96814),y=c(42346),v=c(86806),h=c(64170),R=c(84870),C=c(2032),b=c(82599),A=c(32296),Z=c(15861),f=c(25313),N=c(90590),t=c(98525),O=c(3305),T=c(45597),M=c(49488),q=c(78791),K=c(65619),D=c(86825),e=c(65879),P=c(81896),J=c(23680);function Q(a,n){1&a&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.service")," "))}function Y(a,n){if(1&a&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&a){const o=n.$implicit;e.Q6J("value",o.id),e.xp6(1),e.Oqu(o.name)}}function B(a,n){1&a&&(e.TgZ(0,"mat-error"),e._uU(1," Service is required "),e.qZA())}function S(a,n){if(1&a){const o=e.EpF();e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",20),e.NdJ("selectionChange",function(){const i=e.CHM(o).dataIndex,p=e.oxw();return e.KtG(p.getComponents(p.getFormArrayIndex(i)))}),e.TgZ(6,"mat-option",21),e._uU(7,"All"),e.qZA(),e.YNc(8,Y,2,2,"mat-option",22),e.qZA(),e.YNc(9,B,2,0,"mat-error",23),e.qZA()()}if(2&a){const o=n.dataIndex,r=e.oxw();let l;e.Q6J("formGroupName",r.getFormArrayIndex(o)),e.xp6(3),e.Oqu(e.lcZ(4,5,"roles.accessOverview.tableHeadings.service")),e.xp6(3),e.Q6J("value",0),e.xp6(2),e.Q6J("ngForOf",r.serviceOptions),e.xp6(1),e.Q6J("ngIf",null==r.formArray.controls[r.getFormArrayIndex(o)]||null==(l=r.formArray.controls[r.getFormArrayIndex(o)].get("service"))?null:l.hasError("required"))}}function U(a,n){1&a&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.component")," "))}function m(a,n){if(1&a&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&a){const o=n.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o)}}function u(a,n){1&a&&(e.TgZ(0,"mat-error"),e._uU(1," Component is required "),e.qZA())}function _(a,n){if(1&a&&(e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",24),e.YNc(6,m,2,2,"mat-option",22),e.qZA(),e.YNc(7,u,2,0,"mat-error",23),e.qZA()()),2&a){const o=n.dataIndex,r=e.oxw();let l;e.Q6J("formGroupName",r.getFormArrayIndex(o)),e.xp6(3),e.Oqu(e.lcZ(4,4,"roles.accessOverview.tableHeadings.component")),e.xp6(3),e.Q6J("ngForOf",r.getComponentArray(r.getFormArrayIndex(o))),e.xp6(1),e.Q6J("ngIf",null==r.formArray.controls[r.getFormArrayIndex(o)]||null==(l=r.formArray.controls[r.getFormArrayIndex(o)].get("component"))?null:l.hasError("required"))}}function F(a,n){1&a&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.access")," "))}function L(a,n){if(1&a&&(e.TgZ(0,"span",27),e._uU(1),e.qZA()),2&a){const o=e.oxw(2).dataIndex,r=e.oxw();e.xp6(1),e.AsE(" (+",((null==r.formArray.controls[r.getFormArrayIndex(o)]?null:r.formArray.controls[r.getFormArrayIndex(o)].value.access.length)||0)-1," ",2===(null==r.formArray.controls[r.getFormArrayIndex(o)]?null:r.formArray.controls[r.getFormArrayIndex(o)].value.access.length)?"other":"others",") ")}}function V(a,n){if(1&a&&(e.TgZ(0,"mat-option",21),e._uU(1),e.YNc(2,L,2,2,"span",26),e.qZA()),2&a){const o=n.$implicit,r=e.oxw().dataIndex,l=e.oxw();e.Q6J("value",o.value),e.xp6(1),e.hij("",o.label," "),e.xp6(1),e.Q6J("ngIf",((null==l.formArray.controls[l.getFormArrayIndex(r)]?null:l.formArray.controls[l.getFormArrayIndex(r)].value.access.length)||0)>1)}}function G(a,n){1&a&&(e.TgZ(0,"mat-error"),e._uU(1," Access is required "),e.qZA())}function oe(a,n){if(1&a){const o=e.EpF();e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",25),e.NdJ("selectionChange",function(l){const p=e.CHM(o).dataIndex,x=e.oxw();return e.KtG(x.accessChange(x.getFormArrayIndex(p),l.value))}),e.YNc(6,V,3,3,"mat-option",22),e.qZA(),e.YNc(7,G,2,0,"mat-error",23),e.qZA()()}if(2&a){const o=n.dataIndex,r=e.oxw();let l;e.Q6J("formGroupName",r.getFormArrayIndex(o)),e.xp6(3),e.Oqu(e.lcZ(4,4,"roles.accessOverview.tableHeadings.access")),e.xp6(3),e.Q6J("ngForOf",r.accessOptions),e.xp6(1),e.Q6J("ngIf",null==r.formArray.controls[r.getFormArrayIndex(o)]||null==(l=r.formArray.controls[r.getFormArrayIndex(o)].get("access"))?null:l.hasError("required"))}}function ne(a,n){1&a&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.requester")," "))}function re(a,n){if(1&a&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&a){const o=n.$implicit;e.Q6J("value",o.value),e.xp6(1),e.Oqu(o.label)}}function ae(a,n){if(1&a&&(e.TgZ(0,"td",18)(1,"mat-form-field",19)(2,"mat-label"),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"mat-select",28),e.YNc(6,re,2,2,"mat-option",22),e.qZA()()()),2&a){const o=n.dataIndex,r=e.oxw();e.Q6J("formGroupName",r.getFormArrayIndex(o)),e.xp6(3),e.Oqu(e.lcZ(4,3,"roles.accessOverview.tableHeadings.requester")),e.xp6(3),e.Q6J("ngForOf",r.requesterOptions)}}function se(a,n){1&a&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.accessOverview.tableHeadings.advancedFilters")," "))}function le(a,n){if(1&a){const o=e.EpF();e.TgZ(0,"td",18)(1,"button",29),e.NdJ("click",function(){const l=e.CHM(o),i=l.$implicit,p=l.dataIndex,x=e.oxw();return e.KtG(x.toggleRow(i,x.getFormArrayIndex(p)))}),e._UZ(2,"fa-icon",30),e.qZA()()}if(2&a){const o=n.dataIndex,r=e.oxw();e.Q6J("formGroupName",r.getFormArrayIndex(o)),e.xp6(2),e.Q6J("icon",r.faPlus)}}function ie(a,n){if(1&a){const o=e.EpF();e.TgZ(0,"th",17)(1,"button",31),e.NdJ("click",function(){e.CHM(o);const l=e.oxw();return e.KtG(l.add())}),e.ALo(2,"transloco"),e._UZ(3,"fa-icon",32),e.qZA()()}if(2&a){const o=e.oxw();e.xp6(1),e.uIk("aria-label",e.lcZ(2,2,"newEntry")),e.xp6(2),e.Q6J("icon",o.faPlus)}}function ce(a,n){if(1&a){const o=e.EpF();e.TgZ(0,"td",18)(1,"button",33),e.NdJ("click",function(){const i=e.CHM(o).dataIndex,p=e.oxw();return e.KtG(p.remove(i))}),e._UZ(2,"fa-icon",30),e.qZA()()}if(2&a){const o=n.dataIndex,r=e.oxw();e.Q6J("formGroupName",r.getFormArrayIndex(o)),e.xp6(2),e.Q6J("icon",r.faTrashCan)}}function me(a,n){if(1&a&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&a){const o=n.$implicit;e.Q6J("value",o.value),e.xp6(1),e.Oqu(o.label)}}function de(a,n){if(1&a){const o=e.EpF();e.ynx(0),e.TgZ(1,"div",36)(2,"mat-form-field",19)(3,"mat-label"),e._uU(4,"Field"),e.qZA(),e._UZ(5,"input",37),e.qZA(),e.TgZ(6,"mat-form-field",19)(7,"mat-label"),e._uU(8,"Operator"),e.qZA(),e.TgZ(9,"mat-select",38),e.YNc(10,me,2,2,"mat-option",22),e.qZA()(),e.TgZ(11,"mat-form-field",19)(12,"mat-label"),e._uU(13,"Value"),e.qZA(),e._UZ(14,"input",39),e.qZA(),e.TgZ(15,"div")(16,"mat-button-toggle-group",40),e.NdJ("change",function(l){e.CHM(o);const i=e.oxw().dataIndex,p=e.oxw();return e.KtG(p.filterOpChange(l,p.getFormArrayIndex(i)))}),e.TgZ(17,"mat-button-toggle",41),e._uU(18,"AND"),e.qZA(),e.TgZ(19,"mat-button-toggle",42),e._uU(20,"OR"),e.qZA()()(),e.TgZ(21,"button",43),e.NdJ("click",function(){e.CHM(o);const l=e.oxw().dataIndex,i=e.oxw();return e.KtG(i.addAdvancedFilter(i.getFormArrayIndex(l)))}),e._UZ(22,"fa-icon",30),e.qZA(),e.TgZ(23,"button",43),e.NdJ("click",function(){const i=e.CHM(o).index,p=e.oxw().dataIndex,x=e.oxw();return e.KtG(x.removeAdvancedFilter(x.getFormArrayIndex(p),i))}),e._UZ(24,"fa-icon",30),e.qZA()(),e.BQk()}if(2&a){const o=n.index,r=e.oxw(2);e.xp6(1),e.Q6J("formArrayName",o),e.xp6(9),e.Q6J("ngForOf",r.operatorOptions),e.xp6(12),e.Q6J("icon",r.faPlus),e.xp6(2),e.Q6J("icon",r.faTrashCan)}}function pe(a,n){if(1&a&&(e.TgZ(0,"td",18)(1,"div",34),e.YNc(2,de,25,4,"ng-container",35),e.qZA()()),2&a){const o=n.$implicit,r=n.dataIndex,l=e.oxw();e.Q6J("formGroupName",l.getFormArrayIndex(r)),e.uIk("colspan",6),e.xp6(1),e.Q6J("@detailExpand",o===l.expandedElement?"expanded":"collapsed"),e.xp6(1),e.Q6J("ngForOf",l.getAdvancedFilters(l.getFormArrayIndex(r)).controls)}}function ue(a,n){1&a&&e._UZ(0,"tr",44)}function fe(a,n){1&a&&e._UZ(0,"tr",45)}function _e(a,n){1&a&&(e.TgZ(0,"tr",46)(1,"td",47),e._UZ(2,"br"),e._uU(3),e.ALo(4,"transloco"),e.qZA()()),2&a&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"roles.accessOverview.noAccessRules")," "))}function ge(a,n){1&a&&e._UZ(0,"tr",48)}c(6625);const $=function(){return["service","component","access","requester","advancedFilters","actions"]},he=function(){return["expandedDetail"]};let j=((w=class{constructor(n,o,r){this.activatedRoute=n,this.baseService=o,this.fb=r,this.displayedColumns=["service","component","access","requester","advancedFilters","actions"],this.expandField=new s.NI(""),this.faTrashCan=N.Vui,this.faPlus=N.r8p,this.serviceOptions=[{id:0,name:""}],this.expandOperator=new s.NI(""),this.expandValue=new s.NI(""),this.componentOptions=[{serviceId:0,components:["*"]}],this.accessOptions=[{value:1,label:"GET (read)"},{value:2,label:"POST (create)"},{value:4,label:"PUT (replace)"},{value:8,label:"PATCH (update)"},{value:16,label:"DELETE (remove)"}],this.requesterOptions=[{value:1,label:"API"},{value:2,label:"SCRIPT"}],this.operatorOptions=[{value:"=",label:"="},{value:"!=",label:"!="},{value:">",label:">"},{value:"<",label:"<"},{value:">=",label:">="},{value:"<=",label:"<="},{value:"in",label:"in"},{value:"not in",label:"not in"},{value:"start with",label:"start with"},{value:"end with",label:"end with"},{value:"contains",label:"contains"},{value:"is null",label:"is null"},{value:"is not null",label:"is not null"}],this.filteredComponentArray=[],this.expandedElement$=new K.X(1),this.expandedElement=null,this.form=this.fb.group({cFormArray:this.fb.array([this.createItem()])})}createItem(){return this.fb.group({service:[""],component:[""]})}ngOnInit(){this.activatedRoute.data.subscribe(n=>{this.serviceOptions=n?.services?.resource.sort((o,r)=>o.name<r.name?-1:o.name>r.name?1:0)||[],"edit"===n.type&&n.data.roleServiceAccessByRoleId.length>0&&n.data.roleServiceAccessByRoleId.forEach(o=>{const r=o.serviceId,l=this.serviceOptions.find(i=>i.id===r)?.name||"";"email"!==l?this.baseService.get(l,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(i=>{this.componentOptions.push({serviceId:r,components:i.resource})}):this.componentOptions.push({serviceId:r,components:["*"]})})}),this.initializeFilteredComponents(),this.updateDataSource()}get cFormArray(){return this.form.get("formArray")}initializeFilteredComponents(){this.filteredComponentArray=this.formArray.controls.map((n,o)=>this.getComponentArray(o))}getComponentArray(n){const o=this.formArray.at(n).get("service")?.value;return this.componentOptions.find(l=>l.serviceId===o)?.components||[]}getFormArrayIndex(n){let o=0;for(let r=0;r<this.visible.length;r++)if(this.visible[r]){if(o===n)return r;o++}return-1}filterOptions(n,o){const r=n.target.value.toLowerCase(),l=this.formArray.at(o).get("service")?.value,i=this.componentOptions.find(p=>p.serviceId===l)?.components||[];this.filteredComponentArray[o]=i.filter(p=>p.includes(r))}getComponents(n){var o=this;return(0,Z.Z)(function*(){const r=o.formArray.controls[n].get("service")?.value,l=o.serviceOptions.find(i=>i.id===r)?.name||"";"email"!==l?o.componentOptions.some(i=>i.serviceId===r)||o.baseService.get(l,{additionalParams:[{key:"as_access_list",value:!0}]}).subscribe(i=>{o.componentOptions.push({serviceId:r,components:i.resource})}):o.componentOptions.push({serviceId:r,components:["*"]})})()}getExtendOperator(n){const o=this.serviceAccess.at(n).get("extend-operator")?.value;return this.componentOptions.find(l=>l.serviceId===o)?.components||[]}toggleRow(n,o){this.expandedElement=this.expandedElement===n?null:n,this.expandedElement&&0===this.getAdvancedFilters(o).length&&this.addAdvancedFilter(o)}accessChange(n,o){this.formArray.at(n).get("access")}updateDataSource(){const n=this.formArray.controls.filter((o,r)=>this.visible[r]);this.dataSource=new f.by(n)}get hasServiceAccess(){return this.rootForm.controls.serviceAccess.value.length>0}add(){const n=new s.Oe([]);this.formArray.push(new s.cw({service:new s.NI(0,s.kI.required),component:new s.NI("",s.kI.required),access:new s.NI("",s.kI.required),requester:new s.NI([1],s.kI.required),advancedFilters:n,id:new s.NI(null),serviceAccess:new s.NI("")})),this.visible.push(!0),this.updateDataSource()}getAdvancedFilters(n){return this.formArray.controls[n].get("advancedFilters")}addAdvancedFilter(n){this.getAdvancedFilters(n).push(new s.cw({expandField:new s.NI("",s.kI.required),expandOperator:new s.NI("",s.kI.required),expandValue:new s.NI("",s.kI.required),filterOp:new s.NI("AND")})),this.updateDataSource()}removeAdvancedFilter(n,o){this.getAdvancedFilters(n).removeAt(o),0===this.getAdvancedFilters(n).length&&(this.expandedElement=null),this.updateDataSource()}remove(n){if(n>=0&&n<this.formArray.length){let o=0,r=-1;for(let l=0;l<this.visible.length;l++)if(this.visible[l]){if(o===n){r=l;break}o++}if(this.visible=this.updateNthTrueToFalse(this.visible,n),-1!==r&&r<this.formArray.length){const l=this.formArray.at(r);l.get("service")?.clearValidators(),l.get("component")?.clearValidators(),l.get("access")?.clearValidators(),l.get("requester")?.clearValidators(),l.get("service")?.updateValueAndValidity(),l.get("component")?.updateValueAndValidity(),l.get("access")?.updateValueAndValidity(),l.get("requester")?.updateValueAndValidity()}}this.updateDataSource()}updateNthTrueToFalse(n,o){let r=0;for(let l=0;l<n.length;l++)if(n[l]){if(r===o){n[l]=!1;break}r++}return n}addFilter(n){const o=this.serviceAccess.at(n).get("advancedFilters");o instanceof s.Oe?o.push(new s.cw({expandField:new s.NI("",s.kI.required),expandOperator:new s.NI("",s.kI.required),expandValue:new s.NI("",s.kI.required),filterOp:new s.NI("")})):console.error("advancedFilters is not a FormArray")}removeFilter(n,o){this.serviceAccess.at(n).get("advancedFilters").removeAt(o)}filterOpChange(n,o){this.getAdvancedFilters(o).controls.forEach(r=>{r.get("filterOp")?.setValue(n.value)})}}).\u0275fac=function(n){return new(n||w)(e.Y36(P.gz),e.Y36(v.PA),e.Y36(s.qu))},w.\u0275cmp=e.Xpm({type:w,selectors:[["df-roles-access"]],inputs:{formArray:"formArray",roleForm:"roleForm",visible:"visible"},standalone:!0,features:[e.jDz],decls:39,vars:17,consts:[[1,"service-access-accordion","full-width",3,"formGroup"],["expanded","true"],["formArrayName","serviceAccess"],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","service"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"formGroupName",4,"matCellDef"],["matColumnDef","component"],["matColumnDef","access"],["matColumnDef","requester"],["matColumnDef","advancedFilters"],["matColumnDef","actions"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",3,"formGroupName"],["subscriptSizing","dynamic","appearance","outline"],["formControlName","service","panelWidth","null","required","",3,"selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","component","panelWdith","null","required",""],["formControlName","access","multiple","","panelWidth","null","required","",3,"selectionChange"],["class","example-additional-selection",4,"ngIf"],[1,"example-additional-selection"],["formControlName","requester","multiple","","panelWidth","null"],["mat-icon-button","","color","primary","type","button",3,"click"],["size","xs",3,"icon"],["mat-mini-fab","","color","primary","type","button",3,"click"],["size","xl",3,"icon"],["mat-icon-button","",3,"click"],["formArrayName","advancedFilters",1,"element-detail"],[4,"ngFor","ngForOf"],[1,"expandedItems",3,"formArrayName"],["matInput","","formControlName","expandField"],["formControlName","expandOperator","panelWidth","null"],["formControlName","expandValue","matInput",""],["aria-label","Service Definition Type","formControlName","filterOp",3,"change"],["value","AND"],["value","OR"],["mat-icon-button","","type","button",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"],["mat-row","",1,"detail-row"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"mat-accordion")(2,"mat-expansion-panel",1)(3,"mat-expansion-panel-header")(4,"mat-panel-title"),e._uU(5),e.ALo(6,"transloco"),e.qZA(),e.TgZ(7,"mat-panel-description"),e._uU(8),e.ALo(9,"transloco"),e.qZA()(),e.TgZ(10,"p"),e._uU(11),e.ALo(12,"transloco"),e.qZA(),e.ynx(13,2),e.TgZ(14,"table",3),e.ynx(15,4),e.YNc(16,Q,3,3,"th",5),e.YNc(17,S,10,7,"td",6),e.BQk(),e.ynx(18,7),e.YNc(19,U,3,3,"th",5),e.YNc(20,_,8,6,"td",6),e.BQk(),e.ynx(21,8),e.YNc(22,F,3,3,"th",5),e.YNc(23,oe,8,6,"td",6),e.BQk(),e.ynx(24,9),e.YNc(25,ne,3,3,"th",5),e.YNc(26,ae,7,5,"td",6),e.BQk(),e.ynx(27,10),e.YNc(28,se,3,3,"th",5),e.YNc(29,le,3,2,"td",6),e.BQk(),e.ynx(30,11),e.YNc(31,ie,4,4,"th",5),e.YNc(32,ce,3,2,"td",6),e.BQk(),e.ynx(33,12),e.YNc(34,pe,3,4,"td",6),e.BQk(),e.YNc(35,ue,1,0,"tr",13),e.YNc(36,fe,1,0,"tr",14),e.YNc(37,_e,5,3,"tr",15),e.YNc(38,ge,1,0,"tr",16),e.qZA(),e.BQk(),e.qZA()()()),2&n&&(e.Q6J("formGroup",o.roleForm),e.xp6(5),e.hij(" ",e.lcZ(6,8,"roles.accessOverview.heading"),""),e.xp6(3),e.hij(" ",e.lcZ(9,10,"roles.accessOverview.tableDescription")," "),e.xp6(3),e.hij(" ",e.lcZ(12,12,"roles.accessOverview.description")," "),e.xp6(3),e.Q6J("dataSource",o.dataSource),e.xp6(21),e.Q6J("matHeaderRowDef",e.DdM(14,$)),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(15,$)),e.xp6(2),e.Q6J("matRowDefColumns",e.DdM(16,he)))},dependencies:[y.Ot,f.p0,f.BZ,f.fO,f.as,f.w1,f.Dz,f.nj,f.ge,f.ev,f.XQ,f.Gk,f.Ee,s.UX,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u,s.x0,s.CE,h.lN,h.KE,h.hX,h.TO,t.LD,t.gD,J.ey,C.c,C.Nt,O.To,O.pp,O.ib,O.yz,O.yK,O.u4,T.uH,T.BN,A.ot,A.RK,A.nh,g.ez,g.sg,g.O5,M.vV,M.A9,M.Yi,s.u5],styles:["mat-expansion-panel[_ngcontent-%COMP%]{overflow-x:auto!important}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}table[_ngcontent-%COMP%]{width:100%}tr.detail-row[_ngcontent-%COMP%]{height:0}tr.element-row[_ngcontent-%COMP%]:not(.example-expanded-row):hover{background:whitesmoke}tr.element-row[_ngcontent-%COMP%]:not(.example-expanded-row):active{background:#efefef}.element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column;gap:8px;padding-top:8px}.element-detail[_ngcontent-%COMP%]   .expandedItems[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:5px}.detail-input[_ngcontent-%COMP%]{margin-right:20px}  .cdk-overlay-pane{width:max-content!important}"],data:{animation:[(0,D.X$)("detailExpand",[(0,D.SB)("collapsed,void",(0,D.oB)({height:"*",minHeight:"0"})),(0,D.SB)("expanded",(0,D.oB)({height:"*"})),(0,D.eR)("expanded <=> collapsed",(0,D.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),w);j=(0,d.gn)([(0,q.c)({checkProperties:!0})],j);var E,Ae=c(41089),ee=c(26306),te=c(58504),ve=c(65763),xe=c(72246);function ye(a,n){1&a&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"roles.rolesOverview.error.name")," "))}function Ce(a,n){1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"save")," "))}function Ze(a,n){1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"update")," "))}let H=((E=class{constructor(n,o,r,l,i,p){this.roleService=n,this.fb=o,this.router=r,this.activatedRoute=l,this.themeService=i,this.snackbarService=p,this.type="",this.alertMsg="",this.showAlert=!1,this.alertType="error",this.visibilityArray=[],this.originalLookupKeyIds=[],this.isDarkMode=this.themeService.darkMode$,this.filterOp="",this.roleForm=this.fb.group({id:[0],name:["",s.kI.required],description:[""],active:[!1],serviceAccess:this.fb.array([]),lookupKeys:this.fb.array([])})}ngOnInit(){this.activatedRoute.data.subscribe(({data:n,type:o})=>{this.type=o,n&&(this.snackbarService.setSnackbarLastEle(n.label?n.label:n.name,!0),this.roleForm.patchValue({id:n.id,name:n.name,description:n.description,active:n.isActive}),n.roleServiceAccessByRoleId.length>0&&(this.filterOp=n.roleServiceAccessByRoleId[0].filterOp,n.roleServiceAccessByRoleId.forEach(r=>{this.visibilityArray.push(!0);const l=new s.Oe((r.filters||[]).map(i=>new s.cw({expandField:new s.NI(i.name),expandOperator:new s.NI(i.operator),expandValue:new s.NI(i.value),filterOp:new s.NI(r.filterOp)})));this.roleForm.controls.serviceAccess.push(new s.cw({service:new s.NI(r.serviceId?r.serviceId:0,[s.kI.required]),component:new s.NI(r.component),access:new s.NI(this.handleAccessValue(r.verbMask),[s.kI.required]),requester:new s.NI(this.handleRequesterValue(r.requestorMask)),advancedFilters:l,id:new s.NI(r.id),extendField:new s.NI(r.extendField),extendOperator:new s.NI(r.extendOperator),extendValue:new s.NI(r.extendValue),filterOp:new s.NI(r.filterOp)}))})),n.lookupByRoleId.length>0&&n.lookupByRoleId.forEach(r=>{r.id&&this.originalLookupKeyIds.push(r.id),this.roleForm.controls.lookupKeys.push(new s.cw({id:new s.NI(r.id),name:new s.NI(r.name,[s.kI.required]),value:new s.NI(r.value),private:new s.NI(r.private)}))}))})}handleRequesterValue(n){return 3===n?[1,2]:[n]}handleAccessValue(n){const o=[1,2,4,8,16],r=[];for(let l=o.length-1;l>=0;l--){const i=o[l];n>=i&&(r.push(i),n-=i)}return r}triggerAlert(n,o){this.alertType=n,this.alertMsg=o,this.showAlert=!0}get serviceAccess(){return this.roleForm.get("serviceAccess")}onSubmit(){if(this.roleForm.get("serviceAccess").controls.forEach((i,p)=>{this.visibilityArray[p]||(i.get("service")?.clearValidators(),i.get("component")?.clearValidators(),i.get("access")?.clearValidators(),i.get("requester")?.clearValidators(),i.get("service")?.updateValueAndValidity(),i.get("component")?.updateValueAndValidity(),i.get("access")?.updateValueAndValidity(),i.get("requester")?.updateValueAndValidity())}),this.roleForm.invalid)return void this.roleForm.markAllAsTouched();const o=this.roleForm.getRawValue();if(""===o.name||null===o.name)return;const r={id:o.id,name:o.name,description:o.description,isActive:o.active,roleServiceAccessByRoleId:o.serviceAccess.map((i,p)=>{const x=i.advancedFilters.map(I=>({name:I.expandField,operator:I.expandOperator,value:I.expandValue})),Te=i.advancedFilters.map(I=>I.filterOp);return{id:i.id,roleId:this.visibilityArray[p]?o.id:null,serviceId:0===i.service?null:i.service,component:i.component,verbMask:i.access.reduce((I,W)=>I+W,0),requestorMask:i.requester.reduce((I,W)=>I+W,0),filters:x,filterOp:Te[0]}}),lookupByRoleId:this.getLookupKeysWithDeletions(o)},l={resource:[r]};"edit"===this.type&&r.id?this.roleService.update(r.id,r).pipe((0,ee.K)(i=>(this.triggerAlert("error",i.error.error.message),(0,te._)(()=>new Error(i))))).subscribe(()=>{this.goBack()}):this.roleService.create(l,{fields:"*",related:"role_service_access_by_role_id,lookup_by_role_id"}).pipe((0,ee.K)(i=>(this.triggerAlert("error",i.error.error.context.resource[0].message),(0,te._)(()=>new Error(i))))).subscribe(()=>{this.goBack()})}getLookupKeysWithDeletions(n){const o=n.lookupKeys,r=[...o],l=o.map(p=>p.id).filter(p=>p);return this.originalLookupKeyIds.filter(p=>!l.includes(p)).forEach(p=>{r.push({id:p,role_id:null})}),r}goBack(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}}).\u0275fac=function(n){return new(n||E)(e.Y36(v.i9),e.Y36(s.qu),e.Y36(P.F0),e.Y36(P.gz),e.Y36(ve.F),e.Y36(xe.w))},E.\u0275cmp=e.Xpm({type:E,selectors:[["df-role-details"]],standalone:!0,features:[e.jDz],decls:34,vars:32,consts:[[3,"showAlert","alertType","alertClosed"],[1,"details-section",3,"formGroup","ngSubmit"],["appearance","outline","subscriptSizing","dynamic",1,"dynamic-width"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","active",1,"dynamic-width"],["appearance","outline","subscriptSizing","dynamic"],["rows","1","matInput","","formControlName","description"],["formArrayName","serviceAccess",1,"full-width"],[1,"full-width",3,"visible","formArray","roleForm"],["formArrayName","lookupKeys",1,"full-width"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"click"],["mat-flat-button","","color","primary",1,"save-btn"]],template:function(n,o){1&n&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"transloco"),e.qZA(),e.TgZ(3,"df-alert",0),e.NdJ("alertClosed",function(){return o.showAlert=!1}),e._uU(4),e.qZA(),e.TgZ(5,"form",1),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.ALo(6,"async"),e.TgZ(7,"mat-form-field",2)(8,"mat-label"),e._uU(9),e.ALo(10,"transloco"),e.qZA(),e._UZ(11,"input",3),e.YNc(12,ye,3,3,"mat-error",4),e.qZA(),e.TgZ(13,"mat-slide-toggle",5),e._uU(14),e.ALo(15,"transloco"),e.qZA(),e.TgZ(16,"mat-form-field",6)(17,"mat-label"),e._uU(18),e.ALo(19,"transloco"),e.qZA(),e._UZ(20,"textarea",7),e.qZA(),e.TgZ(21,"div",8),e._UZ(22,"df-roles-access",9),e.qZA(),e.TgZ(23,"p"),e._uU(24),e.ALo(25,"transloco"),e.qZA(),e._UZ(26,"df-lookup-keys",10),e.TgZ(27,"div",11)(28,"button",12),e.NdJ("click",function(){return o.goBack()}),e._uU(29),e.ALo(30,"transloco"),e.qZA(),e.TgZ(31,"button",13),e.YNc(32,Ce,3,3,"span",4),e.YNc(33,Ze,3,3,"span",4),e.qZA()()()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,18,"roles.rolesOverview.description"),"\n"),e.xp6(2),e.Q6J("showAlert",o.showAlert)("alertType",o.alertType),e.xp6(1),e.hij(" ",o.alertMsg,"\n"),e.xp6(1),e.Tol(e.lcZ(6,20,o.isDarkMode)?"dark-theme":""),e.Q6J("formGroup",o.roleForm),e.xp6(4),e.Oqu(e.lcZ(10,22,"name")),e.xp6(3),e.Q6J("ngIf",o.roleForm.controls.name.hasError("required")),e.xp6(2),e.Oqu(e.lcZ(15,24,"active")),e.xp6(4),e.Oqu(e.lcZ(19,26,"description")),e.xp6(4),e.Q6J("visible",o.visibilityArray)("formArray",o.serviceAccess)("roleForm",o.roleForm),e.xp6(2),e.hij(" ",e.lcZ(25,28,"roles.lookupKeys.description")," "),e.xp6(5),e.hij(" ",e.lcZ(30,30,"cancel")," "),e.xp6(3),e.Q6J("ngIf","create"===o.type),e.xp6(1),e.Q6J("ngIf","edit"===o.type))},dependencies:[y.Ot,g.Ov,s.u5,s._Y,s.Fj,s.JJ,s.JL,s.Q7,C.c,C.Nt,h.KE,h.hX,h.TO,h.lN,s.UX,s.sg,s.u,s.CE,R.a,b.rP,b.Rr,A.ot,A.lW,j,g.O5,Ae.v],encapsulation:2}),E);H=(0,d.gn)([(0,q.c)({checkProperties:!0})],H)},41089:(z,k,c)=>{c.d(k,{v:()=>b});var d=c(65879),s=c(96814),g=c(32296),y=c(45597),v=c(90590);function h(A,Z){if(1&A){const f=d.EpF();d.TgZ(0,"button",5),d.NdJ("click",function(){d.CHM(f);const t=d.oxw(2);return d.KtG(t.dismissAlert())}),d.TgZ(1,"fa-icon",6),d._uU(2),d.qZA()()}if(2&A){const f=d.oxw(2);d.xp6(1),d.Q6J("icon",f.faXmark),d.xp6(1),d.Oqu("alerts.close")}}function R(A,Z){if(1&A&&(d.TgZ(0,"div",1),d._UZ(1,"fa-icon",2),d.TgZ(2,"span",3),d.Hsn(3),d.qZA(),d.YNc(4,h,3,2,"button",4),d.qZA()),2&A){const f=d.oxw();d.Tol(f.alertType),d.xp6(1),d.Q6J("icon",f.icon),d.xp6(3),d.Q6J("ngIf",f.dismissible)}}const C=["*"];let b=(()=>{class A{constructor(){this.alertType="success",this.showAlert=!1,this.dismissible=!0,this.alertClosed=new d.vpe,this.faXmark=v.g82}dismissAlert(){this.alertClosed.emit()}get icon(){switch(this.alertType){case"success":return v.f8k;case"error":return v.$9F;case"warning":return v.RLE;default:return v.sqG}}}return A.\u0275fac=function(f){return new(f||A)},A.\u0275cmp=d.Xpm({type:A,selectors:[["df-alert"]],inputs:{alertType:"alertType",showAlert:"showAlert",dismissible:"dismissible"},outputs:{alertClosed:"alertClosed"},standalone:!0,features:[d.jDz],ngContentSelectors:C,decls:1,vars:1,consts:[["class","alert-container",3,"class",4,"ngIf"],[1,"alert-container"],["aria-hidden","true",1,"alert-icon",3,"icon"],["role","alert",1,"alert-message"],["mat-icon-button","","class","dismiss-alert",3,"click",4,"ngIf"],["mat-icon-button","",1,"dismiss-alert",3,"click"],[3,"icon"]],template:function(f,N){1&f&&(d.F$t(),d.YNc(0,R,5,4,"div",0)),2&f&&d.Q6J("ngIf",N.showAlert)},dependencies:[s.O5,g.ot,g.RK,y.uH,y.BN],styles:[".alert-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;border:1px solid;border-radius:5px;box-shadow:0 0 5px #0003;color:#000}.alert-container[_ngcontent-%COMP%]   .alert-message[_ngcontent-%COMP%]{flex:1;padding:8px}.alert-container[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{padding:0 10px}.alert-container.success[_ngcontent-%COMP%]{border-color:#81c784;background-color:#c8e6c9}.alert-container.success[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#4caf50}.alert-container.error[_ngcontent-%COMP%]{border-color:#e57373;background-color:#ffcdd2}.alert-container.error[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#f44336}.alert-container.warning[_ngcontent-%COMP%]{border-color:#ffb74d;background-color:#ffe0b2}.alert-container.warning[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#ff9800}.alert-container.info[_ngcontent-%COMP%]{border-color:#64b5f6;background-color:#bbdefb}.alert-container.info[_ngcontent-%COMP%]   .alert-icon[_ngcontent-%COMP%]{color:#2196f3}"]}),A})()},84870:(z,k,c)=>{c.d(k,{a:()=>U});var T,d=c(97582),s=c(96814),g=c(56223),y=c(64170),v=c(32296),h=c(25313),R=c(2032),C=c(82599),b=c(45597),A=c(3305),Z=c(90590),f=c(42346),N=c(78791),t=c(65879),O=c(65763);function M(m,u){if(1&m&&(t.TgZ(0,"mat-accordion")(1,"mat-expansion-panel")(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t._uU(4),t.ALo(5,"transloco"),t.qZA(),t.TgZ(6,"mat-panel-description"),t._uU(7),t.ALo(8,"transloco"),t.qZA()(),t.GkF(9,3),t.qZA()()),2&m){t.oxw();const _=t.MAs(4);t.xp6(4),t.hij(" ",t.lcZ(5,3,"lookupKeys.label"),""),t.xp6(3),t.Oqu(t.lcZ(8,5,"lookupKeys.desc")),t.xp6(2),t.Q6J("ngTemplateOutlet",_)}}function q(m,u){1&m&&(t.TgZ(0,"mat-header-cell"),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"name")," "))}function K(m,u){1&m&&(t.TgZ(0,"mat-cell",16)(1,"mat-form-field",17)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"input",18),t.qZA()()),2&m&&(t.Q6J("formGroupName",u.index),t.xp6(3),t.Oqu(t.lcZ(4,2,"name")))}function D(m,u){1&m&&(t.TgZ(0,"mat-header-cell"),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"value")," "))}function e(m,u){1&m&&(t.TgZ(0,"mat-cell",16)(1,"mat-form-field",17)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"input",19),t.qZA()()),2&m&&(t.Q6J("formGroupName",u.index),t.xp6(3),t.Oqu(t.lcZ(4,2,"value")))}function P(m,u){1&m&&(t.TgZ(0,"mat-header-cell"),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"private")," "))}function J(m,u){1&m&&(t.TgZ(0,"mat-cell",16),t._UZ(1,"mat-slide-toggle",20),t.ALo(2,"transloco"),t.qZA()),2&m&&(t.Q6J("formGroupName",u.index),t.xp6(1),t.uIk("aria-label",t.lcZ(2,2,"name")))}function X(m,u){if(1&m){const _=t.EpF();t.TgZ(0,"mat-header-cell")(1,"button",21),t.NdJ("click",function(){t.CHM(_);const L=t.oxw(2);return t.KtG(L.add())}),t.ALo(2,"transloco"),t._UZ(3,"fa-icon",22),t.qZA()()}if(2&m){const _=t.oxw(2);t.xp6(1),t.uIk("aria-label",t.lcZ(2,2,"newEntry")),t.xp6(2),t.Q6J("icon",_.faPlus)}}function w(m,u){if(1&m){const _=t.EpF();t.TgZ(0,"mat-cell",16)(1,"button",23),t.NdJ("click",function(){const V=t.CHM(_).index,G=t.oxw(2);return t.KtG(G.remove(V))}),t._UZ(2,"fa-icon",24),t.qZA()()}if(2&m){const _=u.index,F=t.oxw(2);t.Q6J("formGroupName",_),t.xp6(2),t.Q6J("icon",F.faTrashCan)}}function Q(m,u){1&m&&t._UZ(0,"mat-header-row")}function Y(m,u){1&m&&t._UZ(0,"mat-row")}function B(m,u){1&m&&(t.TgZ(0,"tr",25)(1,"td",26),t._uU(2),t.ALo(3,"transloco"),t.qZA()()),2&m&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"lookupKeys.noKeys")," "))}function S(m,u){if(1&m&&(t.ynx(0,4)(1,5),t.TgZ(2,"mat-table",6),t.ynx(3,7),t.YNc(4,q,3,3,"mat-header-cell",8),t.YNc(5,K,6,4,"mat-cell",9),t.BQk(),t.ynx(6,10),t.YNc(7,D,3,3,"mat-header-cell",8),t.YNc(8,e,6,4,"mat-cell",9),t.BQk(),t.ynx(9,11),t.YNc(10,P,3,3,"mat-header-cell",8),t.YNc(11,J,3,4,"mat-cell",9),t.BQk(),t.ynx(12,12),t.YNc(13,X,4,4,"mat-header-cell",8),t.YNc(14,w,3,2,"mat-cell",9),t.BQk(),t.YNc(15,Q,1,0,"mat-header-row",13),t.YNc(16,Y,1,0,"mat-row",14),t.YNc(17,B,4,3,"tr",15),t.qZA(),t.BQk()()),2&m){const _=t.oxw();t.Q6J("formGroup",_.rootForm),t.xp6(2),t.Q6J("dataSource",_.dataSource),t.xp6(13),t.Q6J("matHeaderRowDef",_.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",_.displayedColumns)}}let U=((T=class{constructor(u,_){this.rootFormGroup=u,this.themeService=_,this.displayedColumns=["name","value","private","actions"],this.faTrashCan=Z.Vui,this.faPlus=Z.r8p,this.showAccordion=!0,this.isDarkMode=this.themeService.darkMode$}ngOnInit(){this.rootForm=this.rootFormGroup.control,this.rootFormGroup.ngSubmit.subscribe(()=>{this.lookupKeys.markAllAsTouched()}),this.lookupKeys=this.rootForm.get("lookupKeys"),this.updateDataSource()}updateDataSource(){this.lookupKeys.controls.forEach(u=>{u.get("id")?.value&&u.get("name")?.disable()}),this.dataSource=new h.by(this.lookupKeys.controls)}add(){this.lookupKeys.push(new g.cw({name:new g.NI("",g.kI.required),value:new g.NI(""),private:new g.NI(!1)})),this.updateDataSource()}remove(u){this.lookupKeys.removeAt(u),this.updateDataSource()}}).\u0275fac=function(u){return new(u||T)(t.Y36(g.sg),t.Y36(O.F))},T.\u0275cmp=t.Xpm({type:T,selectors:[["df-lookup-keys"]],inputs:{showAccordion:"showAccordion"},standalone:!0,features:[t.jDz],decls:5,vars:6,consts:[[1,"lookup-keys-accordion"],[4,"ngIf","ngIfElse"],["lookupKeys",""],[3,"ngTemplateOutlet"],[3,"formGroup"],["formArrayName","lookupKeys"],[3,"dataSource"],["matColumnDef","name"],[4,"matHeaderCellDef"],[3,"formGroupName",4,"matCellDef"],["matColumnDef","value"],["matColumnDef","private"],["matColumnDef","actions","stickyEnd",""],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["class","mat-row no-data-row",4,"matNoDataRow"],[3,"formGroupName"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","formControlName","name"],["matInput","","formControlName","value"],["color","primary","formControlName","private"],["mat-mini-fab","","type","button",1,"save-btn",3,"click"],["size","xl",3,"icon"],["mat-icon-button","","type","button",1,"remove-btn",3,"click"],["size","xs",3,"icon"],[1,"mat-row","no-data-row"],["colspan","4",1,"mat-cell"]],template:function(u,_){if(1&u&&(t.TgZ(0,"div",0),t.ALo(1,"async"),t.YNc(2,M,10,7,"mat-accordion",1),t.YNc(3,S,18,4,"ng-template",null,2,t.W1O),t.qZA()),2&u){const F=t.MAs(4);t.Tol(t.lcZ(1,4,_.isDarkMode)?"dark-theme":""),t.xp6(2),t.Q6J("ngIf",_.showAccordion)("ngIfElse",F)}},dependencies:[g.u5,g.Fj,g.JJ,g.JL,g.UX,g.sg,g.u,g.x0,g.CE,s.O5,s.tP,y.lN,y.KE,y.hX,v.ot,v.RK,v.nh,h.p0,h.BZ,h.fO,h.as,h.w1,h.Dz,h.nj,h.ge,h.ev,h.XQ,h.Gk,h.Ee,R.c,R.Nt,C.rP,C.Rr,b.uH,b.BN,A.To,A.pp,A.ib,A.yz,A.yK,A.u4,f.Ot,s.Ov],styles:[".lookup-keys-accordion[_ngcontent-%COMP%]{padding:16px 0}.mat-column-actions[_ngcontent-%COMP%], .mat-column-private[_ngcontent-%COMP%]{max-width:10%}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px}"]}),T);U=(0,d.gn)([(0,N.c)({checkProperties:!0})],U)}}]);