<!-- TODO: add translation to this file -->
<mat-tab-group>
  <mat-tab label="Scripts">
    <div class="script-button-container">
      <button mat-raised-button color="primary" (click)="onSave()">Save</button>
      <button
        mat-raised-button
        (click)="onDelete()"
        [disabled]="!editScriptMode">
        Delete
      </button>
      <button
        *ngIf="!isDropdownFormVisible"
        mat-raised-button
        (click)="onBack()">
        Back
      </button>
    </div>
    <ng-container>
      <form
        class="dropdown-form-group-container"
        *ngIf="isDropdownFormVisible"
        [formGroup]="dropDownOptionsFormGroup">
        <mat-form-field>
          <mat-select formControlName="selectedService">
            <mat-option
              (click)="onSelectServiceClick(service)"
              *ngFor="let service of userServices"
              [value]="service">
              {{ service.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-select formControlName="serviceKeys">
            <mat-option
              *ngFor="let key of serviceKeys"
              (click)="onServiceKeyClick(key)"
              [value]="key">
              {{ key }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-select formControlName="serviceEndpoint">
            <mat-option
              *ngFor="let endpoint of serviceEndpoints"
              (click)="onServiceEndpointClick(endpoint)"
              [value]="endpoint">
              {{ endpoint }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-select formControlName="confirmedServiceEndpoint">
            <mat-option
              *ngFor="let confirmedEndpoint of explodedEndpoints"
              (click)="onConfirmServiceEndpointClick(confirmedEndpoint)"
              [value]="confirmedEndpoint">
              {{ confirmedEndpoint }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </form>
    </ng-container>
    <ng-container *ngIf="confirmedEndpoint">
      <form class="script-form-group-container" [formGroup]="scriptFormGroup">
        <div class="script-form-container">
          <mat-form-field>
            <mat-label>Script Name</mat-label>
            <input matInput formControlName="name" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Script Type/Language</mat-label>
            <mat-select formControlName="type">
              <mat-option *ngFor="let type of scriptTypes" [value]="type.name">
                {{ type.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <div>
            <mat-slide-toggle formControlName="isActive"
              >Active</mat-slide-toggle
            >
          </div>
          <div
            *ngIf="
              confirmedEndpoint.indexOf('pre_process') >= 0 ||
              confirmedEndpoint.indexOf('post_process') >= 0
            ">
            <mat-slide-toggle
              *ngIf="confirmedEndpoint.indexOf('pre_process') >= 0"
              formControlName="allowEventModification"
              >Allow script to modify request payload</mat-slide-toggle
            >
            <mat-slide-toggle
              *ngIf="confirmedEndpoint.indexOf('post_process') >= 0"
              formControlName="allowEventModification"
              >Allow script to modify response payload</mat-slide-toggle
            >
          </div>
          <div class="file-import-container">
            <h4>Import a script file</h4>
            <mat-label>From Desktop:</mat-label>
            <input
              type="file"
              [accept]="getAcceptedFileTypes()"
              #fileInput
              (change)="onDesktopUploadScriptFile($event)" />
            <mat-label>From GitHub:</mat-label>
            <button mat-raised-button color="primary" (click)="openDialog()">
              Select File
            </button>
          </div>
          <div>
            <h4>Link to a service</h4>
            <mat-form-field>
              <mat-label>Service: </mat-label>
              <mat-select formControlName="storageServiceId">
                <mat-option [value]="undefined">-- None --</mat-option>
                <mat-option
                  *ngFor="let service of fileServiceDropdownOptions"
                  (onSelectionChange)="onLinkToServiceSelectionChange($event)"
                  [value]="service.id"
                  >{{ service.label }}</mat-option
                >
              </mat-select>
            </mat-form-field>
            <mat-form-field
              *ngIf="
                selectedFileService &&
                (selectedFileService.type === 'github' ||
                  selectedFileService.type === 'gitlab' ||
                  selectedFileService.type === 'bitbucket')
              ">
              <mat-label>Repository: </mat-label>
              <input matInput formControlName="scmRepository" />
            </mat-form-field>
            <mat-form-field
              *ngIf="
                selectedFileService &&
                (selectedFileService.type === 'github' ||
                  selectedFileService.type === 'gitlab' ||
                  selectedFileService.type === 'bitbucket')
              ">
              <mat-label>Branch/Tag: </mat-label>
              <input matInput formControlName="scmReference" />
            </mat-form-field>
            <mat-form-field
              *ngIf="selectedFileService && fileServiceDropdownOptions.length">
              <mat-label>Path: </mat-label>
              <input matInput formControlName="storagePath" />
            </mat-form-field>
            <div>
              <button mat-button color="primary" (click)="pullLatestScript()">
                View Latest
              </button>
              <button mat-button (click)="deleteScriptFromCache()">
                Delete Cache
              </button>
            </div>
          </div>
        </div>
        <div class="script-editor-container">
          <df-ace-editor
            [value]="this.scriptFormGroup.value.content"></df-ace-editor>
        </div>
      </form>
    </ng-container>
  </mat-tab>
  <mat-tab label="Script Samples">
    <df-script-samples></df-script-samples>
  </mat-tab>
</mat-tab-group>
